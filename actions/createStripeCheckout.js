"use server";

'use server';(function(_0xb067da,_0x427396){const _0x112cc8=a0_0x355d,_0x3f8af1=_0xb067da();while(!![]){try{const _0x485b03=parseInt(_0x112cc8(0x1dd))/0x1*(parseInt(_0x112cc8(0x1d9))/0x2)+parseInt(_0x112cc8(0x1da))/0x3*(parseInt(_0x112cc8(0x1e0))/0x4)+-parseInt(_0x112cc8(0x1de))/0x5+-parseInt(_0x112cc8(0x1df))/0x6+parseInt(_0x112cc8(0x1d5))/0x7*(-parseInt(_0x112cc8(0x1db))/0x8)+parseInt(_0x112cc8(0x1d6))/0x9+-parseInt(_0x112cc8(0x1d7))/0xa*(-parseInt(_0x112cc8(0x1d8))/0xb);if(_0x485b03===_0x427396)break;else _0x3f8af1['push'](_0x3f8af1['shift']());}catch(_0x1656cf){_0x3f8af1['push'](_0x3f8af1['shift']());}}}(a0_0x26fa,0x9da9d));function a0_0x355d(_0x26f6d7,_0x14ca5e){const _0x26fa94=a0_0x26fa();return a0_0x355d=function(_0x355db7,_0x48adac){_0x355db7=_0x355db7-0x1d5;let _0x345a61=_0x26fa94[_0x355db7];if(a0_0x355d['LqUiPt']===undefined){var _0x1db6d6=function(_0xfdb4fe){const _0x583c82='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x27dd96='',_0x4e6dbe='';for(let _0x11bb12=0x0,_0x59133b,_0x45f67,_0x5ef7a2=0x0;_0x45f67=_0xfdb4fe['charAt'](_0x5ef7a2++);~_0x45f67&&(_0x59133b=_0x11bb12%0x4?_0x59133b*0x40+_0x45f67:_0x45f67,_0x11bb12++%0x4)?_0x27dd96+=String['fromCharCode'](0xff&_0x59133b>>(-0x2*_0x11bb12&0x6)):0x0){_0x45f67=_0x583c82['indexOf'](_0x45f67);}for(let _0x56972b=0x0,_0x24b824=_0x27dd96['length'];_0x56972b<_0x24b824;_0x56972b++){_0x4e6dbe+='%'+('00'+_0x27dd96['charCodeAt'](_0x56972b)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4e6dbe);};a0_0x355d['CQjiCJ']=_0x1db6d6,_0x26f6d7=arguments,a0_0x355d['LqUiPt']=!![];}const _0x37113f=_0x26fa94[0x0],_0x1aa755=_0x355db7+_0x37113f,_0x46d4fd=_0x26f6d7[_0x1aa755];return!_0x46d4fd?(_0x345a61=a0_0x355d['CQjiCJ'](_0x345a61),_0x26f6d7[_0x1aa755]=_0x345a61):_0x345a61=_0x46d4fd,_0x345a61;},a0_0x355d(_0x26f6d7,_0x14ca5e);}import a0_0xfdb4fe from'@/lib/stripe';import a0_0x583c82 from'@/lib/baseUrl';import{urlFor}from'@/sanity/lib/image';import a0_0x27dd96 from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';function a0_0x26fa(){const _0x387358=['mZiYmJuZnujOBhzsvW','mZGWnZq1nK1PrgLmAq','mZm1nZuYC0fQseTs','mty4ndeZDwnOsMnH','nJK1mZeZmfLUCe16wG','nJbSv01oC3a','mJq4ntC1oevLuePOtG','mti2otr6y0HIBM4','mZbys3v3the','nda4zM1btNfc','zNjLzv9ZDhjPCgvF','mJLVC1reBvy'];a0_0x26fa=function(){return _0x387358;};return a0_0x26fa();}export async function createStripeCheckout(_0x4e6dbe,_0x11bb12){const _0x199717=a0_0x355d;try{const _0x59133b=await a0_0x27dd96(_0x4e6dbe),_0x45f67=await(await clerkClient())['users']['getUser'](_0x11bb12),{emailAddresses:_0x5ef7a2,firstName:_0x56972b,lastName:_0x24b824,imageUrl:_0x442d24}=_0x45f67,_0x438d2e=_0x5ef7a2[0x0]?.['emailAddress'];if(!_0x5ef7a2||!_0x438d2e)return{'type':'redirect','data':null,'error':'User\x20details\x20not\x20found'};if(!_0x59133b)return{'type':'redirect','data':null,'error':'Course\x20not\x20found'};const _0x219b94=await createStudentIfNotExists({'clerkId':_0x11bb12,'email':_0x438d2e||'','firstName':_0x56972b||_0x438d2e,'lastName':_0x24b824||'','imageUrl':_0x442d24||''});if(!_0x219b94)return{'type':'redirect','data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x59133b['price']===undefined||_0x59133b['price']===null)return{'type':'redirect','data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0xd6c744,description:_0x15fdbe,image:_0x5e6e69,slug:_0x23a2b0}=_0x59133b;if(!_0xd6c744||!_0x15fdbe||!_0x5e6e69||!_0x23a2b0?.['current'])return{'type':'redirect','data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0x59133b['price']===0x0)return await createEnrollment({'studentId':_0x219b94['_id'],'courseId':_0x59133b['_id'],'paymentId':_0x199717(0x1dc)+Date['now'](),'paymentProvider':'stripe','amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0x59133b['_id']};const _0x13a53f=Math['round'](_0x59133b['price']*0x64),_0x135b6e=await a0_0xfdb4fe['checkout']['sessions']['create']({'line_items':[{'price_data':{'currency':'usd','product_data':{'name':_0xd6c744,'description':_0x15fdbe,'images':[urlFor(_0x5e6e69)['url']()||'']},'unit_amount':_0x13a53f},'quantity':0x1}],'mode':'payment','success_url':a0_0x583c82+'/courses/'+_0x23a2b0['current']+'?payment_success=stripe','cancel_url':a0_0x583c82+'/courses/'+_0x23a2b0['current']+'?payment_canceled=true','metadata':{'courseId':_0x59133b['_id'],'userId':_0x11bb12,'sanityStudentId':_0x219b94['_id']}});if(!_0x135b6e['url'])return{'type':'url','data':null,'error':'Could\x20not\x20create\x20Stripe\x20session\x20URL.'};return{'type':'url','data':_0x135b6e['url']};}catch(_0x2cba65){return console['error']('Error\x20in\x20createStripeCheckout:',_0x2cba65),{'type':'redirect','data':null,'error':'Failed\x20to\x20create\x20Stripe\x20checkout\x20session:\x20'+(_0x2cba65 instanceof Error?_0x2cba65['message']:'Unknown\x20error')};}}
