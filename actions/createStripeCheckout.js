"use server";

'use server';(function(_0x22d7e1,_0x1c4660){const _0x2256b0=a0_0x5a84,_0x540ec5=_0x22d7e1();while(!![]){try{const _0x27029b=parseInt(_0x2256b0(0xc4))/0x1*(-parseInt(_0x2256b0(0xc7))/0x2)+parseInt(_0x2256b0(0xbf))/0x3*(parseInt(_0x2256b0(0xc2))/0x4)+-parseInt(_0x2256b0(0xc1))/0x5*(parseInt(_0x2256b0(0xbe))/0x6)+parseInt(_0x2256b0(0xc5))/0x7*(parseInt(_0x2256b0(0xc0))/0x8)+-parseInt(_0x2256b0(0xc3))/0x9*(parseInt(_0x2256b0(0xbd))/0xa)+-parseInt(_0x2256b0(0xc8))/0xb*(-parseInt(_0x2256b0(0xca))/0xc)+-parseInt(_0x2256b0(0xc9))/0xd;if(_0x27029b===_0x1c4660)break;else _0x540ec5['push'](_0x540ec5['shift']());}catch(_0x3db46c){_0x540ec5['push'](_0x540ec5['shift']());}}}(a0_0x3733,0x93b76));function a0_0x5a84(_0x21c6df,_0x20c422){const _0x373332=a0_0x3733();return a0_0x5a84=function(_0x5a8420,_0x33e558){_0x5a8420=_0x5a8420-0xbd;let _0x469f54=_0x373332[_0x5a8420];return _0x469f54;},a0_0x5a84(_0x21c6df,_0x20c422);}import a0_0x133d13 from'@/lib/stripe';import a0_0x12fb04 from'@/lib/baseUrl';function a0_0x3733(){const _0xffa4a2=['2340hzyoCN','313SHUqkZ','1936655BGcCZa','redirect','3830XKYSnU','5227387yDGCxe','13150735rOlyzP','24vfQFBd','User\x20details\x20not\x20found','320ZfTAyt','6MLYCTk','1472511DVwVub','32WdqZpQ','4072060DJjqaT','8SwVNNT'];a0_0x3733=function(){return _0xffa4a2;};return a0_0x3733();}import{urlFor}from'@/sanity/lib/image';import a0_0x4258b9 from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createStripeCheckout(_0x185be7,_0x3bba8e){const _0xaa0ed8=a0_0x5a84;try{const _0xe6ba09=await a0_0x4258b9(_0x185be7),_0x14ae07=await(await clerkClient())['users']['getUser'](_0x3bba8e),{emailAddresses:_0x77aa03,firstName:_0x87e15,lastName:_0x51329f,imageUrl:_0x5665f7}=_0x14ae07,_0x1244af=_0x77aa03[0x0]?.['emailAddress'];if(!_0x77aa03||!_0x1244af)return{'type':'redirect','data':null,'error':_0xaa0ed8(0xcb)};if(!_0xe6ba09)return{'type':'redirect','data':null,'error':'Course\x20not\x20found'};const _0x13f93b=await createStudentIfNotExists({'clerkId':_0x3bba8e,'email':_0x1244af||'','firstName':_0x87e15||_0x1244af,'lastName':_0x51329f||'','imageUrl':_0x5665f7||''});if(!_0x13f93b)return{'type':_0xaa0ed8(0xc6),'data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0xe6ba09['price']===undefined||_0xe6ba09['price']===null)return{'type':'redirect','data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0x9faa15,description:_0x3e5abb,image:_0x21f040,slug:_0x3b4988}=_0xe6ba09;if(!_0x9faa15||!_0x3e5abb||!_0x21f040||!_0x3b4988?.['current'])return{'type':'redirect','data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0xe6ba09['price']===0x0)return await createEnrollment({'studentId':_0x13f93b['_id'],'courseId':_0xe6ba09['_id'],'paymentId':'free_stripe_'+Date['now'](),'paymentProvider':'stripe','amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0xe6ba09['_id']};const _0xf5b084=Math['round'](_0xe6ba09['price']*0x64),_0xad32b9=await a0_0x133d13['checkout']['sessions']['create']({'line_items':[{'price_data':{'currency':'usd','product_data':{'name':_0x9faa15,'description':_0x3e5abb,'images':[urlFor(_0x21f040)['url']()||'']},'unit_amount':_0xf5b084},'quantity':0x1}],'mode':'payment','success_url':a0_0x12fb04+'/courses/'+_0x3b4988['current']+'?payment_success=stripe','cancel_url':a0_0x12fb04+'/courses/'+_0x3b4988['current']+'?payment_canceled=true','metadata':{'courseId':_0xe6ba09['_id'],'userId':_0x3bba8e,'sanityStudentId':_0x13f93b['_id']}});if(!_0xad32b9['url'])return{'type':'url','data':null,'error':'Could\x20not\x20create\x20Stripe\x20session\x20URL.'};return{'type':'url','data':_0xad32b9['url']};}catch(_0x496e55){return console['error']('Error\x20in\x20createStripeCheckout:',_0x496e55),{'type':'redirect','data':null,'error':'Failed\x20to\x20create\x20Stripe\x20checkout\x20session:\x20'+(_0x496e55 instanceof Error?_0x496e55['message']:'Unknown\x20error')};}}
