"use server";

'use server';(function(_0xa089cb,_0x1e77ea){const _0x1937cf=a1_0x1915,_0x4b09d8=_0xa089cb();while(!![]){try{const _0x530091=-parseInt(_0x1937cf(0xa1))/0x1+-parseInt(_0x1937cf(0xa3))/0x2+parseInt(_0x1937cf(0xa2))/0x3+parseInt(_0x1937cf(0xa4))/0x4+-parseInt(_0x1937cf(0x9d))/0x5*(-parseInt(_0x1937cf(0xa0))/0x6)+-parseInt(_0x1937cf(0x9c))/0x7+-parseInt(_0x1937cf(0x99))/0x8*(-parseInt(_0x1937cf(0xa5))/0x9);if(_0x530091===_0x1e77ea)break;else _0x4b09d8['push'](_0x4b09d8['shift']());}catch(_0x132877){_0x4b09d8['push'](_0x4b09d8['shift']());}}}(a1_0x32c8,0x9e81f));function a1_0x32c8(){const _0x29dfe1=['716558nWTQXE','3175929lTCcov','1587390JTeEwK','1789760TyfynV','4619151PDvonV','8yRaoCj','_id','Course\x20price\x20is\x20not\x20set','3420578ahGmka','80bnZWxQ','free_stripe_','create','235812rcfUBF'];a1_0x32c8=function(){return _0x29dfe1;};return a1_0x32c8();}function a1_0x1915(_0x19863c,_0x4e82be){const _0x32c83a=a1_0x32c8();return a1_0x1915=function(_0x191548,_0x4f0291){_0x191548=_0x191548-0x99;let _0x398338=_0x32c83a[_0x191548];return _0x398338;},a1_0x1915(_0x19863c,_0x4e82be);}import a1_0x556f31 from'@/lib/stripe';import a1_0xbbc1b6 from'@/lib/baseUrl';import{urlFor}from'@/sanity/lib/image';import a1_0x220450 from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createStripeCheckout(_0x3ad79c,_0x3e66d1){const _0x1a7ecd=a1_0x1915;try{const _0x3cfaa6=await a1_0x220450(_0x3ad79c),_0x42e416=await(await clerkClient())['users']['getUser'](_0x3e66d1),{emailAddresses:_0x310af3,firstName:_0x16c220,lastName:_0x41b014,imageUrl:_0x431649}=_0x42e416,_0x5b7632=_0x310af3[0x0]?.['emailAddress'];if(!_0x310af3||!_0x5b7632)return{'type':'redirect','data':null,'error':'User\x20details\x20not\x20found'};if(!_0x3cfaa6)return{'type':'redirect','data':null,'error':'Course\x20not\x20found'};const _0x19e712=await createStudentIfNotExists({'clerkId':_0x3e66d1,'email':_0x5b7632||'','firstName':_0x16c220||_0x5b7632,'lastName':_0x41b014||'','imageUrl':_0x431649||''});if(!_0x19e712)return{'type':'redirect','data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x3cfaa6['price']===undefined||_0x3cfaa6['price']===null)return{'type':'redirect','data':null,'error':_0x1a7ecd(0x9b)};const {title:_0x54aed6,description:_0x4f7f6d,image:_0x3a6e09,slug:_0xb9ed14}=_0x3cfaa6;if(!_0x54aed6||!_0x4f7f6d||!_0x3a6e09||!_0xb9ed14?.['current'])return{'type':'redirect','data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0x3cfaa6['price']===0x0)return await createEnrollment({'studentId':_0x19e712['_id'],'courseId':_0x3cfaa6[_0x1a7ecd(0x9a)],'paymentId':_0x1a7ecd(0x9e)+Date['now'](),'paymentProvider':'stripe','amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0x3cfaa6['_id']};const _0x56ec6f=Math['round'](_0x3cfaa6['price']*0x64),_0x51b97e=await a1_0x556f31['checkout']['sessions'][_0x1a7ecd(0x9f)]({'line_items':[{'price_data':{'currency':'usd','product_data':{'name':_0x54aed6,'description':_0x4f7f6d,'images':[urlFor(_0x3a6e09)['url']()||'']},'unit_amount':_0x56ec6f},'quantity':0x1}],'mode':'payment','success_url':a1_0xbbc1b6+'/payment/success?payment_success=stripe&type=course','cancel_url':a1_0xbbc1b6+'/payment/failed?provider=stripe&type=course&reason=Payment\x20cancelled\x20by\x20user','metadata':{'courseId':_0x3cfaa6['_id'],'userId':_0x3e66d1,'sanityStudentId':_0x19e712['_id']}});if(!_0x51b97e['url'])return{'type':'url','data':null,'error':'Could\x20not\x20create\x20Stripe\x20session\x20URL.'};return{'type':'url','data':_0x51b97e['url']};}catch(_0x42338f){return console['error']('Error\x20in\x20createStripeCheckout:',_0x42338f),{'type':'redirect','data':null,'error':'Failed\x20to\x20create\x20Stripe\x20checkout\x20session:\x20'+(_0x42338f instanceof Error?_0x42338f['message']:'Unknown\x20error')};}}
