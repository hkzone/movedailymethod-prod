"use server";

'use server';function a1_0x5b49(_0x4ba884,_0x379df5){const _0x20e3f2=a1_0x20e3();return a1_0x5b49=function(_0x5b4921,_0x28bfad){_0x5b4921=_0x5b4921-0x1c5;let _0x424b33=_0x20e3f2[_0x5b4921];return _0x424b33;},a1_0x5b49(_0x4ba884,_0x379df5);}(function(_0x16b5a0,_0x1c407b){const _0x3a0a50=a1_0x5b49,_0x5adc6b=_0x16b5a0();while(!![]){try{const _0x4cec29=-parseInt(_0x3a0a50(0x1ca))/0x1*(parseInt(_0x3a0a50(0x1d4))/0x2)+parseInt(_0x3a0a50(0x1c9))/0x3+-parseInt(_0x3a0a50(0x1c7))/0x4*(-parseInt(_0x3a0a50(0x1cf))/0x5)+-parseInt(_0x3a0a50(0x1c6))/0x6*(-parseInt(_0x3a0a50(0x1cc))/0x7)+parseInt(_0x3a0a50(0x1ce))/0x8*(parseInt(_0x3a0a50(0x1d1))/0x9)+-parseInt(_0x3a0a50(0x1d5))/0xa*(-parseInt(_0x3a0a50(0x1d7))/0xb)+parseInt(_0x3a0a50(0x1cd))/0xc*(-parseInt(_0x3a0a50(0x1c8))/0xd);if(_0x4cec29===_0x1c407b)break;else _0x5adc6b['push'](_0x5adc6b['shift']());}catch(_0x4a2063){_0x5adc6b['push'](_0x5adc6b['shift']());}}}(a1_0x20e3,0x1ffa6));import a1_0xc19a65 from'@/lib/stripe';function a1_0x20e3(){const _0x30d09d=['_id','32593qddLTa','redirect','6MjFJMz','79236WBwvAZ','39nknOhm','700779KYayoE','4911KSHLEx','Course\x20data\x20is\x20incomplete','1699733VPNaHe','1955508erIlzj','19112qGQtnR','45CwLfJF','emailAddress','279OlhJao','/payment/failed?provider=stripe&type=course&reason=Payment\x20cancelled\x20by\x20user','stripe','54QHLwwk','80mGLdos'];a1_0x20e3=function(){return _0x30d09d;};return a1_0x20e3();}import a1_0x5eb933 from'@/lib/baseUrl';import{urlFor}from'@/sanity/lib/image';import a1_0x7d00c3 from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createStripeCheckout(_0x38d300,_0x4b2712){const _0x5bb480=a1_0x5b49;try{const _0x3ec576=await a1_0x7d00c3(_0x38d300),_0x177c2c=await(await clerkClient())['users']['getUser'](_0x4b2712),{emailAddresses:_0x54dbd4,firstName:_0x5b20bd,lastName:_0x1197ea,imageUrl:_0x1c56da}=_0x177c2c,_0x1c0f04=_0x54dbd4[0x0]?.[_0x5bb480(0x1d0)];if(!_0x54dbd4||!_0x1c0f04)return{'type':'redirect','data':null,'error':'User\x20details\x20not\x20found'};if(!_0x3ec576)return{'type':'redirect','data':null,'error':'Course\x20not\x20found'};const _0x19f9bb=await createStudentIfNotExists({'clerkId':_0x4b2712,'email':_0x1c0f04||'','firstName':_0x5b20bd||_0x1c0f04,'lastName':_0x1197ea||'','imageUrl':_0x1c56da||''});if(!_0x19f9bb)return{'type':'redirect','data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x3ec576['price']===undefined||_0x3ec576['price']===null)return{'type':'redirect','data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0x1191d1,description:_0x2f1232,image:_0x3e4f31,slug:_0x40dba1}=_0x3ec576;if(!_0x1191d1||!_0x2f1232||!_0x3e4f31||!_0x40dba1?.['current'])return{'type':'redirect','data':null,'error':_0x5bb480(0x1cb)};if(_0x3ec576['price']===0x0)return await createEnrollment({'studentId':_0x19f9bb[_0x5bb480(0x1d6)],'courseId':_0x3ec576[_0x5bb480(0x1d6)],'paymentId':'free_stripe_'+Date['now'](),'paymentProvider':_0x5bb480(0x1d3),'amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0x3ec576[_0x5bb480(0x1d6)]};const _0x7bd078=Math['round'](_0x3ec576['price']*0x64),_0x541b9c=await a1_0xc19a65['checkout']['sessions']['create']({'line_items':[{'price_data':{'currency':'usd','product_data':{'name':_0x1191d1,'description':_0x2f1232,'images':[urlFor(_0x3e4f31)['url']()||'']},'unit_amount':_0x7bd078},'quantity':0x1}],'mode':'payment','success_url':a1_0x5eb933+'/payment/success?payment_success=stripe&type=course','cancel_url':a1_0x5eb933+_0x5bb480(0x1d2),'metadata':{'courseId':_0x3ec576['_id'],'userId':_0x4b2712,'sanityStudentId':_0x19f9bb['_id']}});if(!_0x541b9c['url'])return{'type':'url','data':null,'error':'Could\x20not\x20create\x20Stripe\x20session\x20URL.'};return{'type':'url','data':_0x541b9c['url']};}catch(_0x348b75){return console['error']('Error\x20in\x20createStripeCheckout:',_0x348b75),{'type':_0x5bb480(0x1c5),'data':null,'error':'Failed\x20to\x20create\x20Stripe\x20checkout\x20session:\x20'+(_0x348b75 instanceof Error?_0x348b75['message']:'Unknown\x20error')};}}
