"use server";

'use server';(function(_0x5eb6ef,_0x1fdb96){const _0x28c245=a1_0x3bb8,_0x4da9c5=_0x5eb6ef();while(!![]){try{const _0x1a9149=parseInt(_0x28c245(0xae))/0x1*(parseInt(_0x28c245(0xb2))/0x2)+-parseInt(_0x28c245(0xb8))/0x3*(-parseInt(_0x28c245(0xb6))/0x4)+parseInt(_0x28c245(0xb0))/0x5*(parseInt(_0x28c245(0xaf))/0x6)+parseInt(_0x28c245(0xb1))/0x7*(parseInt(_0x28c245(0xac))/0x8)+parseInt(_0x28c245(0xab))/0x9+parseInt(_0x28c245(0xb3))/0xa*(parseInt(_0x28c245(0xb5))/0xb)+-parseInt(_0x28c245(0xb9))/0xc;if(_0x1a9149===_0x1fdb96)break;else _0x4da9c5['push'](_0x4da9c5['shift']());}catch(_0x2842c7){_0x4da9c5['push'](_0x4da9c5['shift']());}}}(a1_0x3c94,0x4adda));function a1_0x3c94(){const _0x112003=['price','22MuDLCk','227132mJsSoG','getUser','21mwmpOs','18610008pXWvVD','975753GkacEb','16RTgGeF','url','52FvKgGe','99780EINLLg','125JrLVpp','1595454czpcmY','16846IZHaOW','209980KYkoQA'];a1_0x3c94=function(){return _0x112003;};return a1_0x3c94();}function a1_0x3bb8(_0x4e2140,_0x21bc4b){const _0x3c9473=a1_0x3c94();return a1_0x3bb8=function(_0x3bb8d2,_0x3e4990){_0x3bb8d2=_0x3bb8d2-0xab;let _0x8873f0=_0x3c9473[_0x3bb8d2];return _0x8873f0;},a1_0x3bb8(_0x4e2140,_0x21bc4b);}import a1_0x2078fc from'@/lib/stripe';import a1_0x578a3a from'@/lib/baseUrl';import{urlFor}from'@/sanity/lib/image';import a1_0x4d2aa6 from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createStripeCheckout(_0x5ddc65,_0x5a7ae8){const _0x86f3b8=a1_0x3bb8;try{const _0x5d090b=await a1_0x4d2aa6(_0x5ddc65),_0x132e74=await(await clerkClient())['users'][_0x86f3b8(0xb7)](_0x5a7ae8),{emailAddresses:_0x354eba,firstName:_0x5dc788,lastName:_0x32bd0a,imageUrl:_0x581ad3}=_0x132e74,_0x116bcd=_0x354eba[0x0]?.['emailAddress'];if(!_0x354eba||!_0x116bcd)return{'type':'redirect','data':null,'error':'User\x20details\x20not\x20found'};if(!_0x5d090b)return{'type':'redirect','data':null,'error':'Course\x20not\x20found'};const _0x19bac8=await createStudentIfNotExists({'clerkId':_0x5a7ae8,'email':_0x116bcd||'','firstName':_0x5dc788||_0x116bcd,'lastName':_0x32bd0a||'','imageUrl':_0x581ad3||''});if(!_0x19bac8)return{'type':'redirect','data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x5d090b['price']===undefined||_0x5d090b['price']===null)return{'type':'redirect','data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0xb0219a,description:_0x590017,image:_0x20dcf6,slug:_0x478c6d}=_0x5d090b;if(!_0xb0219a||!_0x590017||!_0x20dcf6||!_0x478c6d?.['current'])return{'type':'redirect','data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0x5d090b['price']===0x0)return await createEnrollment({'studentId':_0x19bac8['_id'],'courseId':_0x5d090b['_id'],'paymentId':'free_stripe_'+Date['now'](),'paymentProvider':'stripe','amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0x5d090b['_id']};const _0x2f085=Math['round'](_0x5d090b[_0x86f3b8(0xb4)]*0x64),_0x270300=await a1_0x2078fc['checkout']['sessions']['create']({'line_items':[{'price_data':{'currency':'usd','product_data':{'name':_0xb0219a,'description':_0x590017,'images':[urlFor(_0x20dcf6)['url']()||'']},'unit_amount':_0x2f085},'quantity':0x1}],'mode':'payment','success_url':a1_0x578a3a+'/payment/success?payment_success=stripe&type=course','cancel_url':a1_0x578a3a+'/payment/failed?provider=stripe&type=course&reason=Payment\x20cancelled\x20by\x20user','metadata':{'courseId':_0x5d090b['_id'],'userId':_0x5a7ae8,'sanityStudentId':_0x19bac8['_id']}});if(!_0x270300[_0x86f3b8(0xad)])return{'type':'url','data':null,'error':'Could\x20not\x20create\x20Stripe\x20session\x20URL.'};return{'type':'url','data':_0x270300['url']};}catch(_0x3ab8de){return console['error']('Error\x20in\x20createStripeCheckout:',_0x3ab8de),{'type':'redirect','data':null,'error':'Failed\x20to\x20create\x20Stripe\x20checkout\x20session:\x20'+(_0x3ab8de instanceof Error?_0x3ab8de['message']:'Unknown\x20error')};}}
