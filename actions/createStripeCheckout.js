"use server";

'use server';(function(_0x3257d3,_0x591376){const _0x4fd9c5=a0_0x5512,_0x233b11=_0x3257d3();while(!![]){try{const _0x51e9b9=-parseInt(_0x4fd9c5(0x6e))/0x1+parseInt(_0x4fd9c5(0x78))/0x2+parseInt(_0x4fd9c5(0x83))/0x3*(-parseInt(_0x4fd9c5(0x8a))/0x4)+-parseInt(_0x4fd9c5(0x82))/0x5+parseInt(_0x4fd9c5(0x7d))/0x6+parseInt(_0x4fd9c5(0x8d))/0x7+-parseInt(_0x4fd9c5(0x7b))/0x8*(-parseInt(_0x4fd9c5(0x6d))/0x9);if(_0x51e9b9===_0x591376)break;else _0x233b11['push'](_0x233b11['shift']());}catch(_0x8c69a5){_0x233b11['push'](_0x233b11['shift']());}}}(a0_0x4a2e,0xbe44f));import a0_0x1a1de2 from'@/lib/stripe';import a0_0x4b1d5a from'@/lib/baseUrl';function a0_0x5512(_0x585f0b,_0x10faba){const _0x4a2eff=a0_0x4a2e();return a0_0x5512=function(_0x551225,_0x4cfd63){_0x551225=_0x551225-0x6d;let _0x4c5a11=_0x4a2eff[_0x551225];if(a0_0x5512['aplTJr']===undefined){var _0x25fd30=function(_0x1a1de2){const _0x4b1d5a='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x191b3a='',_0x4db3b1='';for(let _0x4484e1=0x0,_0x1d874f,_0x1bfc9a,_0x430feb=0x0;_0x1bfc9a=_0x1a1de2['charAt'](_0x430feb++);~_0x1bfc9a&&(_0x1d874f=_0x4484e1%0x4?_0x1d874f*0x40+_0x1bfc9a:_0x1bfc9a,_0x4484e1++%0x4)?_0x191b3a+=String['fromCharCode'](0xff&_0x1d874f>>(-0x2*_0x4484e1&0x6)):0x0){_0x1bfc9a=_0x4b1d5a['indexOf'](_0x1bfc9a);}for(let _0xb275d7=0x0,_0x40a35b=_0x191b3a['length'];_0xb275d7<_0x40a35b;_0xb275d7++){_0x4db3b1+='%'+('00'+_0x191b3a['charCodeAt'](_0xb275d7)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4db3b1);};a0_0x5512['cWsXjO']=_0x25fd30,_0x585f0b=arguments,a0_0x5512['aplTJr']=!![];}const _0x176d4e=_0x4a2eff[0x0],_0x1b6217=_0x551225+_0x176d4e,_0x1fcf3d=_0x585f0b[_0x1b6217];return!_0x1fcf3d?(_0x4c5a11=a0_0x5512['cWsXjO'](_0x4c5a11),_0x585f0b[_0x1b6217]=_0x4c5a11):_0x4c5a11=_0x1fcf3d,_0x4c5a11;},a0_0x5512(_0x585f0b,_0x10faba);}import{urlFor}from'@/sanity/lib/image';import a0_0x191b3a from'@/sanity/lib/courses/getCourseById';function a0_0x4a2e(){const _0x2e5320=['zNjLzv9ZDhjPCgvF','p3bHEw1LBNrFC3vJy2vZCZ1ZDhjPCgu','BwvZC2fNzq','l2rHC2HIB2fYzc9JB3vYC2vZlW','nJeWntC5mejbtfDnrG','mtjxyuLPDhu','zw1HAwXbzgrYzxnZ','x2LK','q291CNnLig5VDcbMB3vUza','DxjS','rxjYB3iGAw4Gy3jLyxrLu3rYAxbLq2HLy2TVDxq6','l2nVDxjZzxmV','mJm2mdG0uu1es0f3','DxnK','q291BgqGBM90ignYzwf0zsbtDhjPCguGC2vZC2LVBIbvuKWU','ndC0mdKZowztrLHqrG','mZu3nZu5ww9qy01m','mZaYntC3seTSqKXx','zxjYB3i','p3bHEw1LBNrFy2fUy2vSzwq9Dhj1zq','vw5RBM93BIbLCNjVCG','C2vZC2LVBNm','y3vYCMvUDa','ChjPy2u','z2v0vxnLCG','CMvKAxjLy3q','vxnLCIbKzxrHAwXZig5VDcbMB3vUza','mJaZmtC0nKv6uezXrW','C3rYAxbL','BM93','odHKBhDtug4','CM91BMq','mJq1mJuWnMvvzev3sW'];a0_0x4a2e=function(){return _0x2e5320;};return a0_0x4a2e();}import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createStripeCheckout(_0x4db3b1,_0x4484e1){const _0x418c42=a0_0x5512;try{const _0x1d874f=await a0_0x191b3a(_0x4db3b1),_0x1bfc9a=await(await clerkClient())['users'][_0x418c42(0x75)](_0x4484e1),{emailAddresses:_0x430feb,firstName:_0xb275d7,lastName:_0x40a35b,imageUrl:_0x4e9cf6}=_0x1bfc9a,_0x12d403=_0x430feb[0x0]?.[_0x418c42(0x84)];if(!_0x430feb||!_0x12d403)return{'type':'redirect','data':null,'error':_0x418c42(0x77)};if(!_0x1d874f)return{'type':'redirect','data':null,'error':_0x418c42(0x86)};const _0x1156e2=await createStudentIfNotExists({'clerkId':_0x4484e1,'email':_0x12d403||'','firstName':_0xb275d7||_0x12d403,'lastName':_0x40a35b||'','imageUrl':_0x4e9cf6||''});if(!_0x1156e2)return{'type':'redirect','data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x1d874f['price']===undefined||_0x1d874f[_0x418c42(0x74)]===null)return{'type':'redirect','data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0x51d9d9,description:_0x3c7e5e,image:_0x28a77e,slug:_0x12370a}=_0x1d874f;if(!_0x51d9d9||!_0x3c7e5e||!_0x28a77e||!_0x12370a?.[_0x418c42(0x73)])return{'type':'redirect','data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0x1d874f['price']===0x0)return await createEnrollment({'studentId':_0x1156e2[_0x418c42(0x85)],'courseId':_0x1d874f['_id'],'paymentId':_0x418c42(0x7e)+Date[_0x418c42(0x7a)](),'paymentProvider':_0x418c42(0x79),'amount':0x0}),{'type':_0x418c42(0x76),'data':_0x418c42(0x81)+_0x1d874f[_0x418c42(0x85)]};const _0x195338=Math[_0x418c42(0x7c)](_0x1d874f[_0x418c42(0x74)]*0x64),_0x307c5c=await a0_0x1a1de2['checkout'][_0x418c42(0x72)]['create']({'line_items':[{'price_data':{'currency':_0x418c42(0x8b),'product_data':{'name':_0x51d9d9,'description':_0x3c7e5e,'images':[urlFor(_0x28a77e)[_0x418c42(0x87)]()||'']},'unit_amount':_0x195338},'quantity':0x1}],'mode':'payment','success_url':a0_0x4b1d5a+'/courses/'+_0x12370a['current']+_0x418c42(0x7f),'cancel_url':a0_0x4b1d5a+_0x418c42(0x89)+_0x12370a['current']+_0x418c42(0x70),'metadata':{'courseId':_0x1d874f['_id'],'userId':_0x4484e1,'sanityStudentId':_0x1156e2['_id']}});if(!_0x307c5c[_0x418c42(0x87)])return{'type':'url','data':null,'error':_0x418c42(0x8c)};return{'type':'url','data':_0x307c5c['url']};}catch(_0x200c98){return console[_0x418c42(0x6f)](_0x418c42(0x88),_0x200c98),{'type':_0x418c42(0x76),'data':null,'error':'Failed\x20to\x20create\x20Stripe\x20checkout\x20session:\x20'+(_0x200c98 instanceof Error?_0x200c98[_0x418c42(0x80)]:_0x418c42(0x71))};}}
