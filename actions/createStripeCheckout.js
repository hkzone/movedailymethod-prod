"use server";

'use server';(function(_0x34e9d4,_0x5b25db){const _0x1d2d86=a1_0x7926,_0x1f260c=_0x34e9d4();while(!![]){try{const _0x3fedd2=parseInt(_0x1d2d86(0x11f))/0x1*(-parseInt(_0x1d2d86(0x128))/0x2)+-parseInt(_0x1d2d86(0x123))/0x3+-parseInt(_0x1d2d86(0x124))/0x4*(-parseInt(_0x1d2d86(0x129))/0x5)+-parseInt(_0x1d2d86(0x127))/0x6*(parseInt(_0x1d2d86(0x11c))/0x7)+-parseInt(_0x1d2d86(0x12c))/0x8+-parseInt(_0x1d2d86(0x12a))/0x9+parseInt(_0x1d2d86(0x122))/0xa*(parseInt(_0x1d2d86(0x125))/0xb);if(_0x3fedd2===_0x5b25db)break;else _0x1f260c['push'](_0x1f260c['shift']());}catch(_0xe2f207){_0x1f260c['push'](_0x1f260c['shift']());}}}(a1_0x4c82,0x1971f));import a1_0x398270 from'@/lib/stripe';import a1_0x1e7412 from'@/lib/baseUrl';import{urlFor}from'@/sanity/lib/image';import a1_0x51a3c7 from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';function a1_0x7926(_0x259994,_0x436a18){const _0x4c82c3=a1_0x4c82();return a1_0x7926=function(_0x792675,_0x4a92a5){_0x792675=_0x792675-0x11c;let _0x1fa51c=_0x4c82c3[_0x792675];return _0x1fa51c;},a1_0x7926(_0x259994,_0x436a18);}import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createStripeCheckout(_0x475e50,_0x41be7d){const _0x9fbe07=a1_0x7926;try{const _0x59b7f5=await a1_0x51a3c7(_0x475e50),_0x24f959=await(await clerkClient())['users']['getUser'](_0x41be7d),{emailAddresses:_0x34b668,firstName:_0x8cbd51,lastName:_0x1f37cd,imageUrl:_0x368a5f}=_0x24f959,_0xfe1e36=_0x34b668[0x0]?.['emailAddress'];if(!_0x34b668||!_0xfe1e36)return{'type':'redirect','data':null,'error':'User\x20details\x20not\x20found'};if(!_0x59b7f5)return{'type':'redirect','data':null,'error':_0x9fbe07(0x121)};const _0x2ee48f=await createStudentIfNotExists({'clerkId':_0x41be7d,'email':_0xfe1e36||'','firstName':_0x8cbd51||_0xfe1e36,'lastName':_0x1f37cd||'','imageUrl':_0x368a5f||''});if(!_0x2ee48f)return{'type':'redirect','data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x59b7f5['price']===undefined||_0x59b7f5[_0x9fbe07(0x120)]===null)return{'type':'redirect','data':null,'error':_0x9fbe07(0x11e)};const {title:_0x2a87e2,description:_0x6badc1,image:_0x5346bb,slug:_0x2ddd0b}=_0x59b7f5;if(!_0x2a87e2||!_0x6badc1||!_0x5346bb||!_0x2ddd0b?.['current'])return{'type':'redirect','data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0x59b7f5['price']===0x0)return await createEnrollment({'studentId':_0x2ee48f['_id'],'courseId':_0x59b7f5['_id'],'paymentId':'free_stripe_'+Date['now'](),'paymentProvider':'stripe','amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0x59b7f5['_id']};const _0x4a31aa=Math[_0x9fbe07(0x11d)](_0x59b7f5['price']*0x64),_0x3aa591=await a1_0x398270['checkout']['sessions'][_0x9fbe07(0x126)]({'line_items':[{'price_data':{'currency':'usd','product_data':{'name':_0x2a87e2,'description':_0x6badc1,'images':[urlFor(_0x5346bb)['url']()||'']},'unit_amount':_0x4a31aa},'quantity':0x1}],'mode':'payment','success_url':a1_0x1e7412+'/payment/success?payment_success=stripe&type=course','cancel_url':a1_0x1e7412+'/payment/failed?provider=stripe&type=course&reason=Payment\x20cancelled\x20by\x20user','metadata':{'courseId':_0x59b7f5['_id'],'userId':_0x41be7d,'sanityStudentId':_0x2ee48f['_id']}});if(!_0x3aa591['url'])return{'type':'url','data':null,'error':'Could\x20not\x20create\x20Stripe\x20session\x20URL.'};return{'type':'url','data':_0x3aa591['url']};}catch(_0x4a343f){return console['error']('Error\x20in\x20createStripeCheckout:',_0x4a343f),{'type':_0x9fbe07(0x12b),'data':null,'error':'Failed\x20to\x20create\x20Stripe\x20checkout\x20session:\x20'+(_0x4a343f instanceof Error?_0x4a343f['message']:'Unknown\x20error')};}}function a1_0x4c82(){const _0x6c064e=['4770095ATWzLf','create','30ThvQme','282556cMeqgl','779565hZQLKU','1307061STitac','redirect','1031896zlTeuK','62041QbarDP','round','Course\x20price\x20is\x20not\x20set','1MztRFy','price','Course\x20not\x20found','10yPvKjc','76578vbVPkN','4AkULSE'];a1_0x4c82=function(){return _0x6c064e;};return a1_0x4c82();}
