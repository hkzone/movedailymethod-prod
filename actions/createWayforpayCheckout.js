"use server";

'use server';(function(_0x5e9af2,_0x3daff9){const _0x317fd1=a3_0xe995,_0x3fb845=_0x5e9af2();while(!![]){try{const _0x856376=parseInt(_0x317fd1(0x1f2))/0x1*(-parseInt(_0x317fd1(0x1f4))/0x2)+-parseInt(_0x317fd1(0x1f0))/0x3+-parseInt(_0x317fd1(0x1f1))/0x4*(parseInt(_0x317fd1(0x1f8))/0x5)+parseInt(_0x317fd1(0x1f7))/0x6+parseInt(_0x317fd1(0x1f3))/0x7*(parseInt(_0x317fd1(0x1ef))/0x8)+parseInt(_0x317fd1(0x1ee))/0x9*(parseInt(_0x317fd1(0x1eb))/0xa)+parseInt(_0x317fd1(0x1ea))/0xb;if(_0x856376===_0x3daff9)break;else _0x3fb845['push'](_0x3fb845['shift']());}catch(_0x2b355d){_0x3fb845['push'](_0x3fb845['shift']());}}}(a3_0x5efc,0xcaed9));import{Wayforpay}from'wayforpay-ts-integration';import a3_0xa91a0a from'@/lib/baseUrl';function a3_0x5efc(){const _0x14e9c8=['domain','5942838QotSyw','1047715sxNgWS','14529174PoqBCB','20BvLZUh','WAYFORPAY_MERCHANT_SECRET_KEY','WAYFORPAY_MERCHANT_LOGIN','3178206KEqwks','272XSVlND','1810641qyQuYq','24eYhQfW','30473XxcCkR','165102JBnZGT','74GSvUJG','wayforpay'];a3_0x5efc=function(){return _0x14e9c8;};return a3_0x5efc();}import a3_0xc382c9 from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';function a3_0xe995(_0x3d9521,_0x4fedbb){const _0x5efccb=a3_0x5efc();return a3_0xe995=function(_0xe9957,_0x568334){_0xe9957=_0xe9957-0x1ea;let _0x126230=_0x5efccb[_0xe9957];return _0x126230;},a3_0xe995(_0x3d9521,_0x4fedbb);}import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createWayforpayCheckout(_0x57425c,_0x4dc4a7){const _0x42ceac=a3_0xe995;try{const [_0x2dd873,_0x2a3221]=await Promise['all']([a3_0xc382c9(_0x57425c),(await clerkClient())['users']['getUser'](_0x4dc4a7)]),{emailAddresses:_0x36ec03,firstName:_0x196271,lastName:_0x554df9,imageUrl:_0x3df0dc}=_0x2a3221,_0x1cdea5=_0x36ec03[0x0]?.['emailAddress'];if(!_0x36ec03||!_0x1cdea5)return{'type':'redirect','data':null,'error':'User\x20details\x20not\x20found'};if(!_0x2dd873)return{'type':'redirect','data':null,'error':'Course\x20not\x20found'};const _0x31f1bf=await createStudentIfNotExists({'clerkId':_0x4dc4a7,'email':_0x1cdea5||'','firstName':_0x196271||_0x1cdea5,'lastName':_0x554df9||'','imageUrl':_0x3df0dc||''});if(!_0x31f1bf)return{'type':'redirect','data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x2dd873['price']===undefined||_0x2dd873['price']===null)return{'type':'redirect','data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0xda5b81,description:_0x2d5101,image:_0x4abbcd,slug:_0x4a342f}=_0x2dd873;if(!_0xda5b81||!_0x2d5101||!_0x4abbcd||!_0x4a342f?.['current'])return{'type':'redirect','data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0x2dd873['price']===0x0)return await createEnrollment({'studentId':_0x31f1bf['_id'],'courseId':_0x2dd873['_id'],'paymentId':'free_wayforpay_'+Date['now'](),'paymentProvider':_0x42ceac(0x1f5),'amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0x2dd873['_id']};const _0x2a009a={'merchantLogin':process['env'][_0x42ceac(0x1ed)],'merchantSecret':process['env'][_0x42ceac(0x1ec)],'domain':process['env']['WAYFORPAY_DOMAIN'],'currency':process['env']['WAYFORPAY_CURRENCY']};if(!_0x2a009a['merchantLogin']||!_0x2a009a['merchantSecret']||!_0x2a009a['domain']||!_0x2a009a['currency'])return{'type':'redirect','data':null,'error':'WayForPay environment variables are not properly configured.'};const _0x9ffb22=_0x2dd873['_id']+'--'+_0x4dc4a7+'--'+Date['now'](),_0x4a436d=[{'product':{'name':_0xda5b81,'price':_0x2dd873['price']},'quantity':0x1}],_0x3c3357=new Wayforpay({'merchantLogin':_0x2a009a['merchantLogin'],'merchantSecret':_0x2a009a['merchantSecret']}),_0x31e115=await _0x3c3357['purchase'](_0x4a436d,{'domain':_0x2a009a[_0x42ceac(0x1f6)],'orderReference':_0x9ffb22,'currency':_0x2a009a['currency'],'returnUrl':a3_0xa91a0a+'/payment/redirect?provider=wayforpay&type=course&order='+_0x9ffb22,'serviceUrl':a3_0xa91a0a+'/api/wayforpay/webhook','clientFirstName':_0x196271||undefined,'clientLastName':_0x554df9||undefined,'clientEmail':_0x1cdea5||undefined});return{'type':'form','data':_0x31e115};}catch(_0x52ae56){return console['error']('Error\x20in\x20createWayforpayCheckout:',_0x52ae56),{'type':'redirect','data':null,'error':'Failed\x20to\x20create\x20WayForPay\x20checkout:\x20'+(_0x52ae56 instanceof Error?_0x52ae56['message']:'Unknown\x20error')};}}
