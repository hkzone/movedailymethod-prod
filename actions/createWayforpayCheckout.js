"use server";

'use server';(function(_0x4f62d3,_0x5d7765){const _0x38060d=a3_0x2ae2,_0x3f3650=_0x4f62d3();while(!![]){try{const _0x15b05b=-parseInt(_0x38060d(0x10a))/0x1*(parseInt(_0x38060d(0x110))/0x2)+parseInt(_0x38060d(0x10f))/0x3*(-parseInt(_0x38060d(0x107))/0x4)+parseInt(_0x38060d(0x10b))/0x5*(-parseInt(_0x38060d(0x105))/0x6)+-parseInt(_0x38060d(0x104))/0x7+-parseInt(_0x38060d(0x108))/0x8*(-parseInt(_0x38060d(0x10e))/0x9)+parseInt(_0x38060d(0x106))/0xa+parseInt(_0x38060d(0x111))/0xb;if(_0x15b05b===_0x5d7765)break;else _0x3f3650['push'](_0x3f3650['shift']());}catch(_0x196bd8){_0x3f3650['push'](_0x3f3650['shift']());}}}(a3_0x56e8,0xdb613));import{Wayforpay}from'wayforpay-ts-integration';function a3_0x2ae2(_0xd9ec83,_0x1d342e){const _0x56e89a=a3_0x56e8();return a3_0x2ae2=function(_0x2ae241,_0x59f30f){_0x2ae241=_0x2ae241-0x104;let _0x2d0be9=_0x56e89a[_0x2ae241];return _0x2d0be9;},a3_0x2ae2(_0xd9ec83,_0x1d342e);}function a3_0x56e8(){const _0x546bc0=['10889305xXjohM','25716GWsphj','2077370VCiRqo','4hQRKID','2059864aCQCji','redirect','529164FwAmIE','1895OxmiiN','price','error','45aOTcTL','2026317ssYzPO','2IOMSed','41668429iqyBGI'];a3_0x56e8=function(){return _0x546bc0;};return a3_0x56e8();}import a3_0x231554 from'@/lib/baseUrl';import a3_0xfe658a from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createWayforpayCheckout(_0x2c9b30,_0x58f358){const _0x1c3998=a3_0x2ae2;try{const [_0x2334b7,_0x1c61e6]=await Promise['all']([a3_0xfe658a(_0x2c9b30),(await clerkClient())['users']['getUser'](_0x58f358)]),{emailAddresses:_0x178110,firstName:_0xd34c1e,lastName:_0x12d6e5,imageUrl:_0x2ed1d5}=_0x1c61e6,_0x197b89=_0x178110[0x0]?.['emailAddress'];if(!_0x178110||!_0x197b89)return{'type':'redirect','data':null,'error':'User\x20details\x20not\x20found'};if(!_0x2334b7)return{'type':'redirect','data':null,'error':'Course\x20not\x20found'};const _0x1f6698=await createStudentIfNotExists({'clerkId':_0x58f358,'email':_0x197b89||'','firstName':_0xd34c1e||_0x197b89,'lastName':_0x12d6e5||'','imageUrl':_0x2ed1d5||''});if(!_0x1f6698)return{'type':_0x1c3998(0x109),'data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x2334b7['price']===undefined||_0x2334b7[_0x1c3998(0x10c)]===null)return{'type':'redirect','data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0x40eadd,description:_0x4246c4,image:_0x4554fc,slug:_0x39b55e}=_0x2334b7;if(!_0x40eadd||!_0x4246c4||!_0x4554fc||!_0x39b55e?.['current'])return{'type':'redirect','data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0x2334b7['price']===0x0)return await createEnrollment({'studentId':_0x1f6698['_id'],'courseId':_0x2334b7['_id'],'paymentId':'free_wayforpay_'+Date['now'](),'paymentProvider':'wayforpay','amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0x2334b7['_id']};const _0x2cbcd9={'merchantLogin':process['env']['WAYFORPAY_MERCHANT_LOGIN'],'merchantSecret':process['env']['WAYFORPAY_MERCHANT_SECRET_KEY'],'domain':process['env']['WAYFORPAY_DOMAIN'],'currency':process['env']['WAYFORPAY_CURRENCY']};if(!_0x2cbcd9['merchantLogin']||!_0x2cbcd9['merchantSecret']||!_0x2cbcd9['domain']||!_0x2cbcd9['currency'])return{'type':'redirect','data':null,'error':'WayForPay environment variables are not properly configured.'};const _0x276a99=_0x2334b7['_id']+'--'+_0x58f358+'--'+Date['now'](),_0xb8002=[{'product':{'name':_0x40eadd,'price':_0x2334b7['price']},'quantity':0x1}],_0x139ffc=new Wayforpay({'merchantLogin':_0x2cbcd9['merchantLogin'],'merchantSecret':_0x2cbcd9['merchantSecret']}),_0x5cc2c9=await _0x139ffc['purchase'](_0xb8002,{'domain':_0x2cbcd9['domain'],'orderReference':_0x276a99,'currency':_0x2cbcd9['currency'],'returnUrl':a3_0x231554+'/payment/redirect?provider=wayforpay&type=course&order='+_0x276a99,'serviceUrl':a3_0x231554+'/api/wayforpay/webhook','clientFirstName':_0xd34c1e||undefined,'clientLastName':_0x12d6e5||undefined,'clientEmail':_0x197b89||undefined});return{'type':'form','data':_0x5cc2c9};}catch(_0x203ee9){return console[_0x1c3998(0x10d)]('Error\x20in\x20createWayforpayCheckout:',_0x203ee9),{'type':'redirect','data':null,'error':'Failed\x20to\x20create\x20WayForPay\x20checkout:\x20'+(_0x203ee9 instanceof Error?_0x203ee9['message']:'Unknown\x20error')};}}
