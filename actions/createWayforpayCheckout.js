"use server";

'use server';(function(_0x3376f2,_0x4c74fe){const _0x692335=a1_0x1a10,_0x38d717=_0x3376f2();while(!![]){try{const _0x3d0eae=-parseInt(_0x692335(0x152))/0x1*(parseInt(_0x692335(0x14a))/0x2)+-parseInt(_0x692335(0x154))/0x3*(-parseInt(_0x692335(0x14f))/0x4)+parseInt(_0x692335(0x14c))/0x5*(parseInt(_0x692335(0x156))/0x6)+-parseInt(_0x692335(0x14b))/0x7+parseInt(_0x692335(0x155))/0x8+parseInt(_0x692335(0x150))/0x9*(parseInt(_0x692335(0x158))/0xa)+parseInt(_0x692335(0x149))/0xb*(-parseInt(_0x692335(0x159))/0xc);if(_0x3d0eae===_0x4c74fe)break;else _0x38d717['push'](_0x38d717['shift']());}catch(_0x1fa199){_0x38d717['push'](_0x38d717['shift']());}}}(a1_0x13dd,0xe45da));import{Wayforpay}from'wayforpay-ts-integration';import a1_0x14c516 from'@/lib/baseUrl';import a1_0x578ef4 from'@/sanity/lib/courses/getCourseById';function a1_0x1a10(_0x48fc9f,_0x201e91){const _0x13ddb1=a1_0x13dd();return a1_0x1a10=function(_0x1a10c9,_0x1d2670){_0x1a10c9=_0x1a10c9-0x147;let _0x17d510=_0x13ddb1[_0x1a10c9];return _0x17d510;},a1_0x1a10(_0x48fc9f,_0x201e91);}function a1_0x13dd(){const _0x504969=['User\x20details\x20not\x20found','1137YLtOuQ','9143224wZvwzh','8854596KMjjrh','WAYFORPAY_CURRENCY','3710ylbyBC','7860liLqXH','WAYFORPAY_MERCHANT_LOGIN','current','30657AqrMUO','26IxaoAQ','8101751ftRaSk','5ahXzPv','Course\x20not\x20found','env','18268mOpkzt','6372JPXSIf','form','53382XJndBk'];a1_0x13dd=function(){return _0x504969;};return a1_0x13dd();}import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createWayforpayCheckout(_0x2a0ba2,_0x86225){const _0x90f065=a1_0x1a10;try{const _0x2d12e0=await a1_0x578ef4(_0x2a0ba2),_0x463edd=await(await clerkClient())['users']['getUser'](_0x86225),{emailAddresses:_0x30ff6c,firstName:_0x109553,lastName:_0x5e522a,imageUrl:_0x41c570}=_0x463edd,_0x2a3b94=_0x30ff6c[0x0]?.['emailAddress'];if(!_0x30ff6c||!_0x2a3b94)return{'type':'redirect','data':null,'error':_0x90f065(0x153)};if(!_0x2d12e0)return{'type':'redirect','data':null,'error':_0x90f065(0x14d)};const _0x36ea45=await createStudentIfNotExists({'clerkId':_0x86225,'email':_0x2a3b94||'','firstName':_0x109553||_0x2a3b94,'lastName':_0x5e522a||'','imageUrl':_0x41c570||''});if(!_0x36ea45)return{'type':'redirect','data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x2d12e0['price']===undefined||_0x2d12e0['price']===null)return{'type':'redirect','data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0x486f87,description:_0x274aec,image:_0x1d12c5,slug:_0x1c7de8}=_0x2d12e0;if(!_0x486f87||!_0x274aec||!_0x1d12c5||!_0x1c7de8?.[_0x90f065(0x148)])return{'type':'redirect','data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0x2d12e0['price']===0x0)return await createEnrollment({'studentId':_0x36ea45['_id'],'courseId':_0x2d12e0['_id'],'paymentId':'free_wayforpay_'+Date['now'](),'paymentProvider':'wayforpay','amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0x2d12e0['_id']};if(!process[_0x90f065(0x14e)]['WAYFORPAY_MERCHANT_LOGIN']||!process['env']['WAYFORPAY_MERCHANT_SECRET_KEY']||!process['env']['WAYFORPAY_DOMAIN']||!process['env']['WAYFORPAY_CURRENCY'])return{'type':'redirect','data':null,'error':'WayForPay\x20environment\x20variables\x20are\x20not\x20properly\x20configured.'};const _0x21f781=new Wayforpay({'merchantLogin':process['env'][_0x90f065(0x147)],'merchantSecret':process['env']['WAYFORPAY_MERCHANT_SECRET_KEY']}),_0x130ba1=_0x2d12e0['_id']+'_'+_0x86225+'_'+Date['now'](),_0x3af12c=[{'product':{'name':_0x486f87,'price':_0x2d12e0['price']},'quantity':0x1}],_0x37f8a8=await _0x21f781['purchase'](_0x3af12c,{'domain':process['env']['WAYFORPAY_DOMAIN'],'orderReference':_0x130ba1,'currency':process['env'][_0x90f065(0x157)],'returnUrl':a1_0x14c516+'/courses/'+_0x1c7de8['current']+'?payment_success=wayforpay','serviceUrl':a1_0x14c516+'/api/wayforpay/webhook','clientFirstName':_0x109553||undefined,'clientLastName':_0x5e522a||undefined,'clientEmail':_0x2a3b94||undefined});return{'type':_0x90f065(0x151),'data':_0x37f8a8};}catch(_0x86109c){return console['error']('Error\x20in\x20createWayforpayCheckout:',_0x86109c),{'type':'redirect','data':null,'error':'Failed\x20to\x20create\x20WayForPay\x20checkout:\x20'+(_0x86109c instanceof Error?_0x86109c['message']:'Unknown\x20error')};}}
