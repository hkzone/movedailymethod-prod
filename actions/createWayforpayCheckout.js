"use server";

'use server';(function(_0x431b22,_0xe2d78d){const _0x184f03=a1_0x3de5,_0x4681f3=_0x431b22();while(!![]){try{const _0x57b94c=parseInt(_0x184f03(0x1fb))/0x1*(parseInt(_0x184f03(0x1f8))/0x2)+-parseInt(_0x184f03(0x200))/0x3*(parseInt(_0x184f03(0x1f5))/0x4)+parseInt(_0x184f03(0x1fe))/0x5+parseInt(_0x184f03(0x201))/0x6+parseInt(_0x184f03(0x1fd))/0x7*(-parseInt(_0x184f03(0x1f9))/0x8)+parseInt(_0x184f03(0x202))/0x9*(-parseInt(_0x184f03(0x1fa))/0xa)+parseInt(_0x184f03(0x1f7))/0xb;if(_0x57b94c===_0xe2d78d)break;else _0x4681f3['push'](_0x4681f3['shift']());}catch(_0x1977fc){_0x4681f3['push'](_0x4681f3['shift']());}}}(a1_0x15b6,0x5e30b));function a1_0x15b6(){const _0x509372=['49HtlJYY','602500PNqkVZ','WAYFORPAY_MERCHANT_LOGIN','3FMHbuu','2424342ksPprD','261MjhNCM','form','price','free_wayforpay_','message','1211452ujYEUx','redirect','8784512dIzhPd','237498xodeHP','271192Tdunox','177910bDDEAA','1TNJiss','Course\x20not\x20found'];a1_0x15b6=function(){return _0x509372;};return a1_0x15b6();}import{Wayforpay}from'wayforpay-ts-integration';import a1_0x49651d from'@/lib/baseUrl';import a1_0x4ec051 from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';function a1_0x3de5(_0x357afc,_0x3da456){const _0x15b6c3=a1_0x15b6();return a1_0x3de5=function(_0x3de5bf,_0x2a0117){_0x3de5bf=_0x3de5bf-0x1f4;let _0x3c7e80=_0x15b6c3[_0x3de5bf];return _0x3c7e80;},a1_0x3de5(_0x357afc,_0x3da456);}import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createWayforpayCheckout(_0x39c7d5,_0x2a5697){const _0x4e16a1=a1_0x3de5;try{const _0x457b41=await a1_0x4ec051(_0x39c7d5),_0x1193f8=await(await clerkClient())['users']['getUser'](_0x2a5697),{emailAddresses:_0x13520b,firstName:_0x1790f0,lastName:_0x5fa01f,imageUrl:_0x5eb55b}=_0x1193f8,_0x1fad0a=_0x13520b[0x0]?.['emailAddress'];if(!_0x13520b||!_0x1fad0a)return{'type':'redirect','data':null,'error':'User\x20details\x20not\x20found'};if(!_0x457b41)return{'type':'redirect','data':null,'error':_0x4e16a1(0x1fc)};const _0x326185=await createStudentIfNotExists({'clerkId':_0x2a5697,'email':_0x1fad0a||'','firstName':_0x1790f0||_0x1fad0a,'lastName':_0x5fa01f||'','imageUrl':_0x5eb55b||''});if(!_0x326185)return{'type':'redirect','data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x457b41['price']===undefined||_0x457b41['price']===null)return{'type':'redirect','data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0x3bc1cb,description:_0x768ce1,image:_0x16ff39,slug:_0x81ffa1}=_0x457b41;if(!_0x3bc1cb||!_0x768ce1||!_0x16ff39||!_0x81ffa1?.['current'])return{'type':'redirect','data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0x457b41['price']===0x0)return await createEnrollment({'studentId':_0x326185['_id'],'courseId':_0x457b41['_id'],'paymentId':_0x4e16a1(0x205)+Date['now'](),'paymentProvider':'wayforpay','amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0x457b41['_id']};if(!process['env'][_0x4e16a1(0x1ff)]||!process['env']['WAYFORPAY_MERCHANT_SECRET_KEY']||!process['env']['WAYFORPAY_DOMAIN']||!process['env']['WAYFORPAY_CURRENCY'])return{'type':_0x4e16a1(0x1f6),'data':null,'error':'WayForPay environment variables are not properly configured.'};const _0x63c697=new Wayforpay({'merchantLogin':process['env']['WAYFORPAY_MERCHANT_LOGIN'],'merchantSecret':process['env']['WAYFORPAY_MERCHANT_SECRET_KEY']}),_0x3e7e76=_0x457b41['_id']+'_'+_0x2a5697+'_'+Date['now'](),_0x376cca=[{'product':{'name':_0x3bc1cb,'price':_0x457b41[_0x4e16a1(0x204)]},'quantity':0x1}],_0x4b484a=await _0x63c697['purchase'](_0x376cca,{'domain':process['env']['WAYFORPAY_DOMAIN'],'orderReference':_0x3e7e76,'currency':process['env']['WAYFORPAY_CURRENCY'],'returnUrl':a1_0x49651d+'/courses/'+_0x81ffa1['current']+'?payment_success=wayforpay','serviceUrl':a1_0x49651d+'/api/wayforpay/webhook','clientFirstName':_0x1790f0||undefined,'clientLastName':_0x5fa01f||undefined,'clientEmail':_0x1fad0a||undefined});return{'type':_0x4e16a1(0x203),'data':_0x4b484a};}catch(_0x42efdf){return console['error']('Error\x20in\x20createWayforpayCheckout:',_0x42efdf),{'type':'redirect','data':null,'error':'Failed\x20to\x20create\x20WayForPay\x20checkout:\x20'+(_0x42efdf instanceof Error?_0x42efdf[_0x4e16a1(0x1f4)]:'Unknown\x20error')};}}
