"use server";

'use server';(function(_0x4af783,_0x368468){const _0x533f61=a3_0x517d,_0x351737=_0x4af783();while(!![]){try{const _0x209257=parseInt(_0x533f61(0x122))/0x1+-parseInt(_0x533f61(0x11f))/0x2*(parseInt(_0x533f61(0x126))/0x3)+parseInt(_0x533f61(0x121))/0x4+-parseInt(_0x533f61(0x120))/0x5*(-parseInt(_0x533f61(0x11b))/0x6)+-parseInt(_0x533f61(0x11c))/0x7*(parseInt(_0x533f61(0x123))/0x8)+parseInt(_0x533f61(0x11e))/0x9*(-parseInt(_0x533f61(0x124))/0xa)+parseInt(_0x533f61(0x11d))/0xb;if(_0x209257===_0x368468)break;else _0x351737['push'](_0x351737['shift']());}catch(_0x4e034f){_0x351737['push'](_0x351737['shift']());}}}(a3_0x1418,0x20668));function a3_0x517d(_0x306b60,_0x257c41){const _0x1418f3=a3_0x1418();return a3_0x517d=function(_0x517da1,_0x54dbf4){_0x517da1=_0x517da1-0x11b;let _0x1efd23=_0x1418f3[_0x517da1];return _0x1efd23;},a3_0x517d(_0x306b60,_0x257c41);}function a3_0x1418(){const _0x84be19=['181672NBzgKd','16UunOWt','2568210EKDeIa','/payment/redirect?provider=wayforpay&type=course&order=','32457LGucuf','_id','price','Unknown\x20error','form','redirect','153378CZluwu','692419IySfDb','3089427hZiDPJ','9Umkcct','30JoCZGm','30mWKXEt','534980vzquGr'];a3_0x1418=function(){return _0x84be19;};return a3_0x1418();}import{Wayforpay}from'wayforpay-ts-integration';import a3_0x24a23b from'@/lib/baseUrl';import a3_0xf15385 from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createWayforpayCheckout(_0x4f3970,_0x12d0fb){const _0x53e915=a3_0x517d;try{const [_0x5752c3,_0x3ddeb7]=await Promise['all']([a3_0xf15385(_0x4f3970),(await clerkClient())['users']['getUser'](_0x12d0fb)]),{emailAddresses:_0xc972fe,firstName:_0x42f811,lastName:_0x33b589,imageUrl:_0x2b0fcd}=_0x3ddeb7,_0x22428a=_0xc972fe[0x0]?.['emailAddress'];if(!_0xc972fe||!_0x22428a)return{'type':'redirect','data':null,'error':'User\x20details\x20not\x20found'};if(!_0x5752c3)return{'type':'redirect','data':null,'error':'Course\x20not\x20found'};const _0x51bf7a=await createStudentIfNotExists({'clerkId':_0x12d0fb,'email':_0x22428a||'','firstName':_0x42f811||_0x22428a,'lastName':_0x33b589||'','imageUrl':_0x2b0fcd||''});if(!_0x51bf7a)return{'type':_0x53e915(0x12b),'data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x5752c3['price']===undefined||_0x5752c3['price']===null)return{'type':_0x53e915(0x12b),'data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0x5086bc,description:_0x137441,image:_0x1dfeae,slug:_0x2c704b}=_0x5752c3;if(!_0x5086bc||!_0x137441||!_0x1dfeae||!_0x2c704b?.['current'])return{'type':_0x53e915(0x12b),'data':null,'error':'Course\x20data\x20is\x20incomplete'};if(_0x5752c3[_0x53e915(0x128)]===0x0)return await createEnrollment({'studentId':_0x51bf7a[_0x53e915(0x127)],'courseId':_0x5752c3[_0x53e915(0x127)],'paymentId':'free_wayforpay_'+Date['now'](),'paymentProvider':'wayforpay','amount':0x0}),{'type':'redirect','data':'/dashboard/courses/'+_0x5752c3['_id']};const _0x95524c={'merchantLogin':process['env']['WAYFORPAY_MERCHANT_LOGIN'],'merchantSecret':process['env']['WAYFORPAY_MERCHANT_SECRET_KEY'],'domain':process['env']['WAYFORPAY_DOMAIN'],'currency':process['env']['WAYFORPAY_CURRENCY']};if(!_0x95524c['merchantLogin']||!_0x95524c['merchantSecret']||!_0x95524c['domain']||!_0x95524c['currency'])return{'type':'redirect','data':null,'error':'WayForPay environment variables are not properly configured.'};const _0x7a7643=_0x5752c3['_id']+'--'+_0x12d0fb+'--'+Date['now'](),_0x41939f=[{'product':{'name':_0x5086bc,'price':_0x5752c3[_0x53e915(0x128)]},'quantity':0x1}],_0x3f69c4=new Wayforpay({'merchantLogin':_0x95524c['merchantLogin'],'merchantSecret':_0x95524c['merchantSecret']}),_0x286feb=await _0x3f69c4['purchase'](_0x41939f,{'domain':_0x95524c['domain'],'orderReference':_0x7a7643,'currency':_0x95524c['currency'],'returnUrl':a3_0x24a23b+_0x53e915(0x125)+_0x7a7643,'serviceUrl':a3_0x24a23b+'/api/wayforpay/webhook','clientFirstName':_0x42f811||undefined,'clientLastName':_0x33b589||undefined,'clientEmail':_0x22428a||undefined});return{'type':_0x53e915(0x12a),'data':_0x286feb};}catch(_0x2b6f46){return console['error']('Error\x20in\x20createWayforpayCheckout:',_0x2b6f46),{'type':'redirect','data':null,'error':'Failed\x20to\x20create\x20WayForPay\x20checkout:\x20'+(_0x2b6f46 instanceof Error?_0x2b6f46['message']:_0x53e915(0x129))};}}
