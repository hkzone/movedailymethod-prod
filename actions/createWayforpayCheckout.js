"use server";

'use server';(function(_0x558312,_0xbcd8cc){const _0xf50bc1=a1_0x5f55,_0x21d8c5=_0x558312();while(!![]){try{const _0x3a26ad=parseInt(_0xf50bc1(0x180))/0x1+-parseInt(_0xf50bc1(0x199))/0x2*(-parseInt(_0xf50bc1(0x196))/0x3)+parseInt(_0xf50bc1(0x188))/0x4*(-parseInt(_0xf50bc1(0x17c))/0x5)+-parseInt(_0xf50bc1(0x18f))/0x6*(-parseInt(_0xf50bc1(0x18d))/0x7)+-parseInt(_0xf50bc1(0x198))/0x8*(parseInt(_0xf50bc1(0x17f))/0x9)+parseInt(_0xf50bc1(0x193))/0xa*(parseInt(_0xf50bc1(0x197))/0xb)+-parseInt(_0xf50bc1(0x185))/0xc;if(_0x3a26ad===_0xbcd8cc)break;else _0x21d8c5['push'](_0x21d8c5['shift']());}catch(_0x1961ae){_0x21d8c5['push'](_0x21d8c5['shift']());}}}(a1_0x1ae1,0x7c29c));import{Wayforpay}from'wayforpay-ts-integration';import a1_0x1bbda6 from'@/lib/baseUrl';function a1_0x5f55(_0x5e4946,_0x2ea1bc){const _0x1ae1c0=a1_0x1ae1();return a1_0x5f55=function(_0x5f554d,_0x42c80d){_0x5f554d=_0x5f554d-0x17c;let _0x4e7b24=_0x1ae1c0[_0x5f554d];if(a1_0x5f55['dKXtZC']===undefined){var _0x217870=function(_0x1bbda6){const _0x47ef3b='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xf7fdc4='',_0x158a0d='';for(let _0x115495=0x0,_0x25741e,_0x1c8f24,_0x362c1d=0x0;_0x1c8f24=_0x1bbda6['charAt'](_0x362c1d++);~_0x1c8f24&&(_0x25741e=_0x115495%0x4?_0x25741e*0x40+_0x1c8f24:_0x1c8f24,_0x115495++%0x4)?_0xf7fdc4+=String['fromCharCode'](0xff&_0x25741e>>(-0x2*_0x115495&0x6)):0x0){_0x1c8f24=_0x47ef3b['indexOf'](_0x1c8f24);}for(let _0x2fe7bf=0x0,_0x254e9b=_0xf7fdc4['length'];_0x2fe7bf<_0x254e9b;_0x2fe7bf++){_0x158a0d+='%'+('00'+_0xf7fdc4['charCodeAt'](_0x2fe7bf)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x158a0d);};a1_0x5f55['uKkswx']=_0x217870,_0x5e4946=arguments,a1_0x5f55['dKXtZC']=!![];}const _0x2381d2=_0x1ae1c0[0x0],_0x477b8b=_0x5f554d+_0x2381d2,_0x56ab32=_0x5e4946[_0x477b8b];return!_0x56ab32?(_0x4e7b24=a1_0x5f55['uKkswx'](_0x4e7b24),_0x5e4946[_0x477b8b]=_0x4e7b24):_0x4e7b24=_0x56ab32,_0x4e7b24;},a1_0x5f55(_0x5e4946,_0x2ea1bc);}import a1_0x47ef3b from'@/sanity/lib/courses/getCourseById';import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createWayforpayCheckout(_0xf7fdc4,_0x158a0d){const _0x29a1a8=a1_0x5f55;try{const _0x115495=await a1_0x47ef3b(_0xf7fdc4),_0x25741e=await(await clerkClient())[_0x29a1a8(0x189)]['getUser'](_0x158a0d),{emailAddresses:_0x1c8f24,firstName:_0x362c1d,lastName:_0x2fe7bf,imageUrl:_0x254e9b}=_0x25741e,_0x847199=_0x1c8f24[0x0]?.['emailAddress'];if(!_0x1c8f24||!_0x847199)return{'type':'redirect','data':null,'error':_0x29a1a8(0x17d)};if(!_0x115495)return{'type':'redirect','data':null,'error':'Course\x20not\x20found'};const _0x104ccf=await createStudentIfNotExists({'clerkId':_0x158a0d,'email':_0x847199||'','firstName':_0x362c1d||_0x847199,'lastName':_0x2fe7bf||'','imageUrl':_0x254e9b||''});if(!_0x104ccf)return{'type':'redirect','data':null,'error':_0x29a1a8(0x183)};if(_0x115495[_0x29a1a8(0x182)]===undefined||_0x115495[_0x29a1a8(0x182)]===null)return{'type':_0x29a1a8(0x186),'data':null,'error':_0x29a1a8(0x181)};const {title:_0x518395,description:_0x5b4ec5,image:_0x431cae,slug:_0x45e7d8}=_0x115495;if(!_0x518395||!_0x5b4ec5||!_0x431cae||!_0x45e7d8?.[_0x29a1a8(0x18c)])return{'type':'redirect','data':null,'error':_0x29a1a8(0x195)};if(_0x115495['price']===0x0)return await createEnrollment({'studentId':_0x104ccf['_id'],'courseId':_0x115495[_0x29a1a8(0x18a)],'paymentId':'free_wayforpay_'+Date[_0x29a1a8(0x17e)](),'paymentProvider':'wayforpay','amount':0x0}),{'type':_0x29a1a8(0x186),'data':_0x29a1a8(0x18e)+_0x115495[_0x29a1a8(0x18a)]};if(!process['env']['WAYFORPAY_MERCHANT_LOGIN']||!process[_0x29a1a8(0x194)]['WAYFORPAY_MERCHANT_SECRET_KEY']||!process['env'][_0x29a1a8(0x192)]||!process[_0x29a1a8(0x194)][_0x29a1a8(0x19b)])return{'type':_0x29a1a8(0x186),'data':null,'error':'WayForPay\x20environment\x20variables\x20are\x20not\x20properly\x20configured.'};const _0x381d27=new Wayforpay({'merchantLogin':process['env']['WAYFORPAY_MERCHANT_LOGIN'],'merchantSecret':process[_0x29a1a8(0x194)]['WAYFORPAY_MERCHANT_SECRET_KEY']}),_0x4932c5=_0x115495['_id']+'_'+_0x158a0d+'_'+Date[_0x29a1a8(0x17e)](),_0x42db1b=[{'product':{'name':_0x518395,'price':_0x115495['price']},'quantity':0x1}],_0x1f0cf6=await _0x381d27[_0x29a1a8(0x18b)](_0x42db1b,{'domain':process[_0x29a1a8(0x194)]['WAYFORPAY_DOMAIN'],'orderReference':_0x4932c5,'currency':process[_0x29a1a8(0x194)]['WAYFORPAY_CURRENCY'],'returnUrl':a1_0x1bbda6+'/courses/'+_0x45e7d8[_0x29a1a8(0x18c)]+'?payment_success=wayforpay','serviceUrl':a1_0x1bbda6+'/api/wayforpay/webhook','clientFirstName':_0x362c1d||undefined,'clientLastName':_0x2fe7bf||undefined,'clientEmail':_0x847199||undefined});return{'type':_0x29a1a8(0x187),'data':_0x1f0cf6};}catch(_0x4409f7){return console[_0x29a1a8(0x191)](_0x29a1a8(0x190),_0x4409f7),{'type':'redirect','data':null,'error':_0x29a1a8(0x184)+(_0x4409f7 instanceof Error?_0x4409f7['message']:_0x29a1a8(0x19a))};}}function a1_0x1ae1(){const _0x5498f0=['otK4mJe4wvHcENnn','q291CNnLihbYAwnLigLZig5VDcbZzxq','ChjPy2u','u2fUAxr5ihvZzxiGBM90igzVDw5Kig9YignVDwXKig5VDcbIzsbJCMvHDgvK','rMfPBgvKihrVignYzwf0zsbxyxLgB3jqyxKGy2HLy2TVDxq6ia','nJG4nZy0mfzsEgThEq','CMvKAxjLy3q','zM9YBq','oe1XzM9kzG','DxnLCNm','x2LK','ChvYy2HHC2u','y3vYCMvUDa','mJG3sgrpqw5j','l2rHC2HIB2fYzc9JB3vYC2vZlW','mtqYnZm0vwPiA2vO','rxjYB3iGAw4Gy3jLyxrLv2f5zM9YCgf5q2HLy2TVDxq6','zxjYB3i','v0fzrK9suefzx0rptufjtG','mZmWy21iCgnT','zw52','q291CNnLigrHDgeGAxmGAw5JB21WBgv0zq','oti2nZLYz2v6weC','nZCZmtLLAxP2te4','nJGWDwvpC2rn','ngjSt2z6CW','vw5RBM93BIbLCNjVCG','v0fzrK9suefzx0nvuLjftKnz','mtm3mZy5nw5Xz1j4BW','vxnLCIbKzxrHAwXZig5VDcbMB3vUza','BM93','nJCYnJzcyxjXsuS'];a1_0x1ae1=function(){return _0x5498f0;};return a1_0x1ae1();}
