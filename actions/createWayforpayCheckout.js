"use server";

'use server';(function(_0x4f9408,_0x29d878){const _0xd2107a=a1_0x12ea,_0x5f42c4=_0x4f9408();while(!![]){try{const _0x5f507b=-parseInt(_0xd2107a(0x1ee))/0x1*(parseInt(_0xd2107a(0x1de))/0x2)+-parseInt(_0xd2107a(0x1fa))/0x3*(-parseInt(_0xd2107a(0x1fd))/0x4)+-parseInt(_0xd2107a(0x1fc))/0x5*(parseInt(_0xd2107a(0x1e1))/0x6)+parseInt(_0xd2107a(0x1ea))/0x7*(parseInt(_0xd2107a(0x1e0))/0x8)+-parseInt(_0xd2107a(0x1fb))/0x9+-parseInt(_0xd2107a(0x1e8))/0xa*(parseInt(_0xd2107a(0x1f2))/0xb)+-parseInt(_0xd2107a(0x1f7))/0xc*(-parseInt(_0xd2107a(0x1e9))/0xd);if(_0x5f507b===_0x29d878)break;else _0x5f42c4['push'](_0x5f42c4['shift']());}catch(_0x35a742){_0x5f42c4['push'](_0x5f42c4['shift']());}}}(a1_0x4ab0,0x728a5));import{Wayforpay}from'wayforpay-ts-integration';import a1_0x5e6711 from'@/lib/baseUrl';import a1_0x92b4fc from'@/sanity/lib/courses/getCourseById';function a1_0x12ea(_0x244c52,_0x269b31){const _0x4ab0d4=a1_0x4ab0();return a1_0x12ea=function(_0x12ea42,_0x35857f){_0x12ea42=_0x12ea42-0x1dd;let _0x448e00=_0x4ab0d4[_0x12ea42];if(a1_0x12ea['KBFVZR']===undefined){var _0x1b10d1=function(_0x5e6711){const _0x92b4fc='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x21e14f='',_0x3ca530='';for(let _0x1146e5=0x0,_0x5094a4,_0x363422,_0x554c8b=0x0;_0x363422=_0x5e6711['charAt'](_0x554c8b++);~_0x363422&&(_0x5094a4=_0x1146e5%0x4?_0x5094a4*0x40+_0x363422:_0x363422,_0x1146e5++%0x4)?_0x21e14f+=String['fromCharCode'](0xff&_0x5094a4>>(-0x2*_0x1146e5&0x6)):0x0){_0x363422=_0x92b4fc['indexOf'](_0x363422);}for(let _0x20f6c1=0x0,_0x569420=_0x21e14f['length'];_0x20f6c1<_0x569420;_0x20f6c1++){_0x3ca530+='%'+('00'+_0x21e14f['charCodeAt'](_0x20f6c1)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x3ca530);};a1_0x12ea['LZduAH']=_0x1b10d1,_0x244c52=arguments,a1_0x12ea['KBFVZR']=!![];}const _0x5c44d5=_0x4ab0d4[0x0],_0x799522=_0x12ea42+_0x5c44d5,_0x270fa8=_0x244c52[_0x799522];return!_0x270fa8?(_0x448e00=a1_0x12ea['LZduAH'](_0x448e00),_0x244c52[_0x799522]=_0x448e00):_0x448e00=_0x270fa8,_0x448e00;},a1_0x12ea(_0x244c52,_0x269b31);}import{createStudentIfNotExists}from'@/sanity/lib/student/createStudentIfNotExists';import{clerkClient}from'@clerk/nextjs/server';function a1_0x4ab0(){const _0x33d1f2=['z2v0vxnLCG','mZKZnZa0ogT2ChbgCa','ntuXnZmWnLL5z1nWta','y3vYCMvUDa','l2nVDxjZzxmV','v2f5rM9Yugf5igvUDMLYB25Tzw50ihzHCMLHyMXLCYbHCMuGBM90ihbYB3bLCMX5ignVBMzPz3vYzwqU','zw52','l2fWAs93yxLMB3jWyxKVD2vIAg9VAW','q291CNnLigrHDgeGAxmGAw5JB21WBgv0zq','mZuWotb6u2TnwLa','ntK4mdy1AKPMwxfQ','n0jmyuzJtG','v0fzrK9suefzx0nvuLjftKnz','zNjLzv93yxLMB3jWyxLF','ChvYy2HHC2u','mJm0uLPxEMzk','v0fzrK9suefzx01fuKniqu5ux1nfq1jfvf9lrvK','ChjPy2u','DxnLCNm','mJiZm29tB2P4rq','q291CNnLig5VDcbMB3vUza','BM93','v0fzrK9suefzx0rptufjtG','zxjYB3i','mZK2A1LMwNHi','x2LK','zM9YBq','mtu5ndjetxb5CeS','mtu3ndfZv3DjEvO','nvrkBvLjDq','nJe2DNj4C1bc','v0fzrK9suefzx01fuKniqu5ux0Xpr0Lo','CMvKAxjLy3q','rxjYB3iGAw4Gy3jLyxrLv2f5zM9YCgf5q2HLy2TVDxq6','nJiWne9RzhDuvq'];a1_0x4ab0=function(){return _0x33d1f2;};return a1_0x4ab0();}import{createEnrollment}from'@/sanity/lib/student/createEnrollment';export async function createWayforpayCheckout(_0x21e14f,_0x3ca530){const _0x305d4d=a1_0x12ea;try{const _0x1146e5=await a1_0x92b4fc(_0x21e14f),_0x5094a4=await(await clerkClient())[_0x305d4d(0x1f1)][_0x305d4d(0x1df)](_0x3ca530),{emailAddresses:_0x363422,firstName:_0x554c8b,lastName:_0x20f6c1,imageUrl:_0x569420}=_0x5094a4,_0x4fca8e=_0x363422[0x0]?.['emailAddress'];if(!_0x363422||!_0x4fca8e)return{'type':_0x305d4d(0x1ff),'data':null,'error':'User\x20details\x20not\x20found'};if(!_0x1146e5)return{'type':'redirect','data':null,'error':_0x305d4d(0x1f3)};const _0x5cdf43=await createStudentIfNotExists({'clerkId':_0x3ca530,'email':_0x4fca8e||'','firstName':_0x554c8b||_0x4fca8e,'lastName':_0x20f6c1||'','imageUrl':_0x569420||''});if(!_0x5cdf43)return{'type':_0x305d4d(0x1ff),'data':null,'error':'Sanity\x20user\x20not\x20found\x20or\x20could\x20not\x20be\x20created'};if(_0x1146e5['price']===undefined||_0x1146e5['price']===null)return{'type':'redirect','data':null,'error':'Course\x20price\x20is\x20not\x20set'};const {title:_0x256a86,description:_0x15ec79,image:_0x438332,slug:_0x4e8937}=_0x1146e5;if(!_0x256a86||!_0x15ec79||!_0x438332||!_0x4e8937?.[_0x305d4d(0x1e2)])return{'type':'redirect','data':null,'error':_0x305d4d(0x1e7)};if(_0x1146e5[_0x305d4d(0x1f0)]===0x0)return await createEnrollment({'studentId':_0x5cdf43['_id'],'courseId':_0x1146e5[_0x305d4d(0x1f8)],'paymentId':_0x305d4d(0x1ec)+Date['now'](),'paymentProvider':'wayforpay','amount':0x0}),{'type':_0x305d4d(0x1ff),'data':'/dashboard/courses/'+_0x1146e5['_id']};if(!process['env']['WAYFORPAY_MERCHANT_LOGIN']||!process['env'][_0x305d4d(0x1ef)]||!process[_0x305d4d(0x1e5)]['WAYFORPAY_DOMAIN']||!process[_0x305d4d(0x1e5)][_0x305d4d(0x1eb)])return{'type':'redirect','data':null,'error':_0x305d4d(0x1e4)};const _0xc35db=new Wayforpay({'merchantLogin':process['env'][_0x305d4d(0x1fe)],'merchantSecret':process[_0x305d4d(0x1e5)]['WAYFORPAY_MERCHANT_SECRET_KEY']}),_0x34a4c2=_0x1146e5[_0x305d4d(0x1f8)]+'_'+_0x3ca530+'_'+Date[_0x305d4d(0x1f4)](),_0x3268f7=[{'product':{'name':_0x256a86,'price':_0x1146e5[_0x305d4d(0x1f0)]},'quantity':0x1}],_0x3a149b=await _0xc35db[_0x305d4d(0x1ed)](_0x3268f7,{'domain':process[_0x305d4d(0x1e5)][_0x305d4d(0x1f5)],'orderReference':_0x34a4c2,'currency':process['env']['WAYFORPAY_CURRENCY'],'returnUrl':a1_0x5e6711+_0x305d4d(0x1e3)+_0x4e8937['current']+'?payment_success=wayforpay','serviceUrl':a1_0x5e6711+_0x305d4d(0x1e6),'clientFirstName':_0x554c8b||undefined,'clientLastName':_0x20f6c1||undefined,'clientEmail':_0x4fca8e||undefined});return{'type':_0x305d4d(0x1f9),'data':_0x3a149b};}catch(_0x31fd4e){return console[_0x305d4d(0x1f6)](_0x305d4d(0x1dd),_0x31fd4e),{'type':_0x305d4d(0x1ff),'data':null,'error':'Failed\x20to\x20create\x20WayForPay\x20checkout:\x20'+(_0x31fd4e instanceof Error?_0x31fd4e['message']:'Unknown\x20error')};}}
