function a29_0x21ce(_0x31aedd,_0xe8abfa){const _0x24bce4=a29_0x24bc();return a29_0x21ce=function(_0x21ce92,_0x3c326b){_0x21ce92=_0x21ce92-0x121;let _0x42bbb4=_0x24bce4[_0x21ce92];return _0x42bbb4;},a29_0x21ce(_0x31aedd,_0xe8abfa);}(function(_0x54b8da,_0x46e3ec){const _0x27981f=a29_0x21ce,_0x2395d3=_0x54b8da();while(!![]){try{const _0x5598da=parseInt(_0x27981f(0x12c))/0x1+parseInt(_0x27981f(0x12b))/0x2*(parseInt(_0x27981f(0x125))/0x3)+parseInt(_0x27981f(0x124))/0x4+parseInt(_0x27981f(0x126))/0x5+parseInt(_0x27981f(0x128))/0x6*(parseInt(_0x27981f(0x127))/0x7)+parseInt(_0x27981f(0x122))/0x8+-parseInt(_0x27981f(0x12d))/0x9;if(_0x5598da===_0x46e3ec)break;else _0x2395d3['push'](_0x2395d3['shift']());}catch(_0x4aab33){_0x2395d3['push'](_0x2395d3['shift']());}}}(a29_0x24bc,0xedd73));import{client}from'../adminClient';import{createEnrollment}from'./createEnrollment';async function getExistingEnrollments(_0x256fa9,_0x45f233){const _0x504702=a29_0x21ce,_0x4d64c0='*[_type\x20==\x20\x22enrollment\x22\x20&&\x20student._ref\x20==\x20$studentId\x20&&\x20course._ref\x20in\x20$courseIds]\x20{\x0a\x20\x20\x20\x20_id,\x0a\x20\x20\x20\x20\x22courseId\x22:\x20course._ref\x0a\x20\x20}',_0x34e666=await client[_0x504702(0x12a)](_0x4d64c0,{'studentId':_0x256fa9,'courseIds':_0x45f233});return _0x34e666||[];}function a29_0x24bc(){const _0x84e5=['7DtjtPR','7176462BjRtSD','Existing\x20course\x20IDs:','fetch','68OjdgkH','1261207qbALKp','48843711hPkkZM','log','map','Creating\x20new\x20enrollment\x20for\x20course\x20','3373464mQpVtf','push','2481156GaIvqh','117951oZBDSp','7826200qkebuu'];a29_0x24bc=function(){return _0x84e5;};return a29_0x24bc();}export async function createBundleEnrollment({studentId:_0x3fef74,bundleId:_0x49e30b,paymentId:_0x1103cd,amount:_0x3f8e45,paymentProvider:_0x22c06e,bundleData:_0x1e7c08}){const _0x24970a=a29_0x21ce;try{const _0x19bc2f=[];if(_0x1e7c08['courses']&&_0x1e7c08['courses']['length']>0x0){const _0x2d3836=_0x1e7c08['courses']['filter'](_0x47582a=>_0x47582a['course']&&_0x47582a['course']['_id'])['map'](_0x3b8521=>_0x3b8521['course']['_id']),_0x1cd9be=await getExistingEnrollments(_0x3fef74,_0x2d3836),_0x46b8fa=_0x1cd9be[_0x24970a(0x12f)](_0x386ace=>_0x386ace['courseId']);console['log']('Found\x20'+_0x1cd9be['length']+'\x20existing\x20enrollments\x20for\x20bundle\x20purchase'),console[_0x24970a(0x12e)](_0x24970a(0x129),_0x46b8fa);for(const _0x1bdc24 of _0x1e7c08['courses']){if(_0x1bdc24['course']&&_0x1bdc24['course']['_id']){const _0x254543=_0x1bdc24['course']['_id'];if(_0x46b8fa['includes'](_0x254543)){console['log']('Skipping\x20enrollment\x20for\x20course\x20'+_0x254543+'\x20-\x20user\x20already\x20enrolled');const _0x42abe4=_0x1cd9be['find'](_0x339eed=>_0x339eed['courseId']===_0x254543);_0x42abe4&&_0x19bc2f[_0x24970a(0x123)]({'_type':'reference','_ref':_0x42abe4['_id']});continue;}console['log'](_0x24970a(0x121)+_0x254543);const _0x289717=await createEnrollment({'studentId':_0x3fef74,'courseId':_0x254543,'paymentId':_0x1103cd+'_course_'+_0x254543,'amount':0x0,'paymentProvider':_0x22c06e});_0x19bc2f['push']({'_type':'reference','_ref':_0x289717['_id']});}}}const _0x9dbe36={'title':_0x1e7c08['title'],'description':_0x1e7c08['description'],'courses':_0x1e7c08['courses']?.['map'](_0x219897=>({'courseId':_0x219897['course']?.['_id'],'courseTitle':_0x219897['course']?.['title'],'customTitle':_0x219897['customTitle'],'customDescription':_0x219897['customDescription']}))||[]},_0x1f6777=await client['create']({'_type':'bundleEnrollment','student':{'_type':'reference','_ref':_0x3fef74},'courseBundle':{'_type':'reference','_ref':_0x49e30b},'bundleSnapshot':_0x9dbe36,'paymentId':_0x1103cd,'paymentProvider':_0x22c06e,'amount':_0x3f8e45,'enrolledAt':new Date()['toISOString'](),'individualEnrollments':_0x19bc2f});return console['log']('Bundle\x20enrollment\x20created\x20with\x20'+_0x19bc2f['length']+'\x20course\x20enrollments'),_0x1f6777;}catch(_0xef261f){console['error']('Error\x20creating\x20bundle\x20enrollment:',_0xef261f);throw _0xef261f;}}