function a11_0x4cb2(){const _0x1c23b7=['467198ANoZLK','689095FZrsCn','16642647OupJDK','5799484nvKrpa','8842855ifcslf','6gPtRPd','2bgztOS','8704056KrNrAZ','module','Student\x20not\x20found','10nPejOF','2101692NMdtOF','_id'];a11_0x4cb2=function(){return _0x1c23b7;};return a11_0x4cb2();}(function(_0x3ebdce,_0xca10f3){const _0x5e7b2a=a11_0x1d28,_0x58e768=_0x3ebdce();while(!![]){try{const _0x154d30=parseInt(_0x5e7b2a(0x1fd))/0x1+parseInt(_0x5e7b2a(0x1f6))/0x2*(parseInt(_0x5e7b2a(0x1fb))/0x3)+parseInt(_0x5e7b2a(0x1f3))/0x4+parseInt(_0x5e7b2a(0x1fe))/0x5+-parseInt(_0x5e7b2a(0x1f5))/0x6*(parseInt(_0x5e7b2a(0x1f4))/0x7)+parseInt(_0x5e7b2a(0x1f7))/0x8+-parseInt(_0x5e7b2a(0x1f2))/0x9*(parseInt(_0x5e7b2a(0x1fa))/0xa);if(_0x154d30===_0xca10f3)break;else _0x58e768['push'](_0x58e768['shift']());}catch(_0x4e42c3){_0x58e768['push'](_0x58e768['shift']());}}}(a11_0x4cb2,0xb2783));import a11_0x11bd6c from'groq';import{client}from'../adminClient';import{getStudentByClerkId}from'../student/getStudentByClerkId';function a11_0x1d28(_0x515724,_0x4d53bd){const _0x4cb2e6=a11_0x4cb2();return a11_0x1d28=function(_0x1d2897,_0xd5493d){_0x1d2897=_0x1d2897-0x1f2;let _0x55f25a=_0x4cb2e6[_0x1d2897];return _0x55f25a;},a11_0x1d28(_0x515724,_0x4d53bd);}import{sanityFetch}from'../live';export async function completeLessonById({lessonId:_0x318465,clerkId:_0x57fc2a}){const _0x2b6d87=a11_0x1d28;try{const _0x21fbc3=await getStudentByClerkId(_0x57fc2a);if(!_0x21fbc3?.['data']?.['_id'])throw new Error(_0x2b6d87(0x1f9));const _0x54e58e=_0x21fbc3['data']['_id'],_0x178af0=await sanityFetch({'query':a11_0x11bd6c`*[_type == "lessonCompletion" && student._ref == $studentId && lesson._ref == $lessonId][0]`,'params':{'studentId':_0x54e58e,'lessonId':_0x318465}});if(_0x178af0['data'])return _0x178af0['data'];const _0x259fce=await sanityFetch({'query':a11_0x11bd6c`*[_type == "lesson" && _id == $lessonId][0]{
        _id,
        "module": *[_type == "module" && references(^._id)][0]{
          _id,
          "course": *[_type == "course" && references(^._id)][0]._id
        }
      }`,'params':{'lessonId':_0x318465}});if(!_0x259fce?.['data']?.['module']?.[_0x2b6d87(0x1fc)]||!_0x259fce?.['data']?.['module']?.['course'])throw new Error('Could\x20not\x20find\x20module\x20or\x20course\x20for\x20lesson');const _0x505634=await client['create']({'_type':'lessonCompletion','student':{'_type':'reference','_ref':_0x54e58e},'lesson':{'_type':'reference','_ref':_0x318465},'module':{'_type':'reference','_ref':_0x259fce['data']['module']['_id']},'course':{'_type':'reference','_ref':_0x259fce['data'][_0x2b6d87(0x1f8)]['course']},'completedAt':new Date()['toISOString']()});return _0x505634;}catch(_0x1df783){console['error']('Error\x20completing\x20lesson:',_0x1df783);throw _0x1df783;}}