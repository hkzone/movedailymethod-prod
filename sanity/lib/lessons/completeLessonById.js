(function(_0x1de1d6,_0x17b7d0){const _0x1d1d47=a8_0x25c8,_0x5af357=_0x1de1d6();while(!![]){try{const _0x5370f0=parseInt(_0x1d1d47(0x175))/0x1+parseInt(_0x1d1d47(0x176))/0x2*(-parseInt(_0x1d1d47(0x172))/0x3)+-parseInt(_0x1d1d47(0x177))/0x4+parseInt(_0x1d1d47(0x173))/0x5*(-parseInt(_0x1d1d47(0x178))/0x6)+-parseInt(_0x1d1d47(0x17b))/0x7+parseInt(_0x1d1d47(0x179))/0x8+-parseInt(_0x1d1d47(0x17a))/0x9*(-parseInt(_0x1d1d47(0x174))/0xa);if(_0x5370f0===_0x17b7d0)break;else _0x5af357['push'](_0x5af357['shift']());}catch(_0x264543){_0x5af357['push'](_0x5af357['shift']());}}}(a8_0x57c2,0x28085));import a8_0x425b73 from'groq';import{client}from'../adminClient';function a8_0x57c2(){const _0xee9750=['data','module','501wqWvax','5MopsVp','2590ASzHzv','274934QbiVsB','1678koAgyR','1181940TNRecW','1452822bPLNqp','1191184NqwulL','18963FNZgrI','894859iyBrHD'];a8_0x57c2=function(){return _0xee9750;};return a8_0x57c2();}import{getStudentByClerkId}from'../student/getStudentByClerkId';function a8_0x25c8(_0x5d6083,_0xbca07a){const _0x57c274=a8_0x57c2();return a8_0x25c8=function(_0x25c825,_0x1aafa0){_0x25c825=_0x25c825-0x172;let _0x3846e3=_0x57c274[_0x25c825];return _0x3846e3;},a8_0x25c8(_0x5d6083,_0xbca07a);}import{sanityFetch}from'../live';export async function completeLessonById({lessonId:_0x392540,clerkId:_0x38723e}){const _0x299a6a=a8_0x25c8;try{const _0x1cf79b=await getStudentByClerkId(_0x38723e);if(!_0x1cf79b?.['data']?.['_id'])throw new Error('Student\x20not\x20found');const _0x544a8c=_0x1cf79b['data']['_id'],_0x6534a=await sanityFetch({'query':a8_0x425b73`*[_type == "lessonCompletion" && student._ref == $studentId && lesson._ref == $lessonId][0]`,'params':{'studentId':_0x544a8c,'lessonId':_0x392540}});if(_0x6534a[_0x299a6a(0x17c)])return _0x6534a['data'];const _0x110048=await sanityFetch({'query':a8_0x425b73`*[_type == "lesson" && _id == $lessonId][0]{
        _id,
        "module": *[_type == "module" && references(^._id)][0]{
          _id,
          "course": *[_type == "course" && references(^._id)][0]._id
        }
      }`,'params':{'lessonId':_0x392540}});if(!_0x110048?.['data']?.['module']?.['_id']||!_0x110048?.['data']?.['module']?.['course'])throw new Error('Could\x20not\x20find\x20module\x20or\x20course\x20for\x20lesson');const _0x1cff9f=await client['create']({'_type':'lessonCompletion','student':{'_type':'reference','_ref':_0x544a8c},'lesson':{'_type':'reference','_ref':_0x392540},'module':{'_type':'reference','_ref':_0x110048['data']['module']['_id']},'course':{'_type':'reference','_ref':_0x110048[_0x299a6a(0x17c)][_0x299a6a(0x17d)]['course']},'completedAt':new Date()['toISOString']()});return _0x1cff9f;}catch(_0x466467){console['error']('Error\x20completing\x20lesson:',_0x466467);throw _0x466467;}}