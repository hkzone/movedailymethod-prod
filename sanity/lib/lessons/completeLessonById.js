function a11_0x5281(){const _0x38664d=['1571OeEBer','Error\x20completing\x20lesson:','1142MRUfzw','65210yMRQvX','3081865kSiCnp','7183752PHchHh','216fxkqko','49460VZYtxg','data','294136epmghh','77rfKpxV','6266526uMBywY','57FYpyku'];a11_0x5281=function(){return _0x38664d;};return a11_0x5281();}(function(_0x55c83e,_0x354335){const _0x5bfa8b=a11_0x544e,_0xc339c3=_0x55c83e();while(!![]){try{const _0x2534e1=-parseInt(_0x5bfa8b(0x118))/0x1*(-parseInt(_0x5bfa8b(0x11a))/0x2)+parseInt(_0x5bfa8b(0x117))/0x3*(parseInt(_0x5bfa8b(0x11f))/0x4)+parseInt(_0x5bfa8b(0x11c))/0x5+-parseInt(_0x5bfa8b(0x11d))/0x6+parseInt(_0x5bfa8b(0x123))/0x7+-parseInt(_0x5bfa8b(0x121))/0x8*(parseInt(_0x5bfa8b(0x11e))/0x9)+parseInt(_0x5bfa8b(0x11b))/0xa*(parseInt(_0x5bfa8b(0x122))/0xb);if(_0x2534e1===_0x354335)break;else _0xc339c3['push'](_0xc339c3['shift']());}catch(_0x341739){_0xc339c3['push'](_0xc339c3['shift']());}}}(a11_0x5281,0x94cea));import a11_0x4fdd92 from'groq';function a11_0x544e(_0xdb85af,_0x4a288c){const _0x5281d2=a11_0x5281();return a11_0x544e=function(_0x544e4c,_0x53a178){_0x544e4c=_0x544e4c-0x117;let _0xc07b72=_0x5281d2[_0x544e4c];return _0xc07b72;},a11_0x544e(_0xdb85af,_0x4a288c);}import{client}from'../adminClient';import{getStudentByClerkId}from'../student/getStudentByClerkId';import{sanityFetch}from'../live';export async function completeLessonById({lessonId:_0x431ad0,clerkId:_0x3005a3}){const _0x3b4f72=a11_0x544e;try{const _0x316053=await getStudentByClerkId(_0x3005a3);if(!_0x316053?.['data']?.['_id'])throw new Error('Student\x20not\x20found');const _0x2506ac=_0x316053['data']['_id'],_0xce1a3f=await sanityFetch({'query':a11_0x4fdd92`*[_type == "lessonCompletion" && student._ref == $studentId && lesson._ref == $lessonId][0]`,'params':{'studentId':_0x2506ac,'lessonId':_0x431ad0}});if(_0xce1a3f['data'])return _0xce1a3f['data'];const _0x3dd66a=await sanityFetch({'query':a11_0x4fdd92`*[_type == "lesson" && _id == $lessonId][0]{
        _id,
        "module": *[_type == "module" && references(^._id)][0]{
          _id,
          "course": *[_type == "course" && references(^._id)][0]._id
        }
      }`,'params':{'lessonId':_0x431ad0}});if(!_0x3dd66a?.[_0x3b4f72(0x120)]?.['module']?.['_id']||!_0x3dd66a?.['data']?.['module']?.['course'])throw new Error('Could\x20not\x20find\x20module\x20or\x20course\x20for\x20lesson');const _0xaf93e8=await client['create']({'_type':'lessonCompletion','student':{'_type':'reference','_ref':_0x2506ac},'lesson':{'_type':'reference','_ref':_0x431ad0},'module':{'_type':'reference','_ref':_0x3dd66a['data']['module']['_id']},'course':{'_type':'reference','_ref':_0x3dd66a['data']['module']['course']},'completedAt':new Date()['toISOString']()});return _0xaf93e8;}catch(_0x12aa8d){console['error'](_0x3b4f72(0x119),_0x12aa8d);throw _0x12aa8d;}}