(function(_0xe14157,_0x193138){const _0x2a2016=a8_0x3c37,_0x18d458=_0xe14157();while(!![]){try{const _0x365101=parseInt(_0x2a2016(0x15a))/0x1+-parseInt(_0x2a2016(0x155))/0x2*(-parseInt(_0x2a2016(0x15d))/0x3)+-parseInt(_0x2a2016(0x157))/0x4+-parseInt(_0x2a2016(0x159))/0x5*(-parseInt(_0x2a2016(0x164))/0x6)+parseInt(_0x2a2016(0x153))/0x7+-parseInt(_0x2a2016(0x162))/0x8*(parseInt(_0x2a2016(0x15b))/0x9)+parseInt(_0x2a2016(0x156))/0xa;if(_0x365101===_0x193138)break;else _0x18d458['push'](_0x18d458['shift']());}catch(_0x338659){_0x18d458['push'](_0x18d458['shift']());}}}(a8_0x4964,0xc291a));import a8_0x1d91cb from'groq';import{client}from'../adminClient';function a8_0x4964(){const _0x555bd9=['ndm0mJaWzMfbrhPb','ovnqvu5ssG','CMvMzxjLBMnL','nta5mungA3zJDq','y291CNnL','zxjYB3i','zgf0yq','rxjYB3iGy29TCgXLDgLUzYbSzxnZB246','mteYmJyYotz6zKXUvgW','Bw9KDwXL','mZe3mJa4qMneq1jY','nJe2otKXou1Xu3bKBq','q291BgqGBM90igzPBMqGBw9KDwXLig9YignVDxjZzsbMB3iGBgvZC29U','nZu4AeDZu3bH','nZG3mZyYmezzAMjTtG','mJyWnJu0ogvfvvfxCW','x2LK','mtbytgDxsuq'];a8_0x4964=function(){return _0x555bd9;};return a8_0x4964();}import{getStudentByClerkId}from'../student/getStudentByClerkId';function a8_0x3c37(_0x1f7cfc,_0xbffa20){const _0x496427=a8_0x4964();return a8_0x3c37=function(_0x3c37a1,_0x440bf9){_0x3c37a1=_0x3c37a1-0x153;let _0x333d6d=_0x496427[_0x3c37a1];if(a8_0x3c37['gVsHsk']===undefined){var _0x408edc=function(_0x1d91cb){const _0x6f6d8e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x518d19='',_0x25f7da='';for(let _0x4f57d9=0x0,_0x327971,_0x3cdfc5,_0x130f6d=0x0;_0x3cdfc5=_0x1d91cb['charAt'](_0x130f6d++);~_0x3cdfc5&&(_0x327971=_0x4f57d9%0x4?_0x327971*0x40+_0x3cdfc5:_0x3cdfc5,_0x4f57d9++%0x4)?_0x518d19+=String['fromCharCode'](0xff&_0x327971>>(-0x2*_0x4f57d9&0x6)):0x0){_0x3cdfc5=_0x6f6d8e['indexOf'](_0x3cdfc5);}for(let _0x218436=0x0,_0x49daa0=_0x518d19['length'];_0x218436<_0x49daa0;_0x218436++){_0x25f7da+='%'+('00'+_0x518d19['charCodeAt'](_0x218436)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x25f7da);};a8_0x3c37['YntyYO']=_0x408edc,_0x1f7cfc=arguments,a8_0x3c37['gVsHsk']=!![];}const _0x4059da=_0x496427[0x0],_0x1c0883=_0x3c37a1+_0x4059da,_0x19d7e0=_0x1f7cfc[_0x1c0883];return!_0x19d7e0?(_0x333d6d=a8_0x3c37['YntyYO'](_0x333d6d),_0x1f7cfc[_0x1c0883]=_0x333d6d):_0x333d6d=_0x19d7e0,_0x333d6d;},a8_0x3c37(_0x1f7cfc,_0xbffa20);}import{sanityFetch}from'../live';export async function completeLessonById({lessonId:_0x6f6d8e,clerkId:_0x518d19}){const _0x2903f4=a8_0x3c37;try{const _0x25f7da=await getStudentByClerkId(_0x518d19);if(!_0x25f7da?.['data']?.[_0x2903f4(0x158)])throw new Error('Student\x20not\x20found');const _0x4f57d9=_0x25f7da[_0x2903f4(0x160)]['_id'],_0x327971=await sanityFetch({'query':a8_0x1d91cb`*[_type == "lessonCompletion" && student._ref == $studentId && lesson._ref == $lessonId][0]`,'params':{'studentId':_0x4f57d9,'lessonId':_0x6f6d8e}});if(_0x327971['data'])return _0x327971['data'];const _0x3cdfc5=await sanityFetch({'query':a8_0x1d91cb`*[_type == "lesson" && _id == $lessonId][0]{
        _id,
        "module": *[_type == "module" && references(^._id)][0]{
          _id,
          "course": *[_type == "course" && references(^._id)][0]._id
        }
      }`,'params':{'lessonId':_0x6f6d8e}});if(!_0x3cdfc5?.[_0x2903f4(0x160)]?.['module']?.[_0x2903f4(0x158)]||!_0x3cdfc5?.['data']?.[_0x2903f4(0x163)]?.['course'])throw new Error(_0x2903f4(0x154));const _0x130f6d=await client['create']({'_type':'lessonCompletion','student':{'_type':_0x2903f4(0x15c),'_ref':_0x4f57d9},'lesson':{'_type':_0x2903f4(0x15c),'_ref':_0x6f6d8e},'module':{'_type':'reference','_ref':_0x3cdfc5[_0x2903f4(0x160)][_0x2903f4(0x163)]['_id']},'course':{'_type':_0x2903f4(0x15c),'_ref':_0x3cdfc5['data'][_0x2903f4(0x163)][_0x2903f4(0x15e)]},'completedAt':new Date()['toISOString']()});return _0x130f6d;}catch(_0x218436){console[_0x2903f4(0x15f)](_0x2903f4(0x161),_0x218436);throw _0x218436;}}