(function(_0x567331,_0x4d8bc6){const _0x1e7ace=a11_0x42d6,_0x42d8d0=_0x567331();while(!![]){try{const _0x1f9318=-parseInt(_0x1e7ace(0x13c))/0x1*(-parseInt(_0x1e7ace(0x144))/0x2)+-parseInt(_0x1e7ace(0x141))/0x3*(-parseInt(_0x1e7ace(0x13d))/0x4)+parseInt(_0x1e7ace(0x13b))/0x5*(-parseInt(_0x1e7ace(0x142))/0x6)+-parseInt(_0x1e7ace(0x139))/0x7+parseInt(_0x1e7ace(0x140))/0x8*(parseInt(_0x1e7ace(0x13a))/0x9)+-parseInt(_0x1e7ace(0x13f))/0xa*(-parseInt(_0x1e7ace(0x13e))/0xb)+-parseInt(_0x1e7ace(0x143))/0xc*(parseInt(_0x1e7ace(0x138))/0xd);if(_0x1f9318===_0x4d8bc6)break;else _0x42d8d0['push'](_0x42d8d0['shift']());}catch(_0x11e8fd){_0x42d8d0['push'](_0x42d8d0['shift']());}}}(a11_0x3166,0x18b7d));function a11_0x42d6(_0x452329,_0x1d065c){const _0x31664e=a11_0x3166();return a11_0x42d6=function(_0x42d69c,_0x98d538){_0x42d69c=_0x42d69c-0x138;let _0x19cfc8=_0x31664e[_0x42d69c];return _0x19cfc8;},a11_0x42d6(_0x452329,_0x1d065c);}import a11_0x2a64ad from'groq';import{client}from'../adminClient';function a11_0x3166(){const _0x120509=['176571CDyNvd','233375ijtDZw','24238lBTGYb','3284VrlrPF','66KJUwBd','324910tzgbvb','72YCuhJl','66MgmJls','12AFoBTy','823692lbUFli','2nCloHI','13eFSbVt','1054067pWoRpW'];a11_0x3166=function(){return _0x120509;};return a11_0x3166();}import{getStudentByClerkId}from'../student/getStudentByClerkId';import{sanityFetch}from'../live';export async function completeLessonById({lessonId:_0x160435,clerkId:_0x534945}){try{const _0x52c21f=await getStudentByClerkId(_0x534945);if(!_0x52c21f?.['data']?.['_id'])throw new Error('Student\x20not\x20found');const _0x4e2fdf=_0x52c21f['data']['_id'],_0x3f133b=await sanityFetch({'query':a11_0x2a64ad`*[_type == "lessonCompletion" && student._ref == $studentId && lesson._ref == $lessonId][0]`,'params':{'studentId':_0x4e2fdf,'lessonId':_0x160435}});if(_0x3f133b['data'])return _0x3f133b['data'];const _0x3724d5=await sanityFetch({'query':a11_0x2a64ad`*[_type == "lesson" && _id == $lessonId][0]{
        _id,
        "module": *[_type == "module" && references(^._id)][0]{
          _id,
          "course": *[_type == "course" && references(^._id)][0]._id
        }
      }`,'params':{'lessonId':_0x160435}});if(!_0x3724d5?.['data']?.['module']?.['_id']||!_0x3724d5?.['data']?.['module']?.['course'])throw new Error('Could\x20not\x20find\x20module\x20or\x20course\x20for\x20lesson');const _0x4fdc6b=await client['create']({'_type':'lessonCompletion','student':{'_type':'reference','_ref':_0x4e2fdf},'lesson':{'_type':'reference','_ref':_0x160435},'module':{'_type':'reference','_ref':_0x3724d5['data']['module']['_id']},'course':{'_type':'reference','_ref':_0x3724d5['data']['module']['course']},'completedAt':new Date()['toISOString']()});return _0x4fdc6b;}catch(_0x57f82a){console['error']('Error\x20completing\x20lesson:',_0x57f82a);throw _0x57f82a;}}