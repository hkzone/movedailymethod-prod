function a8_0x23c8(_0x37c9e8,_0x2035b8){const _0x5bb670=a8_0x5bb6();return a8_0x23c8=function(_0x23c8ef,_0x71e56){_0x23c8ef=_0x23c8ef-0x1b4;let _0x4fa27e=_0x5bb670[_0x23c8ef];return _0x4fa27e;},a8_0x23c8(_0x37c9e8,_0x2035b8);}(function(_0x537b74,_0x3d5181){const _0x26f945=a8_0x23c8,_0x5d63b6=_0x537b74();while(!![]){try{const _0x2d3cb4=-parseInt(_0x26f945(0x1c0))/0x1*(parseInt(_0x26f945(0x1b9))/0x2)+parseInt(_0x26f945(0x1b4))/0x3*(-parseInt(_0x26f945(0x1c2))/0x4)+-parseInt(_0x26f945(0x1b6))/0x5+parseInt(_0x26f945(0x1be))/0x6*(-parseInt(_0x26f945(0x1bf))/0x7)+-parseInt(_0x26f945(0x1ba))/0x8*(parseInt(_0x26f945(0x1c1))/0x9)+-parseInt(_0x26f945(0x1bc))/0xa+parseInt(_0x26f945(0x1b7))/0xb;if(_0x2d3cb4===_0x3d5181)break;else _0x5d63b6['push'](_0x5d63b6['shift']());}catch(_0x5148c1){_0x5d63b6['push'](_0x5d63b6['shift']());}}}(a8_0x5bb6,0x668d9));import a8_0xb0e61e from'groq';import{client}from'../adminClient';import{getStudentByClerkId}from'../student/getStudentByClerkId';function a8_0x5bb6(){const _0x125ea8=['data','906815QyhUPP','20169523vZUMIQ','error','4GiQMhY','8VtzEuT','module','3362210pDiuRJ','lessonCompletion','12ZrUQUW','458507ihXxkL','38834iFDPPN','4622706ASORvj','32YAEiNZ','65118noDkaY'];a8_0x5bb6=function(){return _0x125ea8;};return a8_0x5bb6();}import{sanityFetch}from'../live';export async function completeLessonById({lessonId:_0x58008d,clerkId:_0x4ab18e}){const _0x6f55af=a8_0x23c8;try{const _0x106e2d=await getStudentByClerkId(_0x4ab18e);if(!_0x106e2d?.['data']?.['_id'])throw new Error('Student\x20not\x20found');const _0x79c04a=_0x106e2d['data']['_id'],_0x127e34=await sanityFetch({'query':a8_0xb0e61e`*[_type == "lessonCompletion" && student._ref == $studentId && lesson._ref == $lessonId][0]`,'params':{'studentId':_0x79c04a,'lessonId':_0x58008d}});if(_0x127e34[_0x6f55af(0x1b5)])return _0x127e34['data'];const _0x9780f5=await sanityFetch({'query':a8_0xb0e61e`*[_type == "lesson" && _id == $lessonId][0]{
        _id,
        "module": *[_type == "module" && references(^._id)][0]{
          _id,
          "course": *[_type == "course" && references(^._id)][0]._id
        }
      }`,'params':{'lessonId':_0x58008d}});if(!_0x9780f5?.['data']?.['module']?.['_id']||!_0x9780f5?.['data']?.['module']?.['course'])throw new Error('Could\x20not\x20find\x20module\x20or\x20course\x20for\x20lesson');const _0x1af861=await client['create']({'_type':_0x6f55af(0x1bd),'student':{'_type':'reference','_ref':_0x79c04a},'lesson':{'_type':'reference','_ref':_0x58008d},'module':{'_type':'reference','_ref':_0x9780f5['data']['module']['_id']},'course':{'_type':'reference','_ref':_0x9780f5['data'][_0x6f55af(0x1bb)]['course']},'completedAt':new Date()['toISOString']()});return _0x1af861;}catch(_0x101ad5){console[_0x6f55af(0x1b8)]('Error\x20completing\x20lesson:',_0x101ad5);throw _0x101ad5;}}