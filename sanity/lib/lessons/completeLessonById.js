(function(_0x501b00,_0x33c455){const _0x4f8a95=a8_0x1cb9,_0x5d97a1=_0x501b00();while(!![]){try{const _0x301290=-parseInt(_0x4f8a95(0xbb))/0x1*(-parseInt(_0x4f8a95(0xc1))/0x2)+parseInt(_0x4f8a95(0xc0))/0x3+-parseInt(_0x4f8a95(0xbd))/0x4+-parseInt(_0x4f8a95(0xc4))/0x5*(-parseInt(_0x4f8a95(0xc2))/0x6)+-parseInt(_0x4f8a95(0xba))/0x7+-parseInt(_0x4f8a95(0xc3))/0x8+parseInt(_0x4f8a95(0xbe))/0x9;if(_0x301290===_0x33c455)break;else _0x5d97a1['push'](_0x5d97a1['shift']());}catch(_0x28daab){_0x5d97a1['push'](_0x5d97a1['shift']());}}}(a8_0x5767,0x1d296));function a8_0x5767(){const _0x270f57=['ody3mJCWuNbXv1zI','mtiXntG5nMf6CKzmBq','nwXStfrVtq','mti3odm2ogHXBezPDW','mwvNr0HiDW','zgf0yq','otuWnZe2CLbrse9S','mJK2nZiWmuvYtKPjza','Bw9KDwXL','ntC2mJq5Ahfirunj','nta4mZHmCenhrvm'];a8_0x5767=function(){return _0x270f57;};return a8_0x5767();}import a8_0xa1a4c5 from'groq';import{client}from'../adminClient';function a8_0x1cb9(_0xcae1d,_0x4296cd){const _0x5767a2=a8_0x5767();return a8_0x1cb9=function(_0x1cb99a,_0x220cdd){_0x1cb99a=_0x1cb99a-0xba;let _0x5624e1=_0x5767a2[_0x1cb99a];if(a8_0x1cb9['DksZbh']===undefined){var _0xd975e1=function(_0xa1a4c5){const _0x47be32='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2c8c9e='',_0x2d4895='';for(let _0x430f69=0x0,_0x47e9e0,_0x631603,_0x57b792=0x0;_0x631603=_0xa1a4c5['charAt'](_0x57b792++);~_0x631603&&(_0x47e9e0=_0x430f69%0x4?_0x47e9e0*0x40+_0x631603:_0x631603,_0x430f69++%0x4)?_0x2c8c9e+=String['fromCharCode'](0xff&_0x47e9e0>>(-0x2*_0x430f69&0x6)):0x0){_0x631603=_0x47be32['indexOf'](_0x631603);}for(let _0x14f86a=0x0,_0x211e7c=_0x2c8c9e['length'];_0x14f86a<_0x211e7c;_0x14f86a++){_0x2d4895+='%'+('00'+_0x2c8c9e['charCodeAt'](_0x14f86a)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2d4895);};a8_0x1cb9['DzpQaz']=_0xd975e1,_0xcae1d=arguments,a8_0x1cb9['DksZbh']=!![];}const _0x82b614=_0x5767a2[0x0],_0x3a606f=_0x1cb99a+_0x82b614,_0x29e99d=_0xcae1d[_0x3a606f];return!_0x29e99d?(_0x5624e1=a8_0x1cb9['DzpQaz'](_0x5624e1),_0xcae1d[_0x3a606f]=_0x5624e1):_0x5624e1=_0x29e99d,_0x5624e1;},a8_0x1cb9(_0xcae1d,_0x4296cd);}import{getStudentByClerkId}from'../student/getStudentByClerkId';import{sanityFetch}from'../live';export async function completeLessonById({lessonId:_0x47be32,clerkId:_0x2c8c9e}){const _0x559a5a=a8_0x1cb9;try{const _0x2d4895=await getStudentByClerkId(_0x2c8c9e);if(!_0x2d4895?.[_0x559a5a(0xbc)]?.['_id'])throw new Error('Student\x20not\x20found');const _0x430f69=_0x2d4895['data']['_id'],_0x47e9e0=await sanityFetch({'query':a8_0xa1a4c5`*[_type == "lessonCompletion" && student._ref == $studentId && lesson._ref == $lessonId][0]`,'params':{'studentId':_0x430f69,'lessonId':_0x47be32}});if(_0x47e9e0['data'])return _0x47e9e0['data'];const _0x631603=await sanityFetch({'query':a8_0xa1a4c5`*[_type == "lesson" && _id == $lessonId][0]{
        _id,
        "module": *[_type == "module" && references(^._id)][0]{
          _id,
          "course": *[_type == "course" && references(^._id)][0]._id
        }
      }`,'params':{'lessonId':_0x47be32}});if(!_0x631603?.['data']?.['module']?.['_id']||!_0x631603?.[_0x559a5a(0xbc)]?.[_0x559a5a(0xbf)]?.['course'])throw new Error('Could\x20not\x20find\x20module\x20or\x20course\x20for\x20lesson');const _0x57b792=await client['create']({'_type':'lessonCompletion','student':{'_type':'reference','_ref':_0x430f69},'lesson':{'_type':'reference','_ref':_0x47be32},'module':{'_type':'reference','_ref':_0x631603['data']['module']['_id']},'course':{'_type':'reference','_ref':_0x631603['data']['module']['course']},'completedAt':new Date()['toISOString']()});return _0x57b792;}catch(_0x14f86a){console['error']('Error\x20completing\x20lesson:',_0x14f86a);throw _0x14f86a;}}