function a8_0x4cdb(_0x2f588c,_0x3dd1e3){const _0xeb21d4=a8_0xeb21();return a8_0x4cdb=function(_0x4cdba1,_0x291fe9){_0x4cdba1=_0x4cdba1-0x1a6;let _0x1093aa=_0xeb21d4[_0x4cdba1];return _0x1093aa;},a8_0x4cdb(_0x2f588c,_0x3dd1e3);}function a8_0xeb21(){const _0x5511c5=['136217GYHIUX','160727hhRmKA','Could\x20not\x20find\x20module\x20or\x20course\x20for\x20lesson','227436GScegj','37610puHuRg','module','48bVRubT','data','reference','1084000vrFrQV','3hJgSzV','584950XMXqdf','9JeQZjm','128532XhttzV'];a8_0xeb21=function(){return _0x5511c5;};return a8_0xeb21();}(function(_0x1907a9,_0x3a077a){const _0xa13d9f=a8_0x4cdb,_0x4ea3d0=_0x1907a9();while(!![]){try{const _0x1c3393=parseInt(_0xa13d9f(0x1b3))/0x1+-parseInt(_0xa13d9f(0x1a8))/0x2+-parseInt(_0xa13d9f(0x1af))/0x3*(-parseInt(_0xa13d9f(0x1b2))/0x4)+parseInt(_0xa13d9f(0x1b0))/0x5+parseInt(_0xa13d9f(0x1ab))/0x6*(-parseInt(_0xa13d9f(0x1a6))/0x7)+parseInt(_0xa13d9f(0x1ae))/0x8+parseInt(_0xa13d9f(0x1b1))/0x9*(-parseInt(_0xa13d9f(0x1a9))/0xa);if(_0x1c3393===_0x3a077a)break;else _0x4ea3d0['push'](_0x4ea3d0['shift']());}catch(_0x3332d1){_0x4ea3d0['push'](_0x4ea3d0['shift']());}}}(a8_0xeb21,0x1d379));import a8_0x47be82 from'groq';import{client}from'../adminClient';import{getStudentByClerkId}from'../student/getStudentByClerkId';import{sanityFetch}from'../live';export async function completeLessonById({lessonId:_0x10c46c,clerkId:_0x269421}){const _0x5bb0c3=a8_0x4cdb;try{const _0x493fd9=await getStudentByClerkId(_0x269421);if(!_0x493fd9?.['data']?.['_id'])throw new Error('Student\x20not\x20found');const _0x251874=_0x493fd9['data']['_id'],_0x4f1b8d=await sanityFetch({'query':a8_0x47be82`*[_type == "lessonCompletion" && student._ref == $studentId && lesson._ref == $lessonId][0]`,'params':{'studentId':_0x251874,'lessonId':_0x10c46c}});if(_0x4f1b8d[_0x5bb0c3(0x1ac)])return _0x4f1b8d['data'];const _0x344cff=await sanityFetch({'query':a8_0x47be82`*[_type == "lesson" && _id == $lessonId][0]{
        _id,
        "module": *[_type == "module" && references(^._id)][0]{
          _id,
          "course": *[_type == "course" && references(^._id)][0]._id
        }
      }`,'params':{'lessonId':_0x10c46c}});if(!_0x344cff?.['data']?.['module']?.['_id']||!_0x344cff?.['data']?.['module']?.['course'])throw new Error(_0x5bb0c3(0x1a7));const _0x11ee0b=await client['create']({'_type':'lessonCompletion','student':{'_type':'reference','_ref':_0x251874},'lesson':{'_type':'reference','_ref':_0x10c46c},'module':{'_type':_0x5bb0c3(0x1ad),'_ref':_0x344cff['data']['module']['_id']},'course':{'_type':_0x5bb0c3(0x1ad),'_ref':_0x344cff['data'][_0x5bb0c3(0x1aa)]['course']},'completedAt':new Date()['toISOString']()});return _0x11ee0b;}catch(_0x1efdfc){console['error']('Error\x20completing\x20lesson:',_0x1efdfc);throw _0x1efdfc;}}