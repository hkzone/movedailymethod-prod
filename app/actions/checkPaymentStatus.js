"use server";

'use server';(function(_0x29e860,_0x410482){const _0x427d52=a0_0xf011,_0xb9cf54=_0x29e860();while(!![]){try{const _0xd1d25a=-parseInt(_0x427d52(0xf8))/0x1+parseInt(_0x427d52(0xfd))/0x2+parseInt(_0x427d52(0xf7))/0x3*(-parseInt(_0x427d52(0xfa))/0x4)+parseInt(_0x427d52(0xfb))/0x5+-parseInt(_0x427d52(0xfe))/0x6*(-parseInt(_0x427d52(0x100))/0x7)+parseInt(_0x427d52(0x101))/0x8+parseInt(_0x427d52(0xf9))/0x9;if(_0xd1d25a===_0x410482)break;else _0xb9cf54['push'](_0xb9cf54['shift']());}catch(_0x39325d){_0xb9cf54['push'](_0xb9cf54['shift']());}}}(a0_0x373b,0xb453b));import{auth}from'@clerk/nextjs/server';function a0_0xf011(_0x2a50ba,_0xf1d92d){const _0x373b58=a0_0x373b();return a0_0xf011=function(_0xf011e6,_0x43a437){_0xf011e6=_0xf011e6-0xf6;let _0x36c106=_0x373b58[_0xf011e6];return _0x36c106;},a0_0xf011(_0x2a50ba,_0xf1d92d);}function a0_0x373b(){const _0x15ece0=['353868wMJWml','18zdduGq','bundle','511112HlRwUX','4586624oNJLLR','unknown','14250kLlWGi','4576gotEXs','1886904UqLNus','456ixOQEL','528645nqroyQ','Error\x20checking\x20payment\x20status:'];a0_0x373b=function(){return _0x15ece0;};return a0_0x373b();}import{isBundleEnrolled}from'@/sanity/lib/student/isBundleEnrolled';import{isEnrolledInCourse}from'@/sanity/lib/student/isEnrolledInCourse';export async function checkPaymentStatus(_0x164bec){const _0x5b2bf9=a0_0xf011;try{const {userId:_0x11d532}=await auth();if(!_0x11d532)return{'status':'error','type':'unknown','message':'User\x20not\x20authenticated'};const _0x338580=_0x164bec['split']('--');if(_0x338580['length']<0x3)return{'status':'error','type':_0x5b2bf9(0xf6),'message':'Invalid\x20order\x20reference\x20format'};if(_0x338580[0x0]==='bundle'&&_0x338580['length']>=0x4){const _0x16d91f=_0x338580[0x1],_0x2aa171=_0x338580[0x2];if(_0x2aa171!==_0x11d532)return{'status':'error','type':'bundle','message':'Order\x20does\x20not\x20belong\x20to\x20current\x20user'};const _0x1531db=await isBundleEnrolled(_0x11d532,_0x16d91f);return _0x1531db?{'status':'completed','type':'bundle','message':'Bundle\x20enrollment\x20completed\x20successfully!','redirectUrl':'/payment/success?payment_success=true&type=bundle','bundleId':_0x16d91f}:{'status':'pending','type':_0x5b2bf9(0xff),'bundleId':_0x16d91f};}else{const _0x2b590f=_0x338580[0x0],_0xb20fc0=_0x338580[0x1];if(_0xb20fc0!==_0x11d532)return{'status':'error','type':'course','message':'Order\x20does\x20not\x20belong\x20to\x20current\x20user'};const _0x46d0bf=await isEnrolledInCourse(_0x11d532,_0x2b590f);return _0x46d0bf?{'status':'completed','type':'course','message':'Course\x20enrollment\x20completed\x20successfully!','redirectUrl':'/payment/success?payment_success=true&type=course','courseId':_0x2b590f}:{'status':'pending','type':'course','message':'Course\x20payment\x20is\x20still\x20being\x20processed...','courseId':_0x2b590f};}}catch(_0x8850a5){return console['error'](_0x5b2bf9(0xfc),_0x8850a5),{'status':'error','type':'unknown','message':'Failed\x20to\x20check\x20payment\x20status'};}}
