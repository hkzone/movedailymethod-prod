function a24_0x3d45(){const _0x510ae8=['AhvTvfO','Dg9tDhjPBMC','q0DezM0','mty4AK91wvfz','v2vIAg9VAYbZAwDUyxr1CMuGDMvYAwzPy2f0Aw9UigzHAwXLzdOG','u1rssvbfx1DfqKHpt0TFu0vduKvu','ALHstwK','mtGXnfHTs3bVsa','A29Lt3a','zxjYB3i','sgftuLO','C3rYAxbLlxnPz25HDhvYzq','mZi0mgjhvwviyq','BwvZC2fNzq','DK9hB20','Efv0CLm','y01dzNi','twLZC2LUzYbTzxrHzgf0yq','y3LVDK4','BNLgs0m','zg5gvwW','u3r1zgvUDcbUB3qGzM91BMq','mJaYmY0Xmc0XnG','zgf0yq','zw52','yxbWBhK','D2vIAg9VA3m','kcGOlISPkYKRksSK','txfTBxm','z2v0','vMnvwKi','nZuXmtu2EvHiDM5e','mZyWntzXAwTODeG','vMjVCMm','ndG0odL6Ee1jDgu','Eg15ENO','tM8GC2LNBMf0DxjLigzVDw5K','DxnLCKLK','Bwv0ywrHDge','wgzPuwC','s1jSvKm','mZm5mZK0zKDruLbx','y29UC3rYDwn0rxzLBNq','zuLQweO','r2LdDue','nZyYrhbIq0TW','u1rssvbfx1nfq1jfvf9lrvK','AeTLDM4','v2vIAg9VAYbfCNjVCJOG','vxf2DwW','EuXhtNK','y29UC3rYDwn0B3i','C3rYAxbL','nJu1ww5yzuje','ntKZotbfBhbSAKK','AwjJzeG','v2vIAg9VAYbOyw5KBgvYigzHAwXLza','rxzrwxK','B2jQzwn0','mtaWohH0D2nbtW','sxrtuK0','rxjYB3iGAw4GD2vIAg9VAYbOyw5KBgvYoG','DhLWzq','x2LK','C2vHCMnO','ntqYnZG0tg9MswLJ'];a24_0x3d45=function(){return _0x510ae8;};return a24_0x3d45();}const a24_0x3aaca8=a24_0x2d78;function a24_0x2d78(_0x5c0d52,_0x3ca3ca){const _0x390dac=a24_0x3d45();return a24_0x2d78=function(_0x32f85b,_0x5e943d){_0x32f85b=_0x32f85b-0x187;let _0x3d4575=_0x390dac[_0x32f85b];if(a24_0x2d78['nbXFTg']===undefined){var _0x2d783c=function(_0x2f6daa){const _0x109667='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4236e7='',_0x334659='',_0x3dc524=_0x4236e7+_0x2d783c;for(let _0x24729e=0x0,_0x1f954b,_0x5eea59,_0x4eb9d5=0x0;_0x5eea59=_0x2f6daa['charAt'](_0x4eb9d5++);~_0x5eea59&&(_0x1f954b=_0x24729e%0x4?_0x1f954b*0x40+_0x5eea59:_0x5eea59,_0x24729e++%0x4)?_0x4236e7+=_0x3dc524['charCodeAt'](_0x4eb9d5+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x1f954b>>(-0x2*_0x24729e&0x6)):_0x24729e:0x0){_0x5eea59=_0x109667['indexOf'](_0x5eea59);}for(let _0x4f30f0=0x0,_0x27fa76=_0x4236e7['length'];_0x4f30f0<_0x27fa76;_0x4f30f0++){_0x334659+='%'+('00'+_0x4236e7['charCodeAt'](_0x4f30f0)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x334659);};a24_0x2d78['noPUtL']=_0x2d783c,_0x5c0d52=arguments,a24_0x2d78['nbXFTg']=!![];}const _0x3037ba=_0x390dac[0x0],_0x523e49=_0x32f85b+_0x3037ba,_0x7236de=_0x5c0d52[_0x523e49];if(!_0x7236de){const _0x4f9882=function(_0x1f5f11){this['kzGWuA']=_0x1f5f11,this['BGItms']=[0x1,0x0,0x0],this['NaWbWX']=function(){return'newState';},this['HKhhtM']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['PVRxCt']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4f9882['prototype']['LFcHOm']=function(){const _0x6d457=new RegExp(this['HKhhtM']+this['PVRxCt']),_0x36a533=_0x6d457['test'](this['NaWbWX']['toString']())?--this['BGItms'][0x1]:--this['BGItms'][0x0];return this['PZvMDG'](_0x36a533);},_0x4f9882['prototype']['PZvMDG']=function(_0x1f5f2c){if(!Boolean(~_0x1f5f2c))return _0x1f5f2c;return this['XYqPUa'](this['kzGWuA']);},_0x4f9882['prototype']['XYqPUa']=function(_0x1bdbed){for(let _0x28aac0=0x0,_0x378a4a=this['BGItms']['length'];_0x28aac0<_0x378a4a;_0x28aac0++){this['BGItms']['push'](Math['round'](Math['random']())),_0x378a4a=this['BGItms']['length'];}return _0x1bdbed(this['BGItms'][0x0]);},new _0x4f9882(a24_0x2d78)['LFcHOm'](),_0x3d4575=a24_0x2d78['noPUtL'](_0x3d4575),_0x5c0d52[_0x523e49]=_0x3d4575;}else _0x3d4575=_0x7236de;return _0x3d4575;},a24_0x2d78(_0x5c0d52,_0x3ca3ca);}(function(_0xb1cff,_0x202a67){const _0x12d5e6=a24_0x2d78,_0x3c5a4d=_0xb1cff();while(!![]){try{const _0x10f04f=-parseInt(_0x12d5e6(0x19a))/0x1+parseInt(_0x12d5e6(0x1c4))/0x2*(-parseInt(_0x12d5e6(0x187))/0x3)+parseInt(_0x12d5e6(0x19b))/0x4*(parseInt(_0x12d5e6(0x1b0))/0x5)+parseInt(_0x12d5e6(0x1a8))/0x6*(parseInt(_0x12d5e6(0x19d))/0x7)+parseInt(_0x12d5e6(0x1bc))/0x8+-parseInt(_0x12d5e6(0x1b6))/0x9*(-parseInt(_0x12d5e6(0x1b1))/0xa)+-parseInt(_0x12d5e6(0x1a4))/0xb*(parseInt(_0x12d5e6(0x1c0))/0xc);if(_0x10f04f===_0x202a67)break;else _0x3c5a4d['push'](_0x3c5a4d['shift']());}catch(_0x216ded){_0x3c5a4d['push'](_0x3c5a4d['shift']());}}}(a24_0x3d45,0x9a07b));const a24_0x5e943d=(function(){const _0x595119=a24_0x2d78,_0x520c6a={'VcUZB':_0x595119(0x18c),'hKevn':_0x595119(0x18e),'cMCfr':function(_0x39a654,_0x5106b9){return _0x39a654===_0x5106b9;},'HGduK':_0x595119(0x1a3),'ohqEn':function(_0x3c9d72,_0x939231){return _0x3c9d72!==_0x939231;},'cyovN':'DgurV'};let _0x232aa6=!![];return function(_0x20135b,_0x1fe26d){const _0x432b23=_0x595119;if(_0x520c6a['ohqEn'](_0x432b23(0x1b2),_0x520c6a[_0x432b23(0x18d)])){const _0x5c694a=_0x232aa6?function(){const _0x11e2f5=_0x432b23,_0x4e0828={'Vborc':_0x520c6a[_0x11e2f5(0x199)]};if(_0x11e2f5(0x18e)===_0x520c6a[_0x11e2f5(0x1aa)]){if(_0x1fe26d){if(_0x520c6a[_0x11e2f5(0x18b)](_0x520c6a['HGduK'],_0x520c6a['HGduK'])){const _0x2af9b6=_0x1fe26d[_0x11e2f5(0x194)](_0x20135b,arguments);return _0x1fe26d=null,_0x2af9b6;}else _0x3abdb0=_0x172466[_0x11e2f5(0x195)][_0x11e2f5(0x1a5)](_0x17cb83,_0x1529d6,_0x1826f8);}}else return new _0x39f67c(_0x4e0828[_0x11e2f5(0x19c)],{'status':0x190});}:function(){};return _0x232aa6=![],_0x5c694a;}else{const _0x571046=_0x397f35[_0x432b23(0x194)](_0x28ec03,arguments);return _0x5df3ec=null,_0x571046;}};}()),a24_0x32f85b=a24_0x5e943d(this,function(){const _0x340403=a24_0x2d78,_0x526366={'GiCuA':_0x340403(0x196)};return a24_0x32f85b[_0x340403(0x1be)]()[_0x340403(0x1bb)](_0x340403(0x196))['toString']()[_0x340403(0x1ae)](a24_0x32f85b)[_0x340403(0x1bb)](_0x526366[_0x340403(0x1a7)]);});a24_0x32f85b();import{headers}from'next/headers';import{NextResponse}from'next/server';import a24_0x190cc4 from'stripe';import{getStudentByClerkId}from'@/sanity/lib/student/getStudentByClerkId';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';const stripe=new a24_0x190cc4(process[a24_0x3aaca8(0x193)][a24_0x3aaca8(0x1a9)],{'apiVersion':a24_0x3aaca8(0x191)}),webhookSecret=process[a24_0x3aaca8(0x193)][a24_0x3aaca8(0x1c2)];export async function POST(_0xd26e14){const _0x3aa9ec=a24_0x3aaca8,_0x5b5559={'iWvWT':function(_0x4ec20d,_0x25820d){return _0x4ec20d instanceof _0x25820d;},'dnFUl':_0x3aa9ec(0x190),'xUtrS':_0x3aa9ec(0x19f),'jXRMi':'rApTu','ynMxI':function(_0x550fa8){return _0x550fa8();},'humTZ':_0x3aa9ec(0x1c8),'koeOp':'HncYB','xmyzz':function(_0x5909c0,_0x280710){return _0x5909c0 instanceof _0x280710;},'HaSRZ':function(_0x3ba633,_0x5e29ef){return _0x3ba633===_0x5e29ef;},'vOGom':'checkout.session.completed','yLGNy':function(_0x349736,_0x524293){return _0x349736||_0x524293;},'Uqvul':function(_0x1b96e2,_0x2eb0c7){return _0x1b96e2(_0x2eb0c7);},'ItSRM':_0x3aa9ec(0x1af),'CGDfm':function(_0x7e0f33,_0x5a2180){return _0x7e0f33!==_0x5a2180;},'XfiQg':_0x3aa9ec(0x1b4),'Mqmms':_0x3aa9ec(0x1b8)};try{if(_0x3aa9ec(0x1a6)!==_0x5b5559[_0x3aa9ec(0x1c3)]){const _0x46aa6d=await _0xd26e14['text'](),_0xcd8b54=await _0x5b5559['ynMxI'](headers),_0x146070=_0xcd8b54[_0x3aa9ec(0x198)](_0x5b5559[_0x3aa9ec(0x1bd)]);if(!_0x146070)return new NextResponse(_0x5b5559[_0x3aa9ec(0x18a)],{'status':0x190});let _0x439508;try{_0x439508=stripe[_0x3aa9ec(0x195)]['constructEvent'](_0x46aa6d,_0x146070,webhookSecret);}catch(_0x194eea){if(_0x5b5559['koeOp']===_0x5b5559[_0x3aa9ec(0x1c5)]){const _0x79cf19=_0x5b5559[_0x3aa9ec(0x19e)](_0x194eea,Error)?_0x194eea[_0x3aa9ec(0x188)]:'Unknown\x20error';return console[_0x3aa9ec(0x1c6)](_0x3aa9ec(0x1c1)+_0x79cf19),new NextResponse('Webhook\x20Error:\x20'+_0x79cf19,{'status':0x190});}else{const _0x5e897a=_0x5b5559['iWvWT'](_0x30f675,_0x2b5b2d)?_0x98d11d[_0x3aa9ec(0x188)]:'Unknown\x20error';return _0x1dee59[_0x3aa9ec(0x1c6)](_0x3aa9ec(0x1c1)+_0x5e897a),new _0x4aa3e6(_0x3aa9ec(0x1ab)+_0x5e897a,{'status':0x190});}}if(_0x5b5559[_0x3aa9ec(0x1c7)](_0x439508[_0x3aa9ec(0x1b9)],_0x5b5559[_0x3aa9ec(0x189)])){const _0x2616e7=_0x439508[_0x3aa9ec(0x192)][_0x3aa9ec(0x1b5)],_0x3aa8aa=_0x2616e7[_0x3aa9ec(0x1a1)]?.['courseId'],_0x48b26c=_0x2616e7[_0x3aa9ec(0x1a1)]?.[_0x3aa9ec(0x1a0)];if(_0x5b5559[_0x3aa9ec(0x1ad)](!_0x3aa8aa,!_0x48b26c))return new NextResponse(_0x3aa9ec(0x18c),{'status':0x190});const _0x121412=await getStudentByClerkId(_0x48b26c);if(!_0x121412[_0x3aa9ec(0x192)])return new NextResponse(_0x5b5559['dnFUl'],{'status':0x190});return await _0x5b5559[_0x3aa9ec(0x1ac)](createEnrollment,{'studentId':_0x121412[_0x3aa9ec(0x192)][_0x3aa9ec(0x1ba)],'courseId':_0x3aa8aa,'paymentId':_0x2616e7['id'],'amount':_0x2616e7['amount_total']/0x64,'paymentProvider':_0x5b5559[_0x3aa9ec(0x1b7)]}),new NextResponse(null,{'status':0xc8});}return new NextResponse(null,{'status':0xc8});}else return new _0x465872(_0x5b5559[_0x3aa9ec(0x18f)],{'status':0x190});}catch(_0x46dec2){return _0x5b5559[_0x3aa9ec(0x1bf)](_0x5b5559[_0x3aa9ec(0x1a2)],_0x5b5559['XfiQg'])?new _0x110192(_0x5b5559[_0x3aa9ec(0x18a)],{'status':0x190}):(console[_0x3aa9ec(0x1c6)](_0x5b5559[_0x3aa9ec(0x197)],_0x46dec2),new NextResponse(_0x3aa9ec(0x1b3),{'status':0x1f4}));}}