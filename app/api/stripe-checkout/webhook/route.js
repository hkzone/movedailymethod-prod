const a5_0x4a925e=a5_0x2a9a;(function(_0x152bad,_0x47d12a){const _0x5dabf0=a5_0x2a9a,_0x31847f=_0x152bad();while(!![]){try{const _0x387312=parseInt(_0x5dabf0(0x16f))/0x1*(-parseInt(_0x5dabf0(0x18e))/0x2)+-parseInt(_0x5dabf0(0x183))/0x3+parseInt(_0x5dabf0(0x191))/0x4+-parseInt(_0x5dabf0(0x184))/0x5+parseInt(_0x5dabf0(0x175))/0x6*(-parseInt(_0x5dabf0(0x178))/0x7)+-parseInt(_0x5dabf0(0x18a))/0x8*(-parseInt(_0x5dabf0(0x165))/0x9)+parseInt(_0x5dabf0(0x16b))/0xa*(parseInt(_0x5dabf0(0x17d))/0xb);if(_0x387312===_0x47d12a)break;else _0x31847f['push'](_0x31847f['shift']());}catch(_0x26faf0){_0x31847f['push'](_0x31847f['shift']());}}}(a5_0x3ba0,0x40b86));function a5_0x2a9a(_0x5b70dc,_0x24e321){const _0x4ae5ee=a5_0x3ba0();return a5_0x2a9a=function(_0x4a3639,_0x51cbc3){_0x4a3639=_0x4a3639-0x15d;let _0x3ba0a4=_0x4ae5ee[_0x4a3639];if(a5_0x2a9a['vYpIDB']===undefined){var _0x2a9afc=function(_0x1e8cad){const _0x3a4544='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x13fa0c='',_0x52a5f7='',_0x4d4162=_0x13fa0c+_0x2a9afc;for(let _0x2d841e=0x0,_0x1dcc54,_0x13b8db,_0x28d214=0x0;_0x13b8db=_0x1e8cad['charAt'](_0x28d214++);~_0x13b8db&&(_0x1dcc54=_0x2d841e%0x4?_0x1dcc54*0x40+_0x13b8db:_0x13b8db,_0x2d841e++%0x4)?_0x13fa0c+=_0x4d4162['charCodeAt'](_0x28d214+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x1dcc54>>(-0x2*_0x2d841e&0x6)):_0x2d841e:0x0){_0x13b8db=_0x3a4544['indexOf'](_0x13b8db);}for(let _0x5a9fa9=0x0,_0x1970c8=_0x13fa0c['length'];_0x5a9fa9<_0x1970c8;_0x5a9fa9++){_0x52a5f7+='%'+('00'+_0x13fa0c['charCodeAt'](_0x5a9fa9)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x52a5f7);};a5_0x2a9a['XLeWrY']=_0x2a9afc,_0x5b70dc=arguments,a5_0x2a9a['vYpIDB']=!![];}const _0x4cba70=_0x4ae5ee[0x0],_0x59b1e4=_0x4a3639+_0x4cba70,_0x94a583=_0x5b70dc[_0x59b1e4];if(!_0x94a583){const _0x3ba70a=function(_0x48f513){this['SAlSmE']=_0x48f513,this['zjwsKy']=[0x1,0x0,0x0],this['AxghEK']=function(){return'newState';},this['ttuVpi']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['pVztsB']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3ba70a['prototype']['dNZCqw']=function(){const _0x29dbe2=new RegExp(this['ttuVpi']+this['pVztsB']),_0x35184e=_0x29dbe2['test'](this['AxghEK']['toString']())?--this['zjwsKy'][0x1]:--this['zjwsKy'][0x0];return this['gFrhen'](_0x35184e);},_0x3ba70a['prototype']['gFrhen']=function(_0xbf7e08){if(!Boolean(~_0xbf7e08))return _0xbf7e08;return this['BtfoXJ'](this['SAlSmE']);},_0x3ba70a['prototype']['BtfoXJ']=function(_0x4e6287){for(let _0x58e1b1=0x0,_0x4cc3f6=this['zjwsKy']['length'];_0x58e1b1<_0x4cc3f6;_0x58e1b1++){this['zjwsKy']['push'](Math['round'](Math['random']())),_0x4cc3f6=this['zjwsKy']['length'];}return _0x4e6287(this['zjwsKy'][0x0]);},new _0x3ba70a(a5_0x2a9a)['dNZCqw'](),_0x3ba0a4=a5_0x2a9a['XLeWrY'](_0x3ba0a4),_0x5b70dc[_0x59b1e4]=_0x3ba0a4;}else _0x3ba0a4=_0x94a583;return _0x3ba0a4;},a5_0x2a9a(_0x5b70dc,_0x24e321);}const a5_0x51cbc3=(function(){const _0x236c01=a5_0x2a9a,_0x1a690b={'AmMkW':function(_0x28645f,_0x595b15){return _0x28645f===_0x595b15;},'rYvDO':_0x236c01(0x17c)};let _0x570faf=!![];return function(_0x47dc44,_0x233c98){const _0x289a7c=_0x236c01;if(_0x1a690b['AmMkW'](_0x1a690b[_0x289a7c(0x167)],_0x289a7c(0x188)))_0x38fad2=_0x3c1f80['webhooks'][_0x289a7c(0x164)](_0x960a19,_0x2b445a,_0xbe4c59);else{const _0x22bb47=_0x570faf?function(){const _0x270dff=_0x289a7c;if(_0x233c98){const _0x2763=_0x233c98[_0x270dff(0x177)](_0x47dc44,arguments);return _0x233c98=null,_0x2763;}}:function(){};return _0x570faf=![],_0x22bb47;}};}()),a5_0x4a3639=a5_0x51cbc3(this,function(){const _0x573b80=a5_0x2a9a,_0x242672={'kBGbV':_0x573b80(0x185)};return a5_0x4a3639['toString']()[_0x573b80(0x171)](_0x242672[_0x573b80(0x163)])['toString']()[_0x573b80(0x162)](a5_0x4a3639)['search'](_0x573b80(0x185));});a5_0x4a3639();import{headers}from'next/headers';import{NextResponse}from'next/server';import a5_0x2dd49c from'stripe';import{getStudentByClerkId}from'@/sanity/lib/student/getStudentByClerkId';function a5_0x3ba0(){const _0x2f94d6=['A0jhyLy','y29UC3rYDwn0rxzLBNq','mJi5odz3q0jSC1K','Dgv4Da','CLL2re8','Du1ztwq','BwvZC2fNzq','DxnLCKLK','odq2mtbgzgT2wM0','DuX5Bfm','B2jQzwn0','zgf0yq','nteWntG5BuTkr2jX','z2v0','C2vHCMnO','CgXdse8','zLnnzNu','zxjYB3i','mZa3mNzNuMLiza','rNLuAeC','yxbWBhK','ndy2mMXxsLHtEG','C3rYAxbL','AvDwwwq','AK1frMG','rMHUrNi','mtyZowfICwHNrq','tM8GC2LNBMf0DxjLigzVDw5K','yw1VDw50x3rVDgfS','y291CNnLswq','Bwv0ywrHDge','vw5RBM93BIbLCNjVCG','mte0mZaYn3nYvMf3wa','mty4mJm3nvrrvfnPBa','kcGOlISPkYKRksSK','zw52','zLLLC0O','ywPbEwS','A3DkyvG','mtmYoe5VvLnova','v2rPv1K','zK96C1u','sgfczey','mNb0thvYwq','y2HLy2TVDxqUC2vZC2LVBI5JB21WBgv0zwq','zwfmuLi','ntK4mdi0rffbtNLN','teTwtNm','C3rYAxbLlxnPz25HDhvYzq','mJaYmY0Xmc0XnG','u3r1zgvUDcbUB3qGzM91BMq','zeTKzLG','rxjYB3iGAw4GD2vIAg9VAYbOyw5KBgvYoG','y29UC3rYDwn0B3i'];a5_0x3ba0=function(){return _0x2f94d6;};return a5_0x3ba0();}import{createEnrollment}from'@/sanity/lib/student/createEnrollment';const stripe=new a5_0x2dd49c(process[a5_0x4a925e(0x186)]['STRIPE_SECRET_KEY'],{'apiVersion':a5_0x4a925e(0x15e)}),webhookSecret=process['env']['STRIPE_WEBHOOK_SECRET'];export async function POST(_0x5e376f){const _0x586b82=a5_0x4a925e,_0x79229={'uMYMd':_0x586b82(0x15f),'eaLRR':_0x586b82(0x15d),'iWVYd':_0x586b82(0x17e),'fOzsU':function(_0x233c6f,_0x1e41a3){return _0x233c6f===_0x1e41a3;},'WdiWY':_0x586b82(0x17b),'LKVNs':_0x586b82(0x182),'FyThG':function(_0x56f8a5,_0x32c71a){return _0x56f8a5===_0x32c71a;},'fYesJ':_0x586b82(0x18f),'uLylS':function(_0x415393,_0x62c24a){return _0x415393===_0x62c24a;},'fSMfu':function(_0x200923,_0x14e140){return _0x200923===_0x14e140;},'JBvLz':function(_0x5d2c70,_0x17fb21){return _0x5d2c70/_0x17fb21;},'dKdfX':_0x586b82(0x179),'kwJaX':_0x586b82(0x161),'plCHO':'Webhook\x20handler\x20failed'};var _0x52d3df,_0x2a90fa;try{const _0xd7db24=await _0x5e376f[_0x586b82(0x166)](),_0x3a5443=await headers(),_0x42b159=_0x3a5443[_0x586b82(0x170)](_0x79229[_0x586b82(0x190)]);if(!_0x42b159)return new NextResponse(_0x79229[_0x586b82(0x17a)],{'status':0x190});let _0x36d6d7;try{if(_0x79229[_0x586b82(0x18c)](_0x79229[_0x586b82(0x18b)],_0x586b82(0x18d)))return new _0x213344(_0x79229[_0x586b82(0x168)],{'status':0x190});else _0x36d6d7=stripe['webhooks'][_0x586b82(0x164)](_0xd7db24,_0x42b159,webhookSecret);}catch(_0x1e0128){const _0x2c565c=_0x1e0128 instanceof Error?_0x1e0128[_0x586b82(0x169)]:_0x79229[_0x586b82(0x192)];return console[_0x586b82(0x174)]('Webhook\x20signature\x20verification\x20failed:\x20'+_0x2c565c),new NextResponse('Webhook\x20Error:\x20'+_0x2c565c,{'status':0x190});}if(_0x79229[_0x586b82(0x176)](_0x36d6d7['type'],_0x79229[_0x586b82(0x187)])){const _0x4b9b25=_0x36d6d7[_0x586b82(0x16e)][_0x586b82(0x16d)],_0x2fbe32=_0x79229[_0x586b82(0x16c)](_0x52d3df=_0x4b9b25[_0x586b82(0x181)],null)||_0x52d3df===void 0x0?void 0x0:_0x52d3df[_0x586b82(0x180)],_0x14bc58=_0x79229[_0x586b82(0x173)](_0x2a90fa=_0x4b9b25[_0x586b82(0x181)],null)||_0x79229['fOzsU'](_0x2a90fa,void 0x0)?void 0x0:_0x2a90fa[_0x586b82(0x16a)];if(!_0x2fbe32||!_0x14bc58)return new NextResponse('Missing\x20metadata',{'status':0x190});const _0x51e577=await getStudentByClerkId(_0x14bc58);if(!_0x51e577[_0x586b82(0x16e)])return new NextResponse(_0x586b82(0x15f),{'status':0x190});return await createEnrollment({'studentId':_0x51e577['data']['_id'],'courseId':_0x2fbe32,'paymentId':_0x4b9b25['id'],'amount':_0x79229['JBvLz'](_0x4b9b25[_0x586b82(0x17f)],0x64),'paymentProvider':_0x79229[_0x586b82(0x160)]}),new NextResponse(null,{'status':0xc8});}return new NextResponse(null,{'status':0xc8});}catch(_0x5eb6e6){return console['error'](_0x79229[_0x586b82(0x189)],_0x5eb6e6),new NextResponse(_0x79229[_0x586b82(0x172)],{'status':0x1f4});}}