const a7_0x28c927=a7_0x2a19;(function(_0x541355,_0x19f9b0){const _0xc74b6c=a7_0x2a19,_0x1a2bce=_0x541355();while(!![]){try{const _0xc8508c=-parseInt(_0xc74b6c(0x1ee))/0x1+parseInt(_0xc74b6c(0x1e4))/0x2+parseInt(_0xc74b6c(0x1fd))/0x3+parseInt(_0xc74b6c(0x1dc))/0x4+parseInt(_0xc74b6c(0x1d3))/0x5+-parseInt(_0xc74b6c(0x1e5))/0x6*(parseInt(_0xc74b6c(0x1c8))/0x7)+-parseInt(_0xc74b6c(0x1da))/0x8;if(_0xc8508c===_0x19f9b0)break;else _0x1a2bce['push'](_0x1a2bce['shift']());}catch(_0x48435e){_0x1a2bce['push'](_0x1a2bce['shift']());}}}(a7_0x39d9,0x97fdd));const a7_0x44c445=(function(){const _0x394ec1=a7_0x2a19,_0x46f19c={'FoZII':function(_0x207604,_0xd76163){return _0x207604 instanceof _0xd76163;},'TiaKM':_0x394ec1(0x1e9)};let _0x551b2e=!![];return function(_0x2bc86e,_0x26828c){const _0xfbb87a=_0x394ec1,_0x5a2a6c={'zPcrf':function(_0x81c244,_0x370c53){const _0xc7e4ef=a7_0x2a19;return _0x46f19c[_0xc7e4ef(0x1c9)](_0x81c244,_0x370c53);},'fTISM':_0x46f19c[_0xfbb87a(0x1ef)],'Qkylf':_0xfbb87a(0x1d7)},_0x158014=_0x551b2e?function(){const _0xf3b966=_0xfbb87a;if(_0x26828c){if(_0x5a2a6c[_0xf3b966(0x1e8)]===_0x5a2a6c['Qkylf']){const _0xcf8bbe=_0x26828c[_0xf3b966(0x1de)](_0x2bc86e,arguments);return _0x26828c=null,_0xcf8bbe;}else{const _0x3777eb=_0x5a2a6c['zPcrf'](_0x5be9a0,_0xebdc68)?_0x2302a4[_0xf3b966(0x1eb)]:_0x5a2a6c[_0xf3b966(0x1c6)];return _0x33d45e['error']('Webhook\x20signature\x20verification\x20failed:\x20'+_0x3777eb),new _0x47d961(_0xf3b966(0x1df)+_0x3777eb,{'status':0x190});}}}:function(){};return _0x551b2e=![],_0x158014;};}()),a7_0x59768a=a7_0x44c445(this,function(){const _0x1877bb=a7_0x2a19,_0x48ce8e={'rYsyF':_0x1877bb(0x1f8)};return a7_0x59768a['toString']()[_0x1877bb(0x1e7)](_0x48ce8e[_0x1877bb(0x1d2)])[_0x1877bb(0x1cc)]()[_0x1877bb(0x1f9)](a7_0x59768a)[_0x1877bb(0x1e7)]('(((.+)+)+)+$');});a7_0x59768a();import{headers}from'next/headers';function a7_0x2a19(_0x4105c4,_0x4cd7cb){const _0x3455af=a7_0x39d9();return a7_0x2a19=function(_0x59768a,_0x44c445){_0x59768a=_0x59768a-0x1c3;let _0x39d980=_0x3455af[_0x59768a];if(a7_0x2a19['vzNykp']===undefined){var _0x2a1930=function(_0x38e446){const _0xa5a61c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x572953='',_0x4fa3c8='',_0x3fefa5=_0x572953+_0x2a1930;for(let _0x293ca3=0x0,_0x19ccc1,_0x56e8b0,_0x12626a=0x0;_0x56e8b0=_0x38e446['charAt'](_0x12626a++);~_0x56e8b0&&(_0x19ccc1=_0x293ca3%0x4?_0x19ccc1*0x40+_0x56e8b0:_0x56e8b0,_0x293ca3++%0x4)?_0x572953+=_0x3fefa5['charCodeAt'](_0x12626a+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x19ccc1>>(-0x2*_0x293ca3&0x6)):_0x293ca3:0x0){_0x56e8b0=_0xa5a61c['indexOf'](_0x56e8b0);}for(let _0x3791e8=0x0,_0x520853=_0x572953['length'];_0x3791e8<_0x520853;_0x3791e8++){_0x4fa3c8+='%'+('00'+_0x572953['charCodeAt'](_0x3791e8)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4fa3c8);};a7_0x2a19['fVTxwv']=_0x2a1930,_0x4105c4=arguments,a7_0x2a19['vzNykp']=!![];}const _0x1fe904=_0x3455af[0x0],_0x3a4c1e=_0x59768a+_0x1fe904,_0x49c217=_0x4105c4[_0x3a4c1e];if(!_0x49c217){const _0x4aaf7d=function(_0x45bc47){this['tjpywx']=_0x45bc47,this['yFITmo']=[0x1,0x0,0x0],this['wivOmZ']=function(){return'newState';},this['TRaNpt']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['qHvBjv']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4aaf7d['prototype']['ejBoxU']=function(){const _0x5c0e0b=new RegExp(this['TRaNpt']+this['qHvBjv']),_0x201f52=_0x5c0e0b['test'](this['wivOmZ']['toString']())?--this['yFITmo'][0x1]:--this['yFITmo'][0x0];return this['YfExnm'](_0x201f52);},_0x4aaf7d['prototype']['YfExnm']=function(_0x5e7c34){if(!Boolean(~_0x5e7c34))return _0x5e7c34;return this['WdBpbX'](this['tjpywx']);},_0x4aaf7d['prototype']['WdBpbX']=function(_0x4d5986){for(let _0x2fe4ae=0x0,_0x2999a3=this['yFITmo']['length'];_0x2fe4ae<_0x2999a3;_0x2fe4ae++){this['yFITmo']['push'](Math['round'](Math['random']())),_0x2999a3=this['yFITmo']['length'];}return _0x4d5986(this['yFITmo'][0x0]);},new _0x4aaf7d(a7_0x2a19)['ejBoxU'](),_0x39d980=a7_0x2a19['fVTxwv'](_0x39d980),_0x4105c4[_0x3a4c1e]=_0x39d980;}else _0x39d980=_0x49c217;return _0x39d980;},a7_0x2a19(_0x4105c4,_0x4cd7cb);}import{NextResponse}from'next/server';import a7_0x3f22b1 from'stripe';import{getStudentByClerkId}from'@/sanity/lib/student/getStudentByClerkId';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';const stripe=new a7_0x3f22b1(process['env'][a7_0x28c927(0x1e2)],{'apiVersion':'2023-10-16'}),webhookSecret=process['env']['STRIPE_WEBHOOK_SECRET'];function a7_0x39d9(){const _0x3f03dd=['mtC0Awzgv0zw','zgf0yq','C2vHCMnO','uwT5Bgy','vw5RBM93BIbLCNjVCG','yuPzwLq','BwvZC2fNzq','zuLxsxG','zgjABvO','mteZmZyYnfzmzfPosG','vgLHs00','x2LK','rxjYB3iGAw4GD2vIAg9VAYbOyw5KBgvYoG','tM8GC2LNBMf0DxjLigzVDw5K','Bwv0ywrHDge','t3L6se0','DxnLCKLK','D2vIAg9VA3m','AfLszgK','kcGOlISPkYKRksSK','y29UC3rYDwn0B3i','u3r1zgvUDcbUB3qGzM91BMq','q1LvuMi','Dgv4Da','mJG1oda0C2j2sM9J','sNDotgG','BwPQBuy','yw1VDw50x3rVDgfS','zLrju00','v2vIAg9VAYbOyw5KBgvYigzHAwXLza','mZu2nJvmEuvtwLG','rM9AsuK','CKfNr04','y2HLy2TVDxqUC2vZC2LVBI5JB21WBgv0zwq','Dg9tDhjPBMC','B2jQzwn0','y29UC3rYDwn0rxzLBNq','vLbxBvi','DwDsqvO','vNfxwLC','CLLZEuy','mJuZnJyXmeX3Afj5Aq','BeTHuLa','DvfesKe','A0r0EhG','q1LUt2m','uKT5D20','zxjYB3i','mJaYnZe1mM9xBKvrrW','s01Xvge','mJCWodCWmgL2v2LrqG','yMjlueS','yxbWBhK','v2vIAg9VAYbfCNjVCJOG','swnYyMC','q1Dkt1G','u1rssvbfx1nfq1jfvf9lrvK','s21irxy','mtC1nteZmfHPvvrAsa'];a7_0x39d9=function(){return _0x3f03dd;};return a7_0x39d9();}export async function POST(_0x30b7d8){const _0x1cc5a7=a7_0x28c927,_0x48ceac={'rAgGN':_0x1cc5a7(0x1fa),'VqWZW':_0x1cc5a7(0x1f2),'uQDJA':function(_0x4a6b5c,_0x4ed3ad){return _0x4a6b5c===_0x4ed3ad;},'mjjmF':_0x1cc5a7(0x1d8),'aJYZT':'stripe-signature','hYRdi':function(_0x765af7,_0x127706){return _0x765af7 instanceof _0x127706;},'CYURb':_0x1cc5a7(0x1e9),'kDtxx':_0x1cc5a7(0x1cb),'CWJOX':function(_0x324a10,_0x3ac2dd){return _0x324a10===_0x3ac2dd;},'TpYbN':function(_0x155016,_0x221917){return _0x155016||_0x221917;},'dbZmZ':_0x1cc5a7(0x1cf),'lKaRP':_0x1cc5a7(0x1db),'KmHEv':'Missing\x20metadata','JwNLh':function(_0x254d5e,_0x1abda9){return _0x254d5e(_0x1abda9);},'OyzHM':function(_0x3445f8,_0x27f1fc){return _0x3445f8/_0x27f1fc;},'QGieO':'stripe','ugRAZ':function(_0x5d075e,_0x1c2ea0){return _0x5d075e!==_0x1c2ea0;},'Icrbg':_0x1cc5a7(0x1f1),'eIWIx':_0x1cc5a7(0x1c7)};var _0x4ad847,_0x1f2599;try{if(_0x48ceac[_0x1cc5a7(0x1d5)](_0x1cc5a7(0x1d8),_0x48ceac[_0x1cc5a7(0x1c4)])){const _0x4dc4e0=await _0x30b7d8[_0x1cc5a7(0x1fc)](),_0x3f4734=await headers(),_0x440a1f=_0x3f4734['get'](_0x48ceac[_0x1cc5a7(0x1ea)]);if(!_0x440a1f)return new NextResponse(_0x1cc5a7(0x1f2),{'status':0x190});let _0x3249da;try{_0x3249da=stripe[_0x1cc5a7(0x1f6)][_0x1cc5a7(0x1ce)](_0x4dc4e0,_0x440a1f,webhookSecret);}catch(_0x1cc626){const _0x1dda64=_0x48ceac[_0x1cc5a7(0x1f7)](_0x1cc626,Error)?_0x1cc626['message']:_0x48ceac[_0x1cc5a7(0x1fb)];return console[_0x1cc5a7(0x1d9)]('Webhook\x20signature\x20verification\x20failed:\x20'+_0x1dda64),new NextResponse(_0x1cc5a7(0x1df)+_0x1dda64,{'status':0x190});}if(_0x3249da['type']===_0x48ceac[_0x1cc5a7(0x1d6)]){const _0x1219d0=_0x3249da['data'][_0x1cc5a7(0x1cd)],_0xac206=_0x48ceac[_0x1cc5a7(0x1d5)](_0x4ad847=_0x1219d0[_0x1cc5a7(0x1f3)],null)||_0x48ceac[_0x1cc5a7(0x1e1)](_0x4ad847,void 0x0)?void 0x0:_0x4ad847['courseId'],_0xe06b55=(_0x1f2599=_0x1219d0[_0x1cc5a7(0x1f3)])===null||_0x1f2599===void 0x0?void 0x0:_0x1f2599[_0x1cc5a7(0x1f5)];if(_0x48ceac['TpYbN'](!_0xac206,!_0xe06b55)){if(_0x48ceac[_0x1cc5a7(0x1e1)](_0x48ceac[_0x1cc5a7(0x1ed)],_0x48ceac[_0x1cc5a7(0x1d4)])){if(_0x5a1493){const _0x19379c=_0xbbd2bb[_0x1cc5a7(0x1de)](_0x370191,arguments);return _0x5c0dee=null,_0x19379c;}}else return new NextResponse(_0x48ceac[_0x1cc5a7(0x1e3)],{'status':0x190});}const _0x1da0eb=await _0x48ceac[_0x1cc5a7(0x1c3)](getStudentByClerkId,_0xe06b55);if(!_0x1da0eb[_0x1cc5a7(0x1e6)])return new NextResponse(_0x48ceac[_0x1cc5a7(0x1ca)],{'status':0x190});return await _0x48ceac[_0x1cc5a7(0x1c3)](createEnrollment,{'studentId':_0x1da0eb['data'][_0x1cc5a7(0x1f0)],'courseId':_0xac206,'paymentId':_0x1219d0['id'],'amount':_0x48ceac[_0x1cc5a7(0x1f4)](_0x1219d0[_0x1cc5a7(0x1c5)],0x64),'paymentProvider':_0x48ceac['QGieO']}),new NextResponse(null,{'status':0xc8});}return new NextResponse(null,{'status':0xc8});}else return new _0x2239a8(_0x48ceac[_0x1cc5a7(0x1ca)],{'status':0x190});}catch(_0x2a5a8f){return _0x48ceac[_0x1cc5a7(0x1d0)](_0x1cc5a7(0x1dd),_0x1cc5a7(0x1dd))?new _0x3e8e3d(_0x48ceac[_0x1cc5a7(0x1d1)],{'status':0x190}):(console[_0x1cc5a7(0x1d9)](_0x48ceac[_0x1cc5a7(0x1e0)],_0x2a5a8f),new NextResponse(_0x48ceac[_0x1cc5a7(0x1ec)],{'status':0x1f4}));}}