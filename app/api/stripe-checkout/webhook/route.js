const a5_0x5b32e6=a5_0x4042;(function(_0x24dbc,_0x17edad){const _0x73738e=a5_0x4042,_0x2d98cb=_0x24dbc();while(!![]){try{const _0x30634e=-parseInt(_0x73738e(0x101))/0x1*(parseInt(_0x73738e(0x111))/0x2)+-parseInt(_0x73738e(0x126))/0x3*(-parseInt(_0x73738e(0xfd))/0x4)+-parseInt(_0x73738e(0x10f))/0x5+parseInt(_0x73738e(0xff))/0x6*(-parseInt(_0x73738e(0x115))/0x7)+-parseInt(_0x73738e(0x12f))/0x8*(-parseInt(_0x73738e(0xf7))/0x9)+parseInt(_0x73738e(0xfa))/0xa+parseInt(_0x73738e(0x12e))/0xb;if(_0x30634e===_0x17edad)break;else _0x2d98cb['push'](_0x2d98cb['shift']());}catch(_0x114f60){_0x2d98cb['push'](_0x2d98cb['shift']());}}}(a5_0x2ed0,0xd668d));const a5_0x1588ec=(function(){const _0x515bed=a5_0x4042,_0x20f274={'MslpK':_0x515bed(0x123),'gtCnu':_0x515bed(0x121),'QQQHb':function(_0x5bfb46,_0x25244e){return _0x5bfb46!==_0x25244e;},'GqkLN':_0x515bed(0x10c)};let _0x2b436d=!![];return function(_0xa3332f,_0x2b4c5b){const _0x589900=_0x515bed;if(_0x20f274[_0x589900(0x125)]('CQJho',_0x20f274['GqkLN'])){const _0x241ade=_0x40d57e?function(){if(_0x20d9b0){const _0x37fd84=_0x3f7441['apply'](_0x31b438,arguments);return _0x4ead63=null,_0x37fd84;}}:function(){};return _0x46b719=![],_0x241ade;}else{const _0x244297=_0x2b436d?function(){const _0x2a226a=_0x589900;if(_0x20f274[_0x2a226a(0x12b)]!==_0x20f274[_0x2a226a(0x107)]){if(_0x2b4c5b){const _0x3d7f9b=_0x2b4c5b[_0x2a226a(0x114)](_0xa3332f,arguments);return _0x2b4c5b=null,_0x3d7f9b;}}else{const _0x2a2e26=_0x1b2b32[_0x2a226a(0x114)](_0x54630c,arguments);return _0x35f356=null,_0x2a2e26;}}:function(){};return _0x2b436d=![],_0x244297;}};}()),a5_0x171ecb=a5_0x1588ec(this,function(){const _0x355814=a5_0x4042;return a5_0x171ecb[_0x355814(0x10e)]()[_0x355814(0x119)]('(((.+)+)+)+$')[_0x355814(0x10e)]()['constructor'](a5_0x171ecb)[_0x355814(0x119)](_0x355814(0x104));});a5_0x171ecb();function a5_0x2ed0(){const _0x2e5685=['u1rssvbfx1nfq1jfvf9lrvK','txnSCeS','u3r1zgvUDcbUB3qGzM91BMq','Dfjvvuu','mty1mdyWmdzPBNfqwhq','ntC4mta2ngXlELDlsq','twLZC2LUzYbTzxrHzgf0yq','BwvZC2fNzq','v2vIAg9VAYbZAwDUyxr1CMuGDMvYAwzPy2f0Aw9UigzHAwXLzdOG','zgf0yq','zxjYB3i','mtHtz0jis0C','y291CNnLswq','A0X3qvK','mta4nZiZodbKrefxrvK','C3rYAxbLlxnPz25HDhvYzq','v2vIAg9VAYbOyw5KBgvYigzHAwXLza','mte4nJK5nLDVzMLVuq','zw52','mJeWEufRwKvo','BuHiEuO','odqYmtu4DgHVCfrs','C3rYAxbL','qLbJqKK','kcGOlISPkYKRksSK','y0zjvwK','z2v0','z3rdBNu','rxjYB3iGAw4GD2vIAg9VAYbOyw5KBgvYoG','DhLqy0S','yw1VDw50x3rVDgfS','u1rssvbfx1DfqKHpt0TFu0vduKvu','q1fkAg8','mJaYmY0Xmc0XnG','Dg9tDhjPBMC','mJK2otm1nwfrz3vHza','y29UC3rYDwn0rxzLBNq','nfjsvgXuqG','CxDiD1i','t2H3weu','yxbWBhK','mJK0mdi4D1bLDM9h','Bwv0ywrHDge','tgT5wM0','B1LSrLy','C2vHCMnO','DhLWzq','zuHjvuC','Dgv4Da','rNzjBwi','vw5RBM93BIbLCNjVCG','suHdy0O','x2LK','DuXzDfK','tM8GC2LNBMf0DxjLigzVDw5K','q25KzfG','y2HLy2TVDxqUC2vZC2LVBI5JB21WBgv0zwq','uvfrsgi','nNHosMLqtq','B1fUDwK','DxnLCKLK','EeDAv20'];a5_0x2ed0=function(){return _0x2e5685;};return a5_0x2ed0();}function a5_0x4042(_0x24b52e,_0xd00b0c){const _0x5e449e=a5_0x2ed0();return a5_0x4042=function(_0x171ecb,_0x1588ec){_0x171ecb=_0x171ecb-0xf7;let _0x2ed037=_0x5e449e[_0x171ecb];if(a5_0x4042['TbAclc']===undefined){var _0x404234=function(_0xee853f){const _0x29df1c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x375f8b='',_0x212c6c='',_0x554415=_0x375f8b+_0x404234;for(let _0x4e5999=0x0,_0x2a547d,_0x17d95b,_0x58475f=0x0;_0x17d95b=_0xee853f['charAt'](_0x58475f++);~_0x17d95b&&(_0x2a547d=_0x4e5999%0x4?_0x2a547d*0x40+_0x17d95b:_0x17d95b,_0x4e5999++%0x4)?_0x375f8b+=_0x554415['charCodeAt'](_0x58475f+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x2a547d>>(-0x2*_0x4e5999&0x6)):_0x4e5999:0x0){_0x17d95b=_0x29df1c['indexOf'](_0x17d95b);}for(let _0x40d57e=0x0,_0x147ea1=_0x375f8b['length'];_0x40d57e<_0x147ea1;_0x40d57e++){_0x212c6c+='%'+('00'+_0x375f8b['charCodeAt'](_0x40d57e)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x212c6c);};a5_0x4042['EZKKYF']=_0x404234,_0x24b52e=arguments,a5_0x4042['TbAclc']=!![];}const _0x16ef28=_0x5e449e[0x0],_0x2fc918=_0x171ecb+_0x16ef28,_0x335876=_0x24b52e[_0x2fc918];if(!_0x335876){const _0x48b3e1=function(_0x28ee38){this['bxzTwi']=_0x28ee38,this['whishT']=[0x1,0x0,0x0],this['YSUlZv']=function(){return'newState';},this['dqHRtZ']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['lGgurF']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x48b3e1['prototype']['peVLIl']=function(){const _0x1f6437=new RegExp(this['dqHRtZ']+this['lGgurF']),_0x46b719=_0x1f6437['test'](this['YSUlZv']['toString']())?--this['whishT'][0x1]:--this['whishT'][0x0];return this['EpSauK'](_0x46b719);},_0x48b3e1['prototype']['EpSauK']=function(_0x20d9b0){if(!Boolean(~_0x20d9b0))return _0x20d9b0;return this['GdWWmC'](this['bxzTwi']);},_0x48b3e1['prototype']['GdWWmC']=function(_0x2d6b36){for(let _0x5d5d41=0x0,_0x209071=this['whishT']['length'];_0x5d5d41<_0x209071;_0x5d5d41++){this['whishT']['push'](Math['round'](Math['random']())),_0x209071=this['whishT']['length'];}return _0x2d6b36(this['whishT'][0x0]);},new _0x48b3e1(a5_0x4042)['peVLIl'](),_0x2ed037=a5_0x4042['EZKKYF'](_0x2ed037),_0x24b52e[_0x2fc918]=_0x2ed037;}else _0x2ed037=_0x335876;return _0x2ed037;},a5_0x4042(_0x24b52e,_0xd00b0c);}import{headers}from'next/headers';import{NextResponse}from'next/server';import a5_0x328330 from'stripe';import{getStudentByClerkId}from'@/sanity/lib/student/getStudentByClerkId';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';const stripe=new a5_0x328330(process[a5_0x5b32e6(0xfe)][a5_0x5b32e6(0x12a)],{'apiVersion':a5_0x5b32e6(0x10d)}),webhookSecret=process[a5_0x5b32e6(0xfe)][a5_0x5b32e6(0x10b)];export async function POST(_0x2fa729){const _0x10c352=a5_0x5b32e6,_0x290a1f={'FvImb':_0x10c352(0x108),'ZHLMK':_0x10c352(0x130),'OhwXE':function(_0x4f27d3,_0x161bd6){return _0x4f27d3===_0x161bd6;},'tyPcK':_0x10c352(0x105),'qwHwR':function(_0x45c8fa){return _0x45c8fa();},'eHIUG':_0x10c352(0xfb),'oQnui':_0x10c352(0x122),'CdNGr':function(_0x555421,_0x37b609){return _0x555421 instanceof _0x37b609;},'HhOmX':_0x10c352(0x11e),'LkyZm':function(_0x8b4fd,_0x193d72){return _0x8b4fd===_0x193d72;},'SsKwN':function(_0x41e5c3,_0x5a77b7){return _0x41e5c3===_0x5a77b7;},'IHCcJ':function(_0x4c2818,_0x311e02){return _0x4c2818||_0x311e02;},'kLwAY':function(_0x5cae23,_0x3dad1c){return _0x5cae23(_0x3dad1c);},'mHHyJ':_0x10c352(0x12d),'PmwMN':_0x10c352(0x129),'oYlFV':_0x10c352(0x12c),'BPcBI':_0x10c352(0x102)};var _0x384d8b,_0x40978e;try{if(_0x290a1f[_0x10c352(0x113)](_0x290a1f[_0x10c352(0x109)],_0x290a1f[_0x10c352(0x109)])){const _0x1874b9=await _0x2fa729[_0x10c352(0x11c)](),_0x136cfe=await _0x290a1f[_0x10c352(0x112)](headers),_0x1fbc61=_0x136cfe[_0x10c352(0x106)](_0x290a1f[_0x10c352(0x11b)]);if(!_0x1fbc61)return new NextResponse(_0x290a1f[_0x10c352(0x127)],{'status':0x190});let _0x80c34a;try{_0x80c34a=stripe['webhooks'][_0x10c352(0x110)](_0x1874b9,_0x1fbc61,webhookSecret);}catch(_0x3366ba){const _0x24562f=_0x290a1f['CdNGr'](_0x3366ba,Error)?_0x3366ba[_0x10c352(0x131)]:_0x290a1f['HhOmX'];return console[_0x10c352(0x134)](_0x10c352(0x132)+_0x24562f),new NextResponse('Webhook\x20Error:\x20'+_0x24562f,{'status':0x190});}if(_0x290a1f[_0x10c352(0x113)](_0x80c34a[_0x10c352(0x11a)],_0x10c352(0x124))){const _0x392539=_0x80c34a[_0x10c352(0x133)]['object'],_0x115492=_0x290a1f['OhwXE'](_0x384d8b=_0x392539[_0x10c352(0x116)],null)||_0x290a1f[_0x10c352(0x117)](_0x384d8b,void 0x0)?void 0x0:_0x384d8b[_0x10c352(0xf8)],_0x5d017e=_0x290a1f['OhwXE'](_0x40978e=_0x392539[_0x10c352(0x116)],null)||_0x290a1f['SsKwN'](_0x40978e,void 0x0)?void 0x0:_0x40978e[_0x10c352(0x128)];if(_0x290a1f[_0x10c352(0x11f)](!_0x115492,!_0x5d017e))return new NextResponse(_0x290a1f['ZHLMK'],{'status':0x190});const _0x5a93dc=await _0x290a1f[_0x10c352(0xf9)](getStudentByClerkId,_0x5d017e);if(!_0x5a93dc['data'])return _0x290a1f['OhwXE'](_0x290a1f[_0x10c352(0x100)],_0x290a1f['PmwMN'])?(_0x4b8c35[_0x10c352(0x134)](_0x290a1f[_0x10c352(0x11d)],_0x4bba58),new _0x5d71bc('Webhook\x20handler\x20failed',{'status':0x1f4})):new NextResponse(_0x290a1f[_0x10c352(0x118)],{'status':0x190});return await createEnrollment({'studentId':_0x5a93dc['data'][_0x10c352(0x120)],'courseId':_0x115492,'paymentId':_0x392539['id'],'amount':_0x392539[_0x10c352(0x10a)]/0x64,'paymentProvider':_0x290a1f[_0x10c352(0x103)]}),new NextResponse(null,{'status':0xc8});}return new NextResponse(null,{'status':0xc8});}else return new _0x3f3950(_0x290a1f['ZHLMK'],{'status':0x190});}catch(_0xf6ef16){return console[_0x10c352(0x134)](_0x290a1f[_0x10c352(0x11d)],_0xf6ef16),new NextResponse(_0x10c352(0xfc),{'status':0x1f4});}}