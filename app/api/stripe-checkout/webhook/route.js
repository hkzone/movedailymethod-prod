const a24_0x10dc75=a24_0x4992;(function(_0x994284,_0x2a4917){const _0x199c6d=a24_0x4992,_0x21f59b=_0x994284();while(!![]){try{const _0x3dc359=-parseInt(_0x199c6d(0x1d5))/0x1+parseInt(_0x199c6d(0x1fc))/0x2*(parseInt(_0x199c6d(0x1d0))/0x3)+parseInt(_0x199c6d(0x200))/0x4+-parseInt(_0x199c6d(0x1fb))/0x5+parseInt(_0x199c6d(0x1e8))/0x6+-parseInt(_0x199c6d(0x1e9))/0x7*(parseInt(_0x199c6d(0x1e0))/0x8)+parseInt(_0x199c6d(0x1f6))/0x9*(parseInt(_0x199c6d(0x208))/0xa);if(_0x3dc359===_0x2a4917)break;else _0x21f59b['push'](_0x21f59b['shift']());}catch(_0xa4728b){_0x21f59b['push'](_0x21f59b['shift']());}}}(a24_0xa0f6,0x7c973));const a24_0x1e3084=(function(){const _0x5406fe=a24_0x4992,_0x1d6ff6={'XQyaA':_0x5406fe(0x20b),'BpJhA':_0x5406fe(0x214),'yQsKW':_0x5406fe(0x211),'thgLT':function(_0x5e1276,_0x41974c){return _0x5e1276===_0x41974c;},'zPAGU':_0x5406fe(0x1e1),'GroNw':_0x5406fe(0x1ef)};let _0x286d38=!![];return function(_0x10853d,_0x3af6d8){const _0x34b75d=_0x5406fe,_0x25539a={'IlMlA':_0x1d6ff6[_0x34b75d(0x212)],'xKidM':function(_0x1b5229,_0x500398){return _0x1b5229!==_0x500398;},'lnmUj':_0x1d6ff6[_0x34b75d(0x1de)],'rAAvA':_0x1d6ff6['yQsKW'],'CVZIM':function(_0x34f4a5,_0x36135a){const _0x4a650a=_0x34b75d;return _0x1d6ff6[_0x4a650a(0x202)](_0x34f4a5,_0x36135a);},'SHJEh':_0x1d6ff6[_0x34b75d(0x1e4)]};if(_0x1d6ff6[_0x34b75d(0x202)](_0x34b75d(0x1e7),_0x1d6ff6[_0x34b75d(0x215)])){const _0x526999=_0x4b434a?function(){const _0x1a70d0=_0x34b75d;if(_0x352ae5){const _0x5f36ef=_0x3dc0e9[_0x1a70d0(0x216)](_0x4bf02a,arguments);return _0x1973f5=null,_0x5f36ef;}}:function(){};return _0x62f591=![],_0x526999;}else{const _0xcfc71e=_0x286d38?function(){const _0x34d0=_0x34b75d,_0x3416b4={'hIGxJ':_0x25539a[_0x34d0(0x1e5)]};if(_0x25539a['xKidM'](_0x25539a[_0x34d0(0x213)],_0x25539a[_0x34d0(0x1dc)])){if(_0x3af6d8){if(_0x25539a['CVZIM'](_0x25539a[_0x34d0(0x1e6)],_0x25539a[_0x34d0(0x1e6)])){const _0x314091=_0x3af6d8[_0x34d0(0x216)](_0x10853d,arguments);return _0x3af6d8=null,_0x314091;}else return _0x4113be[_0x34d0(0x1f3)]()[_0x34d0(0x207)](_0x3416b4[_0x34d0(0x20e)])[_0x34d0(0x1f3)]()[_0x34d0(0x205)](_0x499d21)[_0x34d0(0x207)](_0x34d0(0x20b));}}else return new _0x557be1('Missing\x20metadata',{'status':0x190});}:function(){};return _0x286d38=![],_0xcfc71e;}};}()),a24_0x592b16=a24_0x1e3084(this,function(){const _0x8f9757=a24_0x4992,_0x20c6e9={'ybbMu':_0x8f9757(0x20b)};return a24_0x592b16[_0x8f9757(0x1f3)]()[_0x8f9757(0x207)](_0x20c6e9[_0x8f9757(0x1f4)])['toString']()['constructor'](a24_0x592b16)[_0x8f9757(0x207)](_0x20c6e9[_0x8f9757(0x1f4)]);});a24_0x592b16();function a24_0x4992(_0x1b8866,_0x48dfb2){const _0x14e975=a24_0xa0f6();return a24_0x4992=function(_0x592b16,_0x1e3084){_0x592b16=_0x592b16-0x1ce;let _0xa0f67e=_0x14e975[_0x592b16];if(a24_0x4992['zSmluq']===undefined){var _0x4992ce=function(_0x350055){const _0x343eea='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3a1be1='',_0x2f1fa8='',_0x3001fb=_0x3a1be1+_0x4992ce;for(let _0x2bb41f=0x0,_0xa6176,_0x15118b,_0x23e8fa=0x0;_0x15118b=_0x350055['charAt'](_0x23e8fa++);~_0x15118b&&(_0xa6176=_0x2bb41f%0x4?_0xa6176*0x40+_0x15118b:_0x15118b,_0x2bb41f++%0x4)?_0x3a1be1+=_0x3001fb['charCodeAt'](_0x23e8fa+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0xa6176>>(-0x2*_0x2bb41f&0x6)):_0x2bb41f:0x0){_0x15118b=_0x343eea['indexOf'](_0x15118b);}for(let _0x4b434a=0x0,_0x5cc505=_0x3a1be1['length'];_0x4b434a<_0x5cc505;_0x4b434a++){_0x2f1fa8+='%'+('00'+_0x3a1be1['charCodeAt'](_0x4b434a)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x2f1fa8);};a24_0x4992['fpDgLQ']=_0x4992ce,_0x1b8866=arguments,a24_0x4992['zSmluq']=!![];}const _0x1cc6b1=_0x14e975[0x0],_0x54ba73=_0x592b16+_0x1cc6b1,_0xb990e0=_0x1b8866[_0x54ba73];if(!_0xb990e0){const _0x189eb1=function(_0x552741){this['MwaYcY']=_0x552741,this['Zyknos']=[0x1,0x0,0x0],this['KRaQzW']=function(){return'newState';},this['ObrgIo']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['jKctBy']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x189eb1['prototype']['gQzGHi']=function(){const _0x211bfd=new RegExp(this['ObrgIo']+this['jKctBy']),_0x62f591=_0x211bfd['test'](this['KRaQzW']['toString']())?--this['Zyknos'][0x1]:--this['Zyknos'][0x0];return this['byQmTW'](_0x62f591);},_0x189eb1['prototype']['byQmTW']=function(_0x352ae5){if(!Boolean(~_0x352ae5))return _0x352ae5;return this['AlyxrC'](this['MwaYcY']);},_0x189eb1['prototype']['AlyxrC']=function(_0x4ff349){for(let _0x50297c=0x0,_0x3bec2a=this['Zyknos']['length'];_0x50297c<_0x3bec2a;_0x50297c++){this['Zyknos']['push'](Math['round'](Math['random']())),_0x3bec2a=this['Zyknos']['length'];}return _0x4ff349(this['Zyknos'][0x0]);},new _0x189eb1(a24_0x4992)['gQzGHi'](),_0xa0f67e=a24_0x4992['fpDgLQ'](_0xa0f67e),_0x1b8866[_0x54ba73]=_0xa0f67e;}else _0xa0f67e=_0xb990e0;return _0xa0f67e;},a24_0x4992(_0x1b8866,_0x48dfb2);}import{headers}from'next/headers';import{NextResponse}from'next/server';import a24_0x1e4e24 from'stripe';import{getStudentByClerkId}from'@/sanity/lib/student/getStudentByClerkId';function a24_0xa0f6(){const _0x2b6aac=['CKfbDKe','BwvZC2fNzq','qNbkAee','y0zgsNm','odu2y2rvDgr6','DLfgzwW','y2HLy2TVDxqUC2vZC2LVBI5JB21WBgv0zwq','u1rssvbfx1nfq1jfvf9lrvK','ELbbr1u','swXnBee','u0HkrwG','ueHPrxu','mtqZmty2Evb1A3ny','mtKZntvLBgHQvgm','DfHvt0i','zw52','D2vIAg9VA3m','yuXbtgy','C3rYAxbLlxnPz25HDhvYzq','CNLWzwe','rhjjANa','BMvNuwG','Bwv0ywrHDge','Dg9tDhjPBMC','EwjItxu','DhzSwLi','ow1btMrhEa','v2vIAg9VAYbOyw5KBgvYigzHAwXLza','CeLfDMu','ywXmDvu','u3r1zgvUDcbUB3qGzM91BMq','nta4ndi5nu5OCxfpvq','nJK4BMPuzNPd','yLPwr2K','uwTqEMq','zhL5txK','ota1nJy4qxj2whfP','yxvls04','DgHNtfq','ELzNsfO','vw5RBM93BIbLCNjVCG','y29UC3rYDwn0B3i','BxrPBgy','C2vHCMnO','mty5nJKXmZbLugzvs1y','sg9dyKu','Dgv4Da','kcGOlISPkYKRksSK','y29UC3rYDwn0rxzLBNq','twLZC2LUzYbTzxrHzgf0yq','AeLhEeO','u0rUr24','t3jhv3a','Dvf2Ag8','wff5yue','Bg5TvwO','zwnNufO','r3jVtNC','yxbWBhK','zw5YzKC','rur2A3i','s29lwfu','v2vIAg9VAYbfCNjVCJOG','y291CNnLswq','ug91sMi','C2f2sKW','q0DqqLG','DfLozKG','mZeXnhjcrLHruW','AgHJz28','DhLWzq','CNjitha','CKLhvgi','ndG2nde2DgviugXS','zgf0yq','BgnMAeq','u1rssvbfx1DfqKHpt0TFu0vduKvu','thPNDxe','wNHlBM0','v2vIAg9VAYbZAwDUyxr1CMuGDMvYAwzPy2f0Aw9UigzHAwXLzdOG'];a24_0xa0f6=function(){return _0x2b6aac;};return a24_0xa0f6();}import{createEnrollment}from'@/sanity/lib/student/createEnrollment';const stripe=new a24_0x1e4e24(process['env'][a24_0x10dc75(0x1e3)],{'apiVersion':'2023-10-16'}),webhookSecret=process[a24_0x10dc75(0x1eb)][a24_0x10dc75(0x1d8)];export async function POST(_0x427a81){const _0x5b2932=a24_0x10dc75,_0x3fcc7c={'tvlZR':_0x5b2932(0x1fa),'Lzguq':'Error\x20in\x20webhook\x20handler:','hhcgo':_0x5b2932(0x1f7),'SDnGn':function(_0x172f6b,_0x11bd92){return _0x172f6b instanceof _0x11bd92;},'pIEve':_0x5b2932(0x204),'tYNfH':_0x5b2932(0x1ee),'OrGWp':function(_0x22bbec,_0x4de489){return _0x22bbec!==_0x4de489;},'auKKN':_0x5b2932(0x1ea),'KoKXU':_0x5b2932(0x209),'PouJb':'No\x20signature\x20found','negQh':_0x5b2932(0x1fd),'lcfhD':_0x5b2932(0x1f0),'QkPzd':function(_0x487e38,_0x2ca5c0){return _0x487e38===_0x2ca5c0;},'dyyMy':_0x5b2932(0x1e2),'zVgHZ':function(_0x31cb3f,_0x2ca1c9){return _0x31cb3f||_0x2ca1c9;},'ZxKnm':_0x5b2932(0x1d4),'bKagz':_0x5b2932(0x20d),'mtilf':function(_0x32668b,_0x1c1428){return _0x32668b(_0x1c1428);},'aLALf':function(_0x2be589,_0x191073){return _0x2be589===_0x191073;},'gwIbo':_0x5b2932(0x217),'hCMhI':_0x5b2932(0x1ce),'EDvkr':function(_0x1a7ef9,_0x280fac){return _0x1a7ef9(_0x280fac);},'juNRx':function(_0x300d4d,_0x3d2982){return _0x300d4d/_0x3d2982;},'rrHLp':_0x5b2932(0x1df),'kYaDx':_0x5b2932(0x21d)};try{const _0x3faae3=await _0x427a81[_0x5b2932(0x20a)](),_0x2ba293=await headers(),_0x397731=_0x2ba293['get'](_0x3fcc7c[_0x5b2932(0x1cf)]);if(!_0x397731){if(_0x3fcc7c['OrGWp'](_0x3fcc7c[_0x5b2932(0x201)],_0x3fcc7c[_0x5b2932(0x219)]))return new NextResponse(_0x3fcc7c[_0x5b2932(0x21c)],{'status':0x190});else _0x5edc55=_0x19044b[_0x5b2932(0x1ec)][_0x5b2932(0x20c)](_0xaf00e7,_0x57c16e,_0x242fbf);}let _0x9da4e9;try{if(_0x3fcc7c[_0x5b2932(0x210)](_0x5b2932(0x1fd),_0x3fcc7c[_0x5b2932(0x1f1)]))return new _0x1aa638(_0x3fcc7c[_0x5b2932(0x1f5)],{'status':0x190});else _0x9da4e9=stripe[_0x5b2932(0x1ec)][_0x5b2932(0x20c)](_0x3faae3,_0x397731,webhookSecret);}catch(_0x6c2f91){if(_0x3fcc7c[_0x5b2932(0x1d7)]===_0x3fcc7c['lcfhD']){const _0x40b30d=_0x3fcc7c[_0x5b2932(0x20f)](_0x6c2f91,Error)?_0x6c2f91[_0x5b2932(0x1dd)]:_0x3fcc7c[_0x5b2932(0x1f8)];return console['error'](_0x5b2932(0x1db)+_0x40b30d),new NextResponse(_0x5b2932(0x21a)+_0x40b30d,{'status':0x190});}else{if(_0x1d71fe){const _0x5c66be=_0x43a1d8['apply'](_0x5f41c1,arguments);return _0xdd56a9=null,_0x5c66be;}}}if(_0x3fcc7c[_0x5b2932(0x1fe)](_0x9da4e9[_0x5b2932(0x1d2)],_0x3fcc7c[_0x5b2932(0x1ff)])){const _0x4ade16=_0x9da4e9[_0x5b2932(0x1d6)]['object'],_0xd31973=_0x4ade16['metadata']?.[_0x5b2932(0x21b)],_0x12cbfe=_0x4ade16[_0x5b2932(0x1f2)]?.['userId'];if(_0x3fcc7c[_0x5b2932(0x203)](!_0xd31973,!_0x12cbfe)){if(_0x3fcc7c[_0x5b2932(0x1fe)](_0x5b2932(0x1f9),_0x3fcc7c[_0x5b2932(0x1da)])){const _0x1622c3=_0x3357ee[_0x5b2932(0x216)](_0x1d032d,arguments);return _0x2ada90=null,_0x1622c3;}else return new NextResponse(_0x3fcc7c['bKagz'],{'status':0x190});}const _0x512a39=await _0x3fcc7c[_0x5b2932(0x206)](getStudentByClerkId,_0x12cbfe);if(!_0x512a39[_0x5b2932(0x1d6)])return _0x3fcc7c[_0x5b2932(0x1ed)](_0x3fcc7c['gwIbo'],_0x3fcc7c['hCMhI'])?(_0x56c693['error'](_0x3fcc7c[_0x5b2932(0x1d9)],_0x32a14f),new _0x47e04a(_0x3fcc7c[_0x5b2932(0x1d1)],{'status':0x1f4})):new NextResponse(_0x3fcc7c[_0x5b2932(0x1f5)],{'status':0x190});return await _0x3fcc7c[_0x5b2932(0x218)](createEnrollment,{'studentId':_0x512a39[_0x5b2932(0x1d6)]['_id'],'courseId':_0xd31973,'paymentId':_0x4ade16['id'],'amount':_0x3fcc7c['juNRx'](_0x4ade16['amount_total'],0x64),'paymentProvider':'stripe'}),new NextResponse(null,{'status':0xc8});}return new NextResponse(null,{'status':0xc8});}catch(_0x4c9738){if(_0x3fcc7c['OrGWp'](_0x3fcc7c[_0x5b2932(0x1d3)],_0x3fcc7c['kYaDx']))return console['error'](_0x3fcc7c['Lzguq'],_0x4c9738),new NextResponse(_0x3fcc7c[_0x5b2932(0x1d1)],{'status':0x1f4});else{const _0x285f44=_0x3fcc7c[_0x5b2932(0x20f)](_0x481873,_0x379795)?_0x24c304['message']:_0x3fcc7c[_0x5b2932(0x1f8)];return _0x5aab50['error'](_0x5b2932(0x1db)+_0x285f44),new _0x497ac6(_0x5b2932(0x21a)+_0x285f44,{'status':0x190});}}}