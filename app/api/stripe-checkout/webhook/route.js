function a2_0x4b3f(_0x4aded4,_0x423196){const _0x1fe600=a2_0x1fe6();return a2_0x4b3f=function(_0x4b3ffe,_0x42784d){_0x4b3ffe=_0x4b3ffe-0x7c;let _0x30f161=_0x1fe600[_0x4b3ffe];if(a2_0x4b3f['meyUUs']===undefined){var _0x362a1c=function(_0x5c7839){const _0x2ac16e='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x512403='',_0x4e13d8='';for(let _0x2a2a31=0x0,_0x409645,_0x4fc689,_0x3b89c4=0x0;_0x4fc689=_0x5c7839['charAt'](_0x3b89c4++);~_0x4fc689&&(_0x409645=_0x2a2a31%0x4?_0x409645*0x40+_0x4fc689:_0x4fc689,_0x2a2a31++%0x4)?_0x512403+=String['fromCharCode'](0xff&_0x409645>>(-0x2*_0x2a2a31&0x6)):0x0){_0x4fc689=_0x2ac16e['indexOf'](_0x4fc689);}for(let _0x191520=0x0,_0x1071cb=_0x512403['length'];_0x191520<_0x1071cb;_0x191520++){_0x4e13d8+='%'+('00'+_0x512403['charCodeAt'](_0x191520)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4e13d8);};a2_0x4b3f['WSaHew']=_0x362a1c,_0x4aded4=arguments,a2_0x4b3f['meyUUs']=!![];}const _0x54880c=_0x1fe600[0x0],_0x5edbf2=_0x4b3ffe+_0x54880c,_0xf75612=_0x4aded4[_0x5edbf2];return!_0xf75612?(_0x30f161=a2_0x4b3f['WSaHew'](_0x30f161),_0x4aded4[_0x5edbf2]=_0x30f161):_0x30f161=_0xf75612,_0x30f161;},a2_0x4b3f(_0x4aded4,_0x423196);}const a2_0x35ebe4=a2_0x4b3f;(function(_0x5c5f7d,_0x19f73e){const _0x52ea8d=a2_0x4b3f,_0x521d9a=_0x5c5f7d();while(!![]){try{const _0x1d59f0=parseInt(_0x52ea8d(0x90))/0x1*(-parseInt(_0x52ea8d(0x7c))/0x2)+parseInt(_0x52ea8d(0x7d))/0x3*(parseInt(_0x52ea8d(0x8c))/0x4)+-parseInt(_0x52ea8d(0x97))/0x5+-parseInt(_0x52ea8d(0x85))/0x6*(-parseInt(_0x52ea8d(0x95))/0x7)+parseInt(_0x52ea8d(0x8d))/0x8*(parseInt(_0x52ea8d(0x83))/0x9)+parseInt(_0x52ea8d(0x98))/0xa+-parseInt(_0x52ea8d(0x7e))/0xb;if(_0x1d59f0===_0x19f73e)break;else _0x521d9a['push'](_0x521d9a['shift']());}catch(_0x581efb){_0x521d9a['push'](_0x521d9a['shift']());}}}(a2_0x1fe6,0x3a07c));import{headers}from'next/headers';import{NextResponse}from'next/server';import a2_0x5c7839 from'stripe';import{getStudentByClerkId}from'@/sanity/lib/student/getStudentByClerkId';function a2_0x1fe6(){const _0x5d9901=['u1rssvbfx1DfqKHpt0TFu0vduKvu','v2vIAg9VAYbZAwDUyxr1CMuGDMvYAwzPy2f0Aw9UigzHAwXLzdOG','mJaYmY0Xmc0XnG','vw5RBM93BIbLCNjVCG','mJqXnMTJrMfvra','mJq3mtG0wg1bAuni','y2HLy2TVDxqUC2vZC2LVBI5JB21WBgv0zwq','DhLWzq','nde1ndyZruzAweXT','C3rYAxbL','x2LK','tM8GC2LNBMf0DxjLigzVDw5K','y29UC3rYDwn0rxzLBNq','n3bRs2HbCG','u3r1zgvUDcbUB3qGzM91BMq','mtK0mtq3nwffz0jrta','mJmZndK0mgvHsuTkyq','z2v0','twLZC2LUzYbTzxrHzgf0yq','mK1UrwHKwG','mJiWmM1Kv1bKuW','mte5mJmYm1vcCu9ICG','BwvZC2fNzq','C3rYAxbLlxnPz25HDhvYzq','DxnLCKLK','u1rssvbfx1nfq1jfvf9lrvK','nJnzwgPmEvi','rxjYB3iGAw4GD2vIAg9VAYbOyw5KBgvYoG','mtu0mdm2mNvOzgnntW','v2vIAg9VAYbOyw5KBgvYigzHAwXLza','zxjYB3i'];a2_0x1fe6=function(){return _0x5d9901;};return a2_0x1fe6();}import{createEnrollment}from'@/sanity/lib/student/createEnrollment';const stripe=new a2_0x5c7839(process['env'][a2_0x35ebe4(0x82)],{'apiVersion':a2_0x35ebe4(0x8a)}),webhookSecret=process['env'][a2_0x35ebe4(0x88)];export async function POST(_0x2ac16e){const _0x1691fe=a2_0x35ebe4;try{const _0x512403=await _0x2ac16e['text'](),_0x4e13d8=await headers(),_0x2a2a31=_0x4e13d8[_0x1691fe(0x99)](_0x1691fe(0x80));if(!_0x2a2a31)return new NextResponse(_0x1691fe(0x93),{'status':0x190});let _0x409645;try{_0x409645=stripe['webhooks'][_0x1691fe(0x94)](_0x512403,_0x2a2a31,webhookSecret);}catch(_0x4fc689){const _0x3b89c4=_0x4fc689 instanceof Error?_0x4fc689[_0x1691fe(0x7f)]:_0x1691fe(0x8b);return console['error'](_0x1691fe(0x89)+_0x3b89c4),new NextResponse('Webhook\x20Error:\x20'+_0x3b89c4,{'status':0x190});}if(_0x409645[_0x1691fe(0x8f)]===_0x1691fe(0x8e)){const _0x191520=_0x409645['data']['object'],_0x1071cb=_0x191520['metadata']?.['courseId'],_0x5c8f7e=_0x191520['metadata']?.[_0x1691fe(0x81)];if(!_0x1071cb||!_0x5c8f7e)return new NextResponse(_0x1691fe(0x9a),{'status':0x190});const _0x4a4d15=await getStudentByClerkId(_0x5c8f7e);if(!_0x4a4d15['data'])return new NextResponse(_0x1691fe(0x96),{'status':0x190});return await createEnrollment({'studentId':_0x4a4d15['data'][_0x1691fe(0x92)],'courseId':_0x1071cb,'paymentId':_0x191520['id'],'amount':_0x191520['amount_total']/0x64,'paymentProvider':_0x1691fe(0x91)}),new NextResponse(null,{'status':0xc8});}return new NextResponse(null,{'status':0xc8});}catch(_0x8c83bd){return console[_0x1691fe(0x87)](_0x1691fe(0x84),_0x8c83bd),new NextResponse(_0x1691fe(0x86),{'status':0x1f4});}}