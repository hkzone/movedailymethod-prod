const a5_0x4b40bb=a5_0x4efa;function a5_0x4efa(_0x1a93fb,_0x83210e){const _0x2479a7=a5_0x166d();return a5_0x4efa=function(_0x376e45,_0x3f4060){_0x376e45=_0x376e45-0xa6;let _0x166de0=_0x2479a7[_0x376e45];if(a5_0x4efa['lKdhsz']===undefined){var _0x4efa1e=function(_0x4be225){const _0x3d4e3b='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x474729='',_0x65b246='',_0x53c079=_0x474729+_0x4efa1e;for(let _0x1ce88a=0x0,_0x55ff1c,_0x4e6b04,_0x405dc1=0x0;_0x4e6b04=_0x4be225['charAt'](_0x405dc1++);~_0x4e6b04&&(_0x55ff1c=_0x1ce88a%0x4?_0x55ff1c*0x40+_0x4e6b04:_0x4e6b04,_0x1ce88a++%0x4)?_0x474729+=_0x53c079['charCodeAt'](_0x405dc1+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x55ff1c>>(-0x2*_0x1ce88a&0x6)):_0x1ce88a:0x0){_0x4e6b04=_0x3d4e3b['indexOf'](_0x4e6b04);}for(let _0x447809=0x0,_0x44fb78=_0x474729['length'];_0x447809<_0x44fb78;_0x447809++){_0x65b246+='%'+('00'+_0x474729['charCodeAt'](_0x447809)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x65b246);};a5_0x4efa['OynZCQ']=_0x4efa1e,_0x1a93fb=arguments,a5_0x4efa['lKdhsz']=!![];}const _0xd52c18=_0x2479a7[0x0],_0x4e0f4b=_0x376e45+_0xd52c18,_0x366237=_0x1a93fb[_0x4e0f4b];if(!_0x366237){const _0x4a6b8c=function(_0x452818){this['RkFnfk']=_0x452818,this['TPHnJY']=[0x1,0x0,0x0],this['KDNyOn']=function(){return'newState';},this['iTzLBb']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['eiRCyg']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x4a6b8c['prototype']['SeqJyh']=function(){const _0x53a34a=new RegExp(this['iTzLBb']+this['eiRCyg']),_0x1274dc=_0x53a34a['test'](this['KDNyOn']['toString']())?--this['TPHnJY'][0x1]:--this['TPHnJY'][0x0];return this['MAybIz'](_0x1274dc);},_0x4a6b8c['prototype']['MAybIz']=function(_0x2f7449){if(!Boolean(~_0x2f7449))return _0x2f7449;return this['jWvnQz'](this['RkFnfk']);},_0x4a6b8c['prototype']['jWvnQz']=function(_0x14d17c){for(let _0x5761a2=0x0,_0x46c5ac=this['TPHnJY']['length'];_0x5761a2<_0x46c5ac;_0x5761a2++){this['TPHnJY']['push'](Math['round'](Math['random']())),_0x46c5ac=this['TPHnJY']['length'];}return _0x14d17c(this['TPHnJY'][0x0]);},new _0x4a6b8c(a5_0x4efa)['SeqJyh'](),_0x166de0=a5_0x4efa['OynZCQ'](_0x166de0),_0x1a93fb[_0x4e0f4b]=_0x166de0;}else _0x166de0=_0x366237;return _0x166de0;},a5_0x4efa(_0x1a93fb,_0x83210e);}(function(_0x51eac3,_0x556764){const _0x42381b=a5_0x4efa,_0x5a58ea=_0x51eac3();while(!![]){try{const _0x1d0c1f=parseInt(_0x42381b(0xd7))/0x1+parseInt(_0x42381b(0xcc))/0x2+-parseInt(_0x42381b(0xed))/0x3*(parseInt(_0x42381b(0xdf))/0x4)+-parseInt(_0x42381b(0xbf))/0x5+-parseInt(_0x42381b(0xb7))/0x6+parseInt(_0x42381b(0xef))/0x7*(parseInt(_0x42381b(0xe3))/0x8)+-parseInt(_0x42381b(0xb3))/0x9*(parseInt(_0x42381b(0xc4))/0xa);if(_0x1d0c1f===_0x556764)break;else _0x5a58ea['push'](_0x5a58ea['shift']());}catch(_0x47c575){_0x5a58ea['push'](_0x5a58ea['shift']());}}}(a5_0x166d,0xce969));const a5_0x3f4060=(function(){const _0x1fb3e2=a5_0x4efa,_0x331014={'AuNuA':function(_0x302402,_0x201469){return _0x302402!==_0x201469;},'gsqUa':_0x1fb3e2(0xec),'LHHsI':function(_0x232adb,_0x586d15){return _0x232adb===_0x586d15;},'eKXsu':'TlQQq','vMnqb':_0x1fb3e2(0xc9)};let _0x4ca634=!![];return function(_0x1ae211,_0x554d7f){const _0x54a497={'QYqeU':_0x331014['vMnqb']},_0x286a7d=_0x4ca634?function(){const _0x50096d=a5_0x4efa;if(_0x331014[_0x50096d(0xa8)](_0x50096d(0xe8),_0x331014['gsqUa'])){if(_0x554d7f){if(_0x331014['LHHsI'](_0x331014['eKXsu'],_0x331014['eKXsu'])){const _0x2fd987=_0x554d7f[_0x50096d(0xf2)](_0x1ae211,arguments);return _0x554d7f=null,_0x2fd987;}else return new _0x1457c6(_0x54a497[_0x50096d(0xe2)],{'status':0x190});}}else _0xf6699f=_0x33fe3b[_0x50096d(0xc1)][_0x50096d(0xbd)](_0x2443e2,_0x5b3a7f,_0xa6695d);}:function(){};return _0x4ca634=![],_0x286a7d;};}()),a5_0x376e45=a5_0x3f4060(this,function(){const _0x502b30=a5_0x4efa,_0x342be6={'GPNOg':_0x502b30(0xbe)};return a5_0x376e45['toString']()[_0x502b30(0xb2)](_0x342be6[_0x502b30(0xe1)])[_0x502b30(0xdd)]()[_0x502b30(0xa9)](a5_0x376e45)[_0x502b30(0xb2)](_0x342be6['GPNOg']);});function a5_0x166d(){const _0x4f6c3e=['u1rssvbfx1DfqKHpt0TFu0vduKvu','v2vIAg9VAYbOyw5KBgvYigzHAwXLza','zgfUBxu','Dg9tDhjPBMC','yK5RDhq','mtaZmtjpwxPlruy','BwvZC2fNzq','r1bot2C','uvLXzvu','oeTmtgvMAW','zgTgEMq','AvPZBuq','s1LWwwO','DeHcA2e','C3nRC0i','ChnHCLy','mJaYmY0Xmc0XnG','zxjYB3i','Be5wu2G','mtu2wK52r3n6','Axj1yuy','nJmWmtu4ourpywXyzG','tM8GC2LNBMf0DxjLigzVDw5K','A1fLCfi','yxbWBhK','BwX4vhy','DhLWzq','yLbZqK8','y2HLy2TVDxqUC2vZC2LVBI5JB21WBgv0zwq','qxvoDue','y29UC3rYDwn0B3i','C3rYAxbL','reTiqvq','v2vIAg9VAYbfCNjVCJOG','AvfivfO','DxrWBeu','vw5RBM93BIbLCNjVCG','Dgv4Da','sLD1wfq','C2vHCMnO','mZy5v0XqDMHt','vvj4wLO','sNPAtKC','Bwv0ywrHDge','ndu3nJq1mNrZsNjtCa','rxjYB3iGAw4GD2vIAg9VAYbOyw5KBgvYoG','AMf3B2G','yMTnru8','z2v0','v2vIAg9VAYbZAwDUyxr1CMuGDMvYAwzPy2f0Aw9UigzHAwXLzdOG','y29UC3rYDwn0rxzLBNq','kcGOlISPkYKRksSK','mZuXnZiXmffvBhz6CW','ENnADKi','D2vIAg9VA3m','vKPICxm','CfDQBfm','otm4mhzuA2zRAa','y291CNnLswq','zgT0BfK','rMXXCNu','uLzmBfC','twLZC2LUzYbTzxrHzgf0yq','v2rMBwu','yLvzBwi','mJiXmJq2mfzdAhHXAq','yw1VDw50x3rVDgfS','tgjOzLi','DxnLCKLK','u1rssvbfx1nfq1jfvf9lrvK','C3rYAxbLlxnPz25HDhvYzq','ww9ZENq','zgf0yq','B2jQzwn0','x2LK','vu9AC2O','ndC4ndi2vLzoA0Hp','C2rmv2C','rMPmAwm'];a5_0x166d=function(){return _0x4f6c3e;};return a5_0x166d();}a5_0x376e45();import{headers}from'next/headers';import{NextResponse}from'next/server';import a5_0x202116 from'stripe';import{getStudentByClerkId}from'@/sanity/lib/student/getStudentByClerkId';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';const stripe=new a5_0x202116(process['env'][a5_0x4b40bb(0xd0)],{'apiVersion':a5_0x4b40bb(0xea)}),webhookSecret=process['env'][a5_0x4b40bb(0xda)];export async function POST(_0xd72a34){const _0x98302=a5_0x4b40bb,_0x525326={'RVLlW':function(_0x455d19,_0x3380d8){return _0x455d19 instanceof _0x3380d8;},'psarV':function(_0x21a95e){return _0x21a95e();},'bUYmb':_0x98302(0xd1),'FjLic':function(_0x38d724,_0x198696){return _0x38d724!==_0x198696;},'Wdfme':_0x98302(0xab),'bkMEO':_0x98302(0xf0),'kQepR':function(_0xfc6130,_0x55ecd3){return _0xfc6130===_0x55ecd3;},'JWuXT':_0x98302(0xd6),'XsFZt':_0x98302(0xb4),'iruaF':_0x98302(0xaf),'LbhfR':function(_0xd5ada6,_0x17f407){return _0xd5ada6===_0x17f407;},'SHsEI':_0x98302(0xa7),'sdLWg':function(_0x3425e9,_0x5bf101){return _0x3425e9===_0x5bf101;},'bPsBO':function(_0x181584,_0x45875b){return _0x181584===_0x45875b;},'danmu':function(_0x30fa2e,_0x4ae775){return _0x30fa2e||_0x4ae775;},'bNktt':function(_0x3dd892,_0x53f741){return _0x3dd892===_0x53f741;},'mlxTv':_0x98302(0xc2),'dkFzd':_0x98302(0xc9),'iZsmD':function(_0x1a3546,_0x425df0){return _0x1a3546(_0x425df0);},'KYpYj':'BIMfq','jawoh':'Student\x20not\x20found','dktlY':function(_0x363ef5,_0x45ac7c){return _0x363ef5(_0x45ac7c);},'JzZNG':function(_0x1cf5a0,_0x3b5082){return _0x1cf5a0/_0x3b5082;},'qyZId':_0x98302(0xaa),'Yoszt':function(_0x16f9cc,_0x471650){return _0x16f9cc===_0x471650;},'utplE':_0x98302(0xc0),'tHBka':_0x98302(0xb8),'iQHTZ':_0x98302(0xdb)};var _0x35bb8,_0x5d83aa;try{const _0x390485=await _0xd72a34[_0x98302(0xb0)](),_0x196128=await _0x525326[_0x98302(0xe9)](headers),_0x13ed7c=_0x196128[_0x98302(0xbb)](_0x525326[_0x98302(0xcb)]);if(!_0x13ed7c)return _0x525326[_0x98302(0xd9)](_0x525326[_0x98302(0xca)],_0x525326['Wdfme'])?new _0x52c448(_0x98302(0xf0),{'status':0x190}):new NextResponse(_0x525326[_0x98302(0xba)],{'status':0x190});let _0x31f96b;try{if(_0x525326[_0x98302(0xf1)](_0x525326[_0x98302(0xb1)],_0x525326['XsFZt'])){if(_0x210340){const _0x40dee8=_0x55069e[_0x98302(0xf2)](_0x3c1e23,arguments);return _0x25055f=null,_0x40dee8;}}else _0x31f96b=stripe[_0x98302(0xc1)][_0x98302(0xbd)](_0x390485,_0x13ed7c,webhookSecret);}catch(_0x4fb5cd){const _0x27429b=_0x525326[_0x98302(0xc8)](_0x4fb5cd,Error)?_0x4fb5cd['message']:_0x525326[_0x98302(0xee)];return console[_0x98302(0xeb)](_0x98302(0xbc)+_0x27429b),new NextResponse(_0x98302(0xac)+_0x27429b,{'status':0x190});}if(_0x525326[_0x98302(0xce)](_0x31f96b[_0x98302(0xf4)],_0x525326['SHsEI'])){const _0x1daf73=_0x31f96b[_0x98302(0xd3)][_0x98302(0xd4)],_0x46f85d=_0x525326[_0x98302(0xd8)](_0x35bb8=_0x1daf73[_0x98302(0xb6)],null)||_0x525326[_0x98302(0xf1)](_0x35bb8,void 0x0)?void 0x0:_0x35bb8[_0x98302(0xc5)],_0x345fd3=_0x525326[_0x98302(0xa6)](_0x5d83aa=_0x1daf73[_0x98302(0xb6)],null)||_0x5d83aa===void 0x0?void 0x0:_0x5d83aa[_0x98302(0xcf)];if(_0x525326[_0x98302(0xdc)](!_0x46f85d,!_0x345fd3)){if(_0x525326[_0x98302(0xde)](_0x525326[_0x98302(0xf3)],_0x98302(0xc3))){const _0x5309c7=_0x447809?function(){const _0x41a875=_0x98302;if(_0x2f7449){const _0x5ad09b=_0x3d51ad[_0x41a875(0xf2)](_0x1f96b4,arguments);return _0x5833b6=null,_0x5ad09b;}}:function(){};return _0x1274dc=![],_0x5309c7;}else return new NextResponse(_0x525326[_0x98302(0xe4)],{'status':0x190});}const _0xf81e58=await _0x525326[_0x98302(0xe5)](getStudentByClerkId,_0x345fd3);if(!_0xf81e58[_0x98302(0xd3)]){if(_0x525326['kQepR'](_0x98302(0xc7),_0x525326[_0x98302(0xe6)])){const _0x52e767=_0x2bf578[_0x98302(0xf2)](_0x2094b6,arguments);return _0x3388af=null,_0x52e767;}else return new NextResponse(_0x525326[_0x98302(0xb9)],{'status':0x190});}return await _0x525326[_0x98302(0xc6)](createEnrollment,{'studentId':_0xf81e58[_0x98302(0xd3)][_0x98302(0xd5)],'courseId':_0x46f85d,'paymentId':_0x1daf73['id'],'amount':_0x525326[_0x98302(0xb5)](_0x1daf73[_0x98302(0xcd)],0x64),'paymentProvider':_0x525326['qyZId']}),new NextResponse(null,{'status':0xc8});}return new NextResponse(null,{'status':0xc8});}catch(_0x3f6793){if(_0x525326[_0x98302(0xd2)](_0x525326[_0x98302(0xae)],_0x525326[_0x98302(0xae)]))return console[_0x98302(0xeb)](_0x525326[_0x98302(0xe7)],_0x3f6793),new NextResponse(_0x525326[_0x98302(0xad)],{'status':0x1f4});else{const _0x12b5a2=_0x525326[_0x98302(0xc8)](_0x4715bf,_0x49244b)?_0x2dde25[_0x98302(0xe0)]:'Unknown\x20error';return _0xbdc4f8['error'](_0x98302(0xbc)+_0x12b5a2),new _0x4fadb8(_0x98302(0xac)+_0x12b5a2,{'status':0x190});}}}