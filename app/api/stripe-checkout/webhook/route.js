const a24_0x59b681=a24_0x5f6e;(function(_0x141f33,_0x537066){const _0x582c3f=a24_0x5f6e,_0x31958e=_0x141f33();while(!![]){try{const _0xebef62=-parseInt(_0x582c3f(0xd7))/0x1*(parseInt(_0x582c3f(0x105))/0x2)+parseInt(_0x582c3f(0xfc))/0x3+-parseInt(_0x582c3f(0xfe))/0x4*(-parseInt(_0x582c3f(0xdf))/0x5)+parseInt(_0x582c3f(0xe2))/0x6*(-parseInt(_0x582c3f(0xf2))/0x7)+-parseInt(_0x582c3f(0xea))/0x8*(-parseInt(_0x582c3f(0xda))/0x9)+parseInt(_0x582c3f(0xec))/0xa+-parseInt(_0x582c3f(0xfb))/0xb;if(_0xebef62===_0x537066)break;else _0x31958e['push'](_0x31958e['shift']());}catch(_0x34c525){_0x31958e['push'](_0x31958e['shift']());}}}(a24_0x5525,0x548bf));const a24_0x2d40b6=(function(){const _0x4de74b=a24_0x5f6e,_0x30a804={'LWdZf':function(_0x7e86ce,_0x59d839){return _0x7e86ce!==_0x59d839;},'iugdU':_0x4de74b(0x10d)};let _0x520f18=!![];return function(_0x52b48e,_0x476984){const _0x37e936=_0x520f18?function(){const _0x5c18a5=a24_0x5f6e;if(_0x30a804[_0x5c18a5(0xe7)](_0x30a804['iugdU'],'YcoTa')){if(_0x4392bb){const _0xd82c50=_0x447b6b[_0x5c18a5(0xe8)](_0x101815,arguments);return _0x284e11=null,_0xd82c50;}}else{if(_0x476984){const _0x56fd5c=_0x476984[_0x5c18a5(0xe8)](_0x52b48e,arguments);return _0x476984=null,_0x56fd5c;}}}:function(){};return _0x520f18=![],_0x37e936;};}()),a24_0x2ca454=a24_0x2d40b6(this,function(){const _0x51618f=a24_0x5f6e,_0x39d1a4={'iZLVS':_0x51618f(0x10a)};return a24_0x2ca454[_0x51618f(0xdb)]()[_0x51618f(0x106)](_0x39d1a4[_0x51618f(0xd8)])[_0x51618f(0xdb)]()['constructor'](a24_0x2ca454)['search'](_0x39d1a4[_0x51618f(0xd8)]);});function a24_0x5f6e(_0x1423a8,_0x291ef3){const _0xca72f1=a24_0x5525();return a24_0x5f6e=function(_0x2ca454,_0x2d40b6){_0x2ca454=_0x2ca454-0xd4;let _0x55254c=_0xca72f1[_0x2ca454];if(a24_0x5f6e['eDHvUr']===undefined){var _0x5f6e1d=function(_0x3c66d2){const _0x297be1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x3a7968='',_0x6c4fe9='',_0x226d41=_0x3a7968+_0x5f6e1d;for(let _0x17516e=0x0,_0x58e2be,_0x4dbfbe,_0x497f10=0x0;_0x4dbfbe=_0x3c66d2['charAt'](_0x497f10++);~_0x4dbfbe&&(_0x58e2be=_0x17516e%0x4?_0x58e2be*0x40+_0x4dbfbe:_0x4dbfbe,_0x17516e++%0x4)?_0x3a7968+=_0x226d41['charCodeAt'](_0x497f10+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x58e2be>>(-0x2*_0x17516e&0x6)):_0x17516e:0x0){_0x4dbfbe=_0x297be1['indexOf'](_0x4dbfbe);}for(let _0x1ef679=0x0,_0x3a918b=_0x3a7968['length'];_0x1ef679<_0x3a918b;_0x1ef679++){_0x6c4fe9+='%'+('00'+_0x3a7968['charCodeAt'](_0x1ef679)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x6c4fe9);};a24_0x5f6e['APzIpz']=_0x5f6e1d,_0x1423a8=arguments,a24_0x5f6e['eDHvUr']=!![];}const _0xd9c0df=_0xca72f1[0x0],_0x117900=_0x2ca454+_0xd9c0df,_0x369119=_0x1423a8[_0x117900];if(!_0x369119){const _0x2dd866=function(_0x55358b){this['iexsHX']=_0x55358b,this['XeMyKD']=[0x1,0x0,0x0],this['YcSpUE']=function(){return'newState';},this['zrqmPi']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['ELBqvb']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2dd866['prototype']['OEqJyB']=function(){const _0x3e5c59=new RegExp(this['zrqmPi']+this['ELBqvb']),_0x2ff769=_0x3e5c59['test'](this['YcSpUE']['toString']())?--this['XeMyKD'][0x1]:--this['XeMyKD'][0x0];return this['hrfpYb'](_0x2ff769);},_0x2dd866['prototype']['hrfpYb']=function(_0x188da3){if(!Boolean(~_0x188da3))return _0x188da3;return this['rBkfVS'](this['iexsHX']);},_0x2dd866['prototype']['rBkfVS']=function(_0x1943fb){for(let _0x2be0aa=0x0,_0x4ae602=this['XeMyKD']['length'];_0x2be0aa<_0x4ae602;_0x2be0aa++){this['XeMyKD']['push'](Math['round'](Math['random']())),_0x4ae602=this['XeMyKD']['length'];}return _0x1943fb(this['XeMyKD'][0x0]);},new _0x2dd866(a24_0x5f6e)['OEqJyB'](),_0x55254c=a24_0x5f6e['APzIpz'](_0x55254c),_0x1423a8[_0x117900]=_0x55254c;}else _0x55254c=_0x369119;return _0x55254c;},a24_0x5f6e(_0x1423a8,_0x291ef3);}a24_0x2ca454();import{headers}from'next/headers';function a24_0x5525(){const _0x36b964=['AvPmvLm','vfrjvgi','otyZqwPRuezW','Dg9tDhjPBMC','DfzHwhe','tvHNseK','EMP6Ae8','otq5mJvNBwHcrMm','DKvMrhm','t3bdt1C','ndu0mMTZs3HuCW','y291CNnLswq','v2vIAg9VAYbZAwDUyxr1CMuGDMvYAwzPy2f0Aw9UigzHAwXLzdOG','u1rssvbfx1DfqKHpt0TFu0vduKvu','BhPAtKu','tfDKwMy','yxbWBhK','sK1Xtxy','mZmWnJr6EgfowuG','vw5RBM93BIbLCNjVCG','mtqXmJK4mgnPCM9TrG','v2vIAg9VAYbOyw5KBgvYigzHAwXLza','DxnLCKLK','zgf0yq','tu1iqxq','twLZC2LUzYbTzxrHzgf0yq','mJG3wK1Iww9X','zw52','C3vTExe','C3rYAxbLlxnPz25HDhvYzq','BwvZC2fNzq','D2zIrKq','Bwv0ywrHDge','u1rssvbfx1nfq1jfvf9lrvK','x2LK','odKWmta2oe10wu1wra','mJaWmZy5n1PWyuHQDG','DhLWzq','nhvfshbSzW','y29UC3rYDwn0rxzLBNq','vfLdAuu','Dvjnv2q','D2vIAg9VA3m','tM8GC2LNBMf0DxjLigzVDw5K','D3f2wwq','mtKWr1D4zND2','C2vHCMnO','B2jQzwn0','y29UC3rYDwn0B3i','CfvrDM0','kcGOlISPkYKRksSK','C3rYAxbL','zxjYB3i','wwnVvge','v2vIAg9VAYbfCNjVCJOG','ANPurLC','B3fRwha','DgToCxO','B2v3Cg0','odGZzhzZquPU'];a24_0x5525=function(){return _0x36b964;};return a24_0x5525();}import{NextResponse}from'next/server';import a24_0x313714 from'stripe';import{getStudentByClerkId}from'@/sanity/lib/student/getStudentByClerkId';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';const stripe=new a24_0x313714(process[a24_0x59b681(0xf3)][a24_0x59b681(0xf9)],{'apiVersion':'2023-10-16'}),webhookSecret=process[a24_0x59b681(0xf3)][a24_0x59b681(0xe5)];export async function POST(_0x3676e0){const _0x589184=a24_0x59b681,_0x5e48c1={'ZzNUT':function(_0x56cea1,_0x47ba68){return _0x56cea1 instanceof _0x47ba68;},'tkNqz':'Unknown\x20error','oqkXp':_0x589184(0x10a),'OpCOW':function(_0x16470e,_0x311693){return _0x16470e!==_0x311693;},'jzTFW':_0x589184(0xf7),'pUQvm':function(_0x328edd){return _0x328edd();},'wqvYd':_0x589184(0xf5),'MXgHI':_0x589184(0x103),'oewpm':function(_0x29b219,_0x170a60){return _0x29b219 instanceof _0x170a60;},'lzZNE':'checkout.session.completed','hhGmL':function(_0x520877,_0x232290){return _0x520877!==_0x232290;},'TTITb':_0x589184(0xdc),'CSqDV':_0x589184(0xe9),'vEfDs':function(_0x4b8ecd,_0x383764){return _0x4b8ecd===_0x383764;},'zjzhO':'gRDwP','WeJIX':_0x589184(0x100),'MMHAt':_0x589184(0xf1),'uRMWd':function(_0x4ef0af,_0x3552d1){return _0x4ef0af(_0x3552d1);},'sumyq':function(_0x3db4c1,_0x1a2e80){return _0x3db4c1/_0x1a2e80;}};try{if(_0x5e48c1[_0x589184(0xe1)](_0x5e48c1[_0x589184(0x10f)],'wfbFD')){const _0x1483c3=_0x5e48c1['ZzNUT'](_0x42c4ea,_0xd02bfb)?_0x12cad3[_0x589184(0xf6)]:_0x5e48c1[_0x589184(0xd5)];return _0x3ec49e['error']('Webhook\x20signature\x20verification\x20failed:\x20'+_0x1483c3),new _0x2d80ce('Webhook\x20Error:\x20'+_0x1483c3,{'status':0x190});}else{const _0x55c14b=await _0x3676e0['text'](),_0xfc3c9c=await _0x5e48c1[_0x589184(0x109)](headers),_0x27aad7=_0xfc3c9c['get'](_0x5e48c1[_0x589184(0x104)]);if(!_0x27aad7)return new NextResponse(_0x5e48c1[_0x589184(0xdd)],{'status':0x190});let _0x1fd2c5;try{_0x1fd2c5=stripe[_0x589184(0x102)][_0x589184(0xff)](_0x55c14b,_0x27aad7,webhookSecret);}catch(_0x759721){const _0x7a92b4=_0x5e48c1[_0x589184(0xd6)](_0x759721,Error)?_0x759721[_0x589184(0xf6)]:_0x589184(0xeb);return console[_0x589184(0x10c)](_0x589184(0xe4)+_0x7a92b4),new NextResponse(_0x589184(0x10e)+_0x7a92b4,{'status':0x190});}if(_0x1fd2c5[_0x589184(0xfd)]===_0x5e48c1[_0x589184(0xe6)]){if(_0x5e48c1['hhGmL'](_0x5e48c1[_0x589184(0xd9)],_0x5e48c1['CSqDV'])){const _0x4a8700=_0x1fd2c5[_0x589184(0xef)][_0x589184(0x107)],_0x4d87fb=_0x4a8700[_0x589184(0xf8)]?.[_0x589184(0xe3)],_0x26d83e=_0x4a8700[_0x589184(0xf8)]?.[_0x589184(0xee)];if(!_0x4d87fb||!_0x26d83e)return _0x5e48c1[_0x589184(0xe0)](_0x5e48c1[_0x589184(0xde)],_0x5e48c1['WeJIX'])?_0x3d2046[_0x589184(0xdb)]()[_0x589184(0x106)](ejCJDx[_0x589184(0xd4)])[_0x589184(0xdb)]()[_0x589184(0x108)](_0x120c6b)[_0x589184(0x106)](ejCJDx[_0x589184(0xd4)]):new NextResponse(_0x5e48c1[_0x589184(0xf0)],{'status':0x190});const _0x6d8806=await _0x5e48c1[_0x589184(0x101)](getStudentByClerkId,_0x26d83e);if(!_0x6d8806[_0x589184(0xef)])return new NextResponse('Student\x20not\x20found',{'status':0x190});return await _0x5e48c1[_0x589184(0x101)](createEnrollment,{'studentId':_0x6d8806[_0x589184(0xef)][_0x589184(0xfa)],'courseId':_0x4d87fb,'paymentId':_0x4a8700['id'],'amount':_0x5e48c1[_0x589184(0xf4)](_0x4a8700['amount_total'],0x64),'paymentProvider':_0x589184(0x10b)}),new NextResponse(null,{'status':0xc8});}else _0x5af3ae=_0x5ccb63[_0x589184(0x102)][_0x589184(0xff)](_0x364cf1,_0x360145,_0x530c3e);}return new NextResponse(null,{'status':0xc8});}}catch(_0x53b98c){return console[_0x589184(0x10c)]('Error\x20in\x20webhook\x20handler:',_0x53b98c),new NextResponse(_0x589184(0xed),{'status':0x1f4});}}