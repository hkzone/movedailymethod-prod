const a6_0x2e3018=a6_0x9206;(function(_0xa24e50,_0x1fca6e){const _0x255d53=a6_0x9206,_0x2fe87c=_0xa24e50();while(!![]){try{const _0x1f1d88=-parseInt(_0x255d53(0x1fc))/0x1+parseInt(_0x255d53(0x211))/0x2+parseInt(_0x255d53(0x1e9))/0x3+parseInt(_0x255d53(0x1e1))/0x4*(-parseInt(_0x255d53(0x223))/0x5)+parseInt(_0x255d53(0x224))/0x6+-parseInt(_0x255d53(0x213))/0x7+parseInt(_0x255d53(0x1fa))/0x8*(parseInt(_0x255d53(0x20f))/0x9);if(_0x1f1d88===_0x1fca6e)break;else _0x2fe87c['push'](_0x2fe87c['shift']());}catch(_0x51c9b2){_0x2fe87c['push'](_0x2fe87c['shift']());}}}(a6_0x290c,0xf13ee));const a6_0x279581=(function(){const _0x26a9b7=a6_0x9206,_0x5a260a={'hDoNr':_0x26a9b7(0x214),'JJTLh':'WayForPay\x20Webhook:\x20Invalid\x20orderReference\x20format','pnzvx':_0x26a9b7(0x1f5),'vFITJ':_0x26a9b7(0x226),'OGpxQ':_0x26a9b7(0x1e6),'zUfRg':_0x26a9b7(0x202)};let _0x2d1c92=!![];return function(_0x4b07cc,_0x2cb826){const _0x519fce=_0x26a9b7,_0x5b58a9={'ZvGdv':_0x5a260a['JJTLh'],'NJeJQ':_0x5a260a[_0x519fce(0x1f6)],'ofHjR':function(_0x249307,_0x224827){return _0x249307===_0x224827;},'ZjAcX':_0x5a260a[_0x519fce(0x204)],'INRGA':_0x5a260a[_0x519fce(0x1e2)]};if(_0x5a260a[_0x519fce(0x206)]!==_0x5a260a['zUfRg'])return _0x45278a[_0x519fce(0x1e8)](_0x519fce(0x1ee),{'calculatedSignature':_0x41f4bf,'receivedSignature':_0x488238,'stringToSign':_0x164837}),new _0x2ee92c(_0x5a260a['hDoNr'],{'status':0x190});else{const _0x572e92=_0x2d1c92?function(){const _0x572bda=_0x519fce;if(_0x5b58a9['NJeJQ']!==_0x572bda(0x200)){if(_0x2cb826){if(_0x5b58a9['ofHjR'](_0x5b58a9[_0x572bda(0x1e3)],_0x5b58a9['INRGA']))_0x24e622['error'](_0x5b58a9['ZvGdv'],_0xb630c7);else{const _0x444eb5=_0x2cb826[_0x572bda(0x1f8)](_0x4b07cc,arguments);return _0x2cb826=null,_0x444eb5;}}}else{const _0x4ece9c=_0x370f91?function(){const _0x3ae3c5=_0x572bda;if(_0x1d28ad){const _0x5659ba=_0x46af81[_0x3ae3c5(0x1f8)](_0x265137,arguments);return _0xcc631f=null,_0x5659ba;}}:function(){};return _0x5ed26e=![],_0x4ece9c;}}:function(){};return _0x2d1c92=![],_0x572e92;}};}()),a6_0x52e622=a6_0x279581(this,function(){const _0x963c50=a6_0x9206,_0x3ce29c={'QlTSU':_0x963c50(0x20c)};return a6_0x52e622['toString']()['search'](_0x3ce29c[_0x963c50(0x207)])[_0x963c50(0x228)]()[_0x963c50(0x217)](a6_0x52e622)[_0x963c50(0x212)](_0x3ce29c[_0x963c50(0x207)]);});a6_0x52e622();import{NextResponse}from'next/server';import a6_0x853754 from'crypto';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';function a6_0x9206(_0xfce3df,_0x41f90c){const _0x2a26b0=a6_0x290c();return a6_0x9206=function(_0x52e622,_0x279581){_0x52e622=_0x52e622-0x1df;let _0x290ce8=_0x2a26b0[_0x52e622];if(a6_0x9206['ZwypPc']===undefined){var _0x9206a7=function(_0x40dc4a){const _0x17dc26='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x1cc88c='',_0x4f039a='',_0x2dfef1=_0x1cc88c+_0x9206a7;for(let _0x4e0a40=0x0,_0x2c32cd,_0x3b3b0c,_0x3e118e=0x0;_0x3b3b0c=_0x40dc4a['charAt'](_0x3e118e++);~_0x3b3b0c&&(_0x2c32cd=_0x4e0a40%0x4?_0x2c32cd*0x40+_0x3b3b0c:_0x3b3b0c,_0x4e0a40++%0x4)?_0x1cc88c+=_0x2dfef1['charCodeAt'](_0x3e118e+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x2c32cd>>(-0x2*_0x4e0a40&0x6)):_0x4e0a40:0x0){_0x3b3b0c=_0x17dc26['indexOf'](_0x3b3b0c);}for(let _0x370f91=0x0,_0x51e2e5=_0x1cc88c['length'];_0x370f91<_0x51e2e5;_0x370f91++){_0x4f039a+='%'+('00'+_0x1cc88c['charCodeAt'](_0x370f91)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x4f039a);};a6_0x9206['axrGrA']=_0x9206a7,_0xfce3df=arguments,a6_0x9206['ZwypPc']=!![];}const _0x324118=_0x2a26b0[0x0],_0x33ac8d=_0x52e622+_0x324118,_0x271729=_0xfce3df[_0x33ac8d];if(!_0x271729){const _0x356dbb=function(_0x316275){this['DHXkeM']=_0x316275,this['sSdcFC']=[0x1,0x0,0x0],this['UdUIlK']=function(){return'newState';},this['yLFBVY']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['hHgzIk']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x356dbb['prototype']['upAYnF']=function(){const _0x3bf6be=new RegExp(this['yLFBVY']+this['hHgzIk']),_0x5ed26e=_0x3bf6be['test'](this['UdUIlK']['toString']())?--this['sSdcFC'][0x1]:--this['sSdcFC'][0x0];return this['wHkwCO'](_0x5ed26e);},_0x356dbb['prototype']['wHkwCO']=function(_0x1d28ad){if(!Boolean(~_0x1d28ad))return _0x1d28ad;return this['ZWaWkJ'](this['DHXkeM']);},_0x356dbb['prototype']['ZWaWkJ']=function(_0x2a5c7e){for(let _0x15adf5=0x0,_0x1a1da9=this['sSdcFC']['length'];_0x15adf5<_0x1a1da9;_0x15adf5++){this['sSdcFC']['push'](Math['round'](Math['random']())),_0x1a1da9=this['sSdcFC']['length'];}return _0x2a5c7e(this['sSdcFC'][0x0]);},new _0x356dbb(a6_0x9206)['upAYnF'](),_0x290ce8=a6_0x9206['axrGrA'](_0x290ce8),_0xfce3df[_0x33ac8d]=_0x290ce8;}else _0x290ce8=_0x271729;return _0x290ce8;},a6_0x9206(_0xfce3df,_0x41f90c);}import{getStudentByClerkId}from'@/sanity/lib/student/getStudentByClerkId';const WAYFORPAY_MERCHANT_SECRET_KEY=process[a6_0x2e3018(0x1fd)]['WAYFORPAY_MERCHANT_SECRET_KEY'];export async function POST(_0x24e173){const _0x8465d7=a6_0x2e3018,_0x59369d={'nEwmp':_0x8465d7(0x205),'dvuFk':_0x8465d7(0x22b),'YSzvH':function(_0x27f61a,_0xf311d3){return _0x27f61a===_0xf311d3;},'UzZtt':function(_0x141117,_0x319e53){return _0x141117!==_0x319e53;},'cPplx':'fzFkX','KsAkh':'md5','FgxFm':_0x8465d7(0x1e4),'nwwpl':_0x8465d7(0x1ee),'jtUWH':'Webhook\x20Error:\x20Invalid\x20signature','IFoNU':_0x8465d7(0x221),'JboRb':function(_0x1802c6,_0x5b4b6a){return _0x1802c6<_0x5b4b6a;},'NeQoj':function(_0x281526,_0x43b246){return _0x281526!==_0x43b246;},'vRpZx':'iVklr','uHcHZ':'KkUXC','vgBMl':function(_0x39c800,_0x2dbe33){return _0x39c800(_0x2dbe33);},'nJvuM':_0x8465d7(0x1fe),'nULiz':function(_0x164f4e,_0xf1b035){return _0x164f4e===_0xf1b035;},'njCjN':_0x8465d7(0x222),'rxUhA':_0x8465d7(0x215),'XRqIC':_0x8465d7(0x20d),'LeyVJ':function(_0x3026b1,_0x16908c){return _0x3026b1===_0x16908c;},'TPiBn':_0x8465d7(0x1fb)};var _0x3e0f6a;let _0x1a226b;try{_0x1a226b=await _0x24e173[_0x8465d7(0x1ec)](),console[_0x8465d7(0x1e0)](_0x59369d[_0x8465d7(0x227)],JSON[_0x8465d7(0x21a)](_0x1a226b,null,0x2));const {orderReference:_0x22824b,transactionStatus:_0x5710d7,processingDate:_0x38bcfc,merchantSignature:_0x4558e4,amount:_0x28287b}=_0x1a226b;if(!_0x22824b||!_0x5710d7||_0x59369d[_0x8465d7(0x220)](_0x38bcfc,undefined)||!_0x4558e4)return _0x59369d['UzZtt'](_0x8465d7(0x1f3),_0x59369d[_0x8465d7(0x20e)])?(_0x28f888['error'](_0x59369d[_0x8465d7(0x1ed)],{'orderReference':_0xc0038b,'transactionStatus':_0x581062,'processingDate':_0x1df995,'receivedSignature':_0x359409}),new _0x31ec6c(_0x8465d7(0x201),{'status':0x190})):(console[_0x8465d7(0x1e8)](_0x59369d[_0x8465d7(0x1ed)],{'orderReference':_0x22824b,'transactionStatus':_0x5710d7,'processingDate':_0x38bcfc,'receivedSignature':_0x4558e4}),new NextResponse('Webhook\x20Error:\x20Missing\x20fields',{'status':0x190}));const _0x423489=_0x22824b+';'+_0x5710d7+';'+_0x38bcfc,_0x8c0674=a6_0x853754[_0x8465d7(0x1df)](_0x59369d[_0x8465d7(0x210)],WAYFORPAY_MERCHANT_SECRET_KEY)[_0x8465d7(0x1e5)](_0x423489)[_0x8465d7(0x21d)](_0x59369d[_0x8465d7(0x1f7)]);if(_0x8c0674!==_0x4558e4)return console['error'](_0x59369d[_0x8465d7(0x22c)],{'calculatedSignature':_0x8c0674,'receivedSignature':_0x4558e4,'stringToSign':_0x423489}),new NextResponse(_0x59369d['jtUWH'],{'status':0x190});if(_0x59369d[_0x8465d7(0x220)](_0x5710d7,_0x59369d[_0x8465d7(0x20b)])){const _0x557725=_0x22824b['split']('_');if(_0x59369d[_0x8465d7(0x21e)](_0x557725[_0x8465d7(0x203)],0x3))_0x59369d[_0x8465d7(0x1ea)](_0x59369d[_0x8465d7(0x218)],_0x59369d[_0x8465d7(0x218)])?_0x57c2f7[_0x8465d7(0x1e0)](_0x8465d7(0x1f2)+_0x389ffd+'\x27\x20for\x20order\x20'+_0x4715cd+_0x8465d7(0x1f9)):console['error'](_0x8465d7(0x21f),_0x22824b);else{const _0x5c3ade=_0x557725[0x0],_0xf37fcf=_0x557725[0x1],_0x388951=await getStudentByClerkId(_0xf37fcf);if(!((_0x3e0f6a=_0x388951===null||_0x59369d['YSzvH'](_0x388951,void 0x0)?void 0x0:_0x388951[_0x8465d7(0x219)])===null||_0x59369d[_0x8465d7(0x220)](_0x3e0f6a,void 0x0)?void 0x0:_0x3e0f6a[_0x8465d7(0x21b)]))'KkUXC'!==_0x59369d[_0x8465d7(0x1ef)]?_0xd674b9[_0x8465d7(0x1e8)]('WayForPay\x20Webhook:\x20Student\x20not\x20found\x20for\x20clerkId\x20'+_0x38222c+'\x20in\x20order\x20'+_0xe4fada):console[_0x8465d7(0x1e8)](_0x8465d7(0x1ff)+_0xf37fcf+_0x8465d7(0x1f0)+_0x22824b);else{const _0x2e0a45=_0x388951[_0x8465d7(0x219)][_0x8465d7(0x21b)];await _0x59369d[_0x8465d7(0x21c)](createEnrollment,{'studentId':_0x2e0a45,'courseId':_0x5c3ade,'paymentId':_0x22824b,'amount':_0x28287b,'paymentProvider':_0x59369d[_0x8465d7(0x216)]}),console['log']('WayForPay\x20Webhook:\x20Enrollment\x20successfully\x20created\x20for\x20order\x20'+_0x22824b);}}}else console['log'](_0x8465d7(0x1f2)+_0x5710d7+_0x8465d7(0x20a)+_0x22824b+_0x8465d7(0x1f9));const _0x5552bb=Math[_0x8465d7(0x208)](Date['now']()/0x3e8),_0x58c495=_0x22824b+_0x8465d7(0x1f4)+_0x5552bb,_0x4411dc=a6_0x853754[_0x8465d7(0x1df)](_0x8465d7(0x225),WAYFORPAY_MERCHANT_SECRET_KEY)[_0x8465d7(0x1e5)](_0x58c495)[_0x8465d7(0x21d)](_0x8465d7(0x1e4)),_0x3ab9ba={'orderReference':_0x22824b,'status':'accept','time':_0x5552bb,'signature':_0x4411dc};return NextResponse[_0x8465d7(0x1ec)](_0x3ab9ba,{'status':0xc8});}catch(_0x8197fc){if(_0x59369d[_0x8465d7(0x1f1)](_0x59369d[_0x8465d7(0x229)],_0x59369d[_0x8465d7(0x22a)])){const _0x3405b7=_0x5965ce[_0x8465d7(0x1f8)](_0x562bf5,arguments);return _0x17327f=null,_0x3405b7;}else{console[_0x8465d7(0x1e8)](_0x59369d[_0x8465d7(0x1e7)],_0x8197fc);const _0xbaa712=(_0x59369d['LeyVJ'](_0x1a226b,null)||_0x1a226b===void 0x0?void 0x0:_0x1a226b[_0x8465d7(0x209)])||_0x59369d['TPiBn'],_0x2eec2c=Math[_0x8465d7(0x208)](Date[_0x8465d7(0x1eb)]()/0x3e8),_0x3c1f7a='error',_0x581c59=_0xbaa712+';'+_0x3c1f7a+';'+_0x2eec2c,_0x2157ba=a6_0x853754['createHmac'](_0x8465d7(0x225),WAYFORPAY_MERCHANT_SECRET_KEY)[_0x8465d7(0x1e5)](_0x581c59)[_0x8465d7(0x21d)](_0x59369d[_0x8465d7(0x1f7)]);return NextResponse[_0x8465d7(0x1ec)]({'orderReference':_0xbaa712,'status':_0x3c1f7a,'time':_0x2eec2c,'signature':_0x2157ba},{'status':0x1f4});}}}function a6_0x290c(){const _0x26abb8=['ntzuuvLsu2q','Dw5RBM93BL9VCMrLCL9YzwzFzxjYB3i','otGZntyWCNb2D1LU','zw52','D2f5zM9YCgf5','v2f5rM9Yugf5ifDLyMHVB2S6ifn0DwrLBNqGBM90igzVDw5KigzVCIbJBgvYA0LKia','vgX1EgW','v2vIAg9VAYbfCNjVCJOGtwLZC2LUzYbMAwvSzhm','sfvrsLq','BgvUz3rO','DKzjveO','v2f5rM9Yugf5ifDLyMHVB2S6ie1PC3nPBMCGy3jPDgLJywWGzMLLBgrZigzYB20GCgf5Bg9HzdO','ELvMuMC','uwXuu1u','zMXVB3i','B3jKzxjszwzLCMvUy2u','jYbMB3iGB3jKzxiG','suzVtLu','kcGOlISPkYKRksSK','rxjYB3iGAw4Gv2f5rM9Yugf5ihDLyMHVB2SGAgfUzgXLCJO','y1bWBhG','odyWnJe2yKzdEwHT','s3nbA2G','mZi2ntK4mMvLuM52ua','C2vHCMnO','mtG4mta3nxHABNzAyW','v2vIAg9VAYbfCNjVCJOGsw52ywXPzcbZAwDUyxr1CMu','Dgr4BMC','BKP2Du0','y29UC3rYDwn0B3i','DLjWwNG','zgf0yq','C3rYAw5NAwz5','x2LK','DMDctwW','zgLNzxn0','sMjVuMi','v2f5rM9Yugf5ifDLyMHVB2S6ieLUDMfSAwqGB3jKzxjszwzLCMvUy2uGzM9YBwf0','wvn6DKG','qxbWCM92zwq','DxDVEuu','mZuZmdvMCwXgCuG','nJCXmdCXmMjqAgDpDa','Bwq1','veXit3i','zhz1rMS','Dg9tDhjPBMC','BMPdAK4','CNHvAee','v2f5rM9Yugf5ihDLyMHVB2SGCMvJzwL2zwq6','BND3CgW','y3jLyxrLsg1HyW','Bg9N','mta4ng5RsfbQDa','t0DWEfe','wMPby1G','Agv4','DxbKyxrL','Cg51zfi','wfjXsum','zxjYB3i','mJe5otq0mvHsz1LSCW','tMvrB2O','BM93','ANnVBG','BKv3Bxa','v2f5rM9Yugf5ifDLyMHVB2S6ieLUDMfSAwqGC2LNBMf0DxjLlG','DuHJsfO','igLUig9YzgvYia','BLvmAxO','v2f5rM9Yugf5ifDLyMHVB2S6ifjLy2vPDMvKihn0yxr1CYaN','zNPgA1G','o2fJy2vWDdS','uMjxAK0','Cg56DNG','rMD4rM0','yxbWBhK','lIboBYbLBNjVBgXTzw50igfJDgLVBIb0ywTLBI4'];a6_0x290c=function(){return _0x26abb8;};return a6_0x290c();}