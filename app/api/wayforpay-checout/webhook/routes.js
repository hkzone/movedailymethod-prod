const a6_0x2f4f9b=a6_0xc41b;function a6_0xc41b(_0x5a54ff,_0x168bc5){const _0x454047=a6_0x2822();return a6_0xc41b=function(_0xc59bca,_0x496732){_0xc59bca=_0xc59bca-0xd4;let _0x28227d=_0x454047[_0xc59bca];if(a6_0xc41b['kTvkQT']===undefined){var _0xc41bc1=function(_0x30cbe2){const _0x1df4eb='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x39dc91='',_0x16b23f='',_0x76ce02=_0x39dc91+_0xc41bc1;for(let _0x16ca0c=0x0,_0x58a594,_0x116994,_0x6c0e19=0x0;_0x116994=_0x30cbe2['charAt'](_0x6c0e19++);~_0x116994&&(_0x58a594=_0x16ca0c%0x4?_0x58a594*0x40+_0x116994:_0x116994,_0x16ca0c++%0x4)?_0x39dc91+=_0x76ce02['charCodeAt'](_0x6c0e19+0xa)-0xa!==0x0?String['fromCharCode'](0xff&_0x58a594>>(-0x2*_0x16ca0c&0x6)):_0x16ca0c:0x0){_0x116994=_0x1df4eb['indexOf'](_0x116994);}for(let _0x5cb974=0x0,_0x40895d=_0x39dc91['length'];_0x5cb974<_0x40895d;_0x5cb974++){_0x16b23f+='%'+('00'+_0x39dc91['charCodeAt'](_0x5cb974)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x16b23f);};a6_0xc41b['ryRZLE']=_0xc41bc1,_0x5a54ff=arguments,a6_0xc41b['kTvkQT']=!![];}const _0x5bac30=_0x454047[0x0],_0x1995dd=_0xc59bca+_0x5bac30,_0x1772ed=_0x5a54ff[_0x1995dd];if(!_0x1772ed){const _0x3ee0f6=function(_0x5cc287){this['hrlPuG']=_0x5cc287,this['ojGBKP']=[0x1,0x0,0x0],this['IRLoPd']=function(){return'newState';},this['pNIUPt']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['UteWDN']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3ee0f6['prototype']['paWnDO']=function(){const _0x3c7618=new RegExp(this['pNIUPt']+this['UteWDN']),_0x3e2a1d=_0x3c7618['test'](this['IRLoPd']['toString']())?--this['ojGBKP'][0x1]:--this['ojGBKP'][0x0];return this['nFBSMf'](_0x3e2a1d);},_0x3ee0f6['prototype']['nFBSMf']=function(_0x5a2e5b){if(!Boolean(~_0x5a2e5b))return _0x5a2e5b;return this['SLvveC'](this['hrlPuG']);},_0x3ee0f6['prototype']['SLvveC']=function(_0x52d8ad){for(let _0x2fb5aa=0x0,_0x48efc0=this['ojGBKP']['length'];_0x2fb5aa<_0x48efc0;_0x2fb5aa++){this['ojGBKP']['push'](Math['round'](Math['random']())),_0x48efc0=this['ojGBKP']['length'];}return _0x52d8ad(this['ojGBKP'][0x0]);},new _0x3ee0f6(a6_0xc41b)['paWnDO'](),_0x28227d=a6_0xc41b['ryRZLE'](_0x28227d),_0x5a54ff[_0x1995dd]=_0x28227d;}else _0x28227d=_0x1772ed;return _0x28227d;},a6_0xc41b(_0x5a54ff,_0x168bc5);}(function(_0x2db096,_0x4d0c99){const _0x97d697=a6_0xc41b,_0x23c535=_0x2db096();while(!![]){try{const _0x19b66a=parseInt(_0x97d697(0xed))/0x1+parseInt(_0x97d697(0xe7))/0x2*(-parseInt(_0x97d697(0xe1))/0x3)+parseInt(_0x97d697(0x115))/0x4+parseInt(_0x97d697(0xda))/0x5*(parseInt(_0x97d697(0xff))/0x6)+-parseInt(_0x97d697(0x113))/0x7+-parseInt(_0x97d697(0xf4))/0x8*(-parseInt(_0x97d697(0xf8))/0x9)+-parseInt(_0x97d697(0xea))/0xa*(parseInt(_0x97d697(0x106))/0xb);if(_0x19b66a===_0x4d0c99)break;else _0x23c535['push'](_0x23c535['shift']());}catch(_0x5114ee){_0x23c535['push'](_0x23c535['shift']());}}}(a6_0x2822,0xec97f));const a6_0x496732=(function(){let _0x45a2fa=!![];return function(_0x4c9370,_0x52a5b1){const _0x3c555a=_0x45a2fa?function(){const _0x26d411=a6_0xc41b;if(_0x52a5b1){const _0x12fdb0=_0x52a5b1[_0x26d411(0xef)](_0x4c9370,arguments);return _0x52a5b1=null,_0x12fdb0;}}:function(){};return _0x45a2fa=![],_0x3c555a;};}()),a6_0xc59bca=a6_0x496732(this,function(){const _0x535562=a6_0xc41b,_0x44fe03={'tcxan':_0x535562(0xdb)};return a6_0xc59bca[_0x535562(0xd8)]()[_0x535562(0x108)](_0x44fe03[_0x535562(0xe4)])[_0x535562(0xd8)]()['constructor'](a6_0xc59bca)[_0x535562(0x108)](_0x44fe03[_0x535562(0xe4)]);});a6_0xc59bca();import{NextResponse}from'next/server';import a6_0x5452f9 from'crypto';import{createEnrollment}from'@/sanity/lib/student/createEnrollment';import{getStudentByClerkId}from'@/sanity/lib/student/getStudentByClerkId';const WAYFORPAY_MERCHANT_SECRET_KEY=process[a6_0x2f4f9b(0x109)][a6_0x2f4f9b(0x104)];export async function POST(_0x447efb){const _0x3ae667=a6_0x2f4f9b,_0x2c5e29={'SVgqM':_0x3ae667(0xd6),'mSRnT':function(_0x50ca3b,_0x305f10){return _0x50ca3b===_0x305f10;},'aUlsz':_0x3ae667(0xd5),'BonYB':_0x3ae667(0xf6),'qeeIu':function(_0x17cb75,_0x35123b){return _0x17cb75===_0x35123b;},'TuFBU':_0x3ae667(0xf2),'cIjVp':_0x3ae667(0x105),'aXqGV':'Webhook\x20Error:\x20Missing\x20fields','IBNkt':'md5','nFvyY':function(_0x5a59cd,_0x19b5ab){return _0x5a59cd!==_0x19b5ab;},'TKFSy':_0x3ae667(0xf9),'eLzCY':function(_0x2caa79,_0x13d94e){return _0x2caa79===_0x13d94e;},'gcjEa':_0x3ae667(0xe9),'IXISa':function(_0x3a3d10,_0x2b3a38){return _0x3a3d10<_0x2b3a38;},'gOoFd':function(_0x1162f4,_0x59957b){return _0x1162f4===_0x59957b;},'YudvR':function(_0x288e37,_0x2f4097){return _0x288e37===_0x2f4097;},'OKXOu':function(_0x3a3b84,_0x2c8a4d){return _0x3a3b84===_0x2c8a4d;},'CAnds':_0x3ae667(0xf5),'IWHJq':_0x3ae667(0x100),'EnGNk':function(_0x3deec9,_0x16bc0d){return _0x3deec9(_0x16bc0d);},'DnSqH':'accept','OFcIa':function(_0x3dd081,_0x45bb50){return _0x3dd081===_0x45bb50;},'fORsQ':_0x3ae667(0xf0),'YuymS':function(_0x28f228,_0x564adf){return _0x28f228/_0x564adf;}};var _0x160954;let _0x3c8669;try{_0x3c8669=await _0x447efb[_0x3ae667(0xfc)](),console[_0x3ae667(0xf1)](_0x3ae667(0xde),JSON[_0x3ae667(0x103)](_0x3c8669,null,0x2));const {orderReference:_0x387c43,transactionStatus:_0x2e1325,processingDate:_0x231ca5,merchantSignature:_0xc67d95,amount:_0x3dc67d}=_0x3c8669;if(!_0x387c43||!_0x2e1325||_0x2c5e29[_0x3ae667(0xdc)](_0x231ca5,undefined)||!_0xc67d95){if(_0x2c5e29[_0x3ae667(0x107)](_0x3ae667(0xf2),_0x2c5e29[_0x3ae667(0x10f)]))return console[_0x3ae667(0xd5)](_0x2c5e29['cIjVp'],{'orderReference':_0x387c43,'transactionStatus':_0x2e1325,'processingDate':_0x231ca5,'receivedSignature':_0xc67d95}),new NextResponse(_0x2c5e29[_0x3ae667(0x10d)],{'status':0x190});else{_0x49dd49['error'](_0x2c5e29[_0x3ae667(0xfa)],_0x585772);const _0x3395a7=(_0x24906e===null||_0x2c5e29['mSRnT'](_0x44cad1,void 0x0)?void 0x0:_0x4f1bc5[_0x3ae667(0x117)])||_0x3ae667(0xf0),_0x2119df=_0x208d95[_0x3ae667(0xdd)](_0x3787a8[_0x3ae667(0xd4)]()/0x3e8),_0x286154=_0x2c5e29[_0x3ae667(0x102)],_0x46ef1a=_0x3395a7+';'+_0x286154+';'+_0x2119df,_0x21891f=_0x331e06[_0x3ae667(0xf7)](_0x3ae667(0x116),_0x1b4551)[_0x3ae667(0x110)](_0x46ef1a)[_0x3ae667(0xe3)](_0x2c5e29['BonYB']);return _0x239007[_0x3ae667(0xfc)]({'orderReference':_0x3395a7,'status':_0x286154,'time':_0x2119df,'signature':_0x21891f},{'status':0x1f4});}}const _0x20e9f0=_0x387c43+';'+_0x2e1325+';'+_0x231ca5,_0x56dff5=a6_0x5452f9[_0x3ae667(0xf7)](_0x2c5e29[_0x3ae667(0xe8)],WAYFORPAY_MERCHANT_SECRET_KEY)[_0x3ae667(0x110)](_0x20e9f0)[_0x3ae667(0xe3)]('hex');if(_0x2c5e29['nFvyY'](_0x56dff5,_0xc67d95)){if(_0x2c5e29['nFvyY']('YAKXa',_0x3ae667(0xec)))return console[_0x3ae667(0xd5)]('WayForPay\x20Webhook:\x20Invalid\x20signature.',{'calculatedSignature':_0x56dff5,'receivedSignature':_0xc67d95,'stringToSign':_0x20e9f0}),new NextResponse(_0x2c5e29['TKFSy'],{'status':0x190});else _0xfecc42['log'](_0x3ae667(0xd7)+_0x121e4a+_0x3ae667(0xe0)+_0x299091+'.\x20No\x20enrollment\x20action\x20taken.');}if(_0x2c5e29[_0x3ae667(0x112)](_0x2e1325,_0x2c5e29['gcjEa'])){if(_0x3ae667(0x10e)!==_0x3ae667(0xee)){const _0x167d81=_0x387c43[_0x3ae667(0xf3)]('_');if(_0x2c5e29[_0x3ae667(0x111)](_0x167d81[_0x3ae667(0x101)],0x3))console['error']('WayForPay\x20Webhook:\x20Invalid\x20orderReference\x20format',_0x387c43);else{const _0x59c482=_0x167d81[0x0],_0x38bfd5=_0x167d81[0x1],_0x370c86=await getStudentByClerkId(_0x38bfd5);if(!(_0x2c5e29[_0x3ae667(0x112)](_0x160954=_0x2c5e29['gOoFd'](_0x370c86,null)||_0x2c5e29[_0x3ae667(0xfd)](_0x370c86,void 0x0)?void 0x0:_0x370c86[_0x3ae667(0xd9)],null)||_0x2c5e29[_0x3ae667(0xe2)](_0x160954,void 0x0)?void 0x0:_0x160954['_id'])){if(_0x2c5e29['mSRnT'](_0x2c5e29[_0x3ae667(0xfe)],_0x2c5e29[_0x3ae667(0xfb)])){const _0x2807b4=_0x5cb974?function(){if(_0x5a2e5b){const _0x420c91=_0x469439['apply'](_0x7bd8cb,arguments);return _0x5532fb=null,_0x420c91;}}:function(){};return _0x3e2a1d=![],_0x2807b4;}else console[_0x3ae667(0xd5)](_0x3ae667(0xdf)+_0x38bfd5+_0x3ae667(0xe6)+_0x387c43);}else{const _0x1d4770=_0x370c86[_0x3ae667(0xd9)][_0x3ae667(0x10c)];await _0x2c5e29['EnGNk'](createEnrollment,{'studentId':_0x1d4770,'courseId':_0x59c482,'paymentId':_0x387c43,'amount':_0x3dc67d,'paymentProvider':_0x3ae667(0x114)}),console[_0x3ae667(0xf1)](_0x3ae667(0x10b)+_0x387c43);}}}else _0x1318df[_0x3ae667(0xd5)](_0x3ae667(0xdf)+_0x11577c+_0x3ae667(0xe6)+_0x2455aa);}else console[_0x3ae667(0xf1)](_0x3ae667(0xd7)+_0x2e1325+_0x3ae667(0xe0)+_0x387c43+_0x3ae667(0x118));const _0x16f77c=Math['floor'](Date[_0x3ae667(0xd4)]()/0x3e8),_0x14c0d8=_0x387c43+';accept;'+_0x16f77c,_0x111b40=a6_0x5452f9[_0x3ae667(0xf7)](_0x2c5e29[_0x3ae667(0xe8)],WAYFORPAY_MERCHANT_SECRET_KEY)[_0x3ae667(0x110)](_0x14c0d8)[_0x3ae667(0xe3)](_0x2c5e29[_0x3ae667(0xeb)]),_0x14277e={'orderReference':_0x387c43,'status':_0x2c5e29['DnSqH'],'time':_0x16f77c,'signature':_0x111b40};return NextResponse[_0x3ae667(0xfc)](_0x14277e,{'status':0xc8});}catch(_0xbc702f){console[_0x3ae667(0xd5)](_0x2c5e29['SVgqM'],_0xbc702f);const _0x44d019=(_0x3c8669===null||_0x2c5e29[_0x3ae667(0xe5)](_0x3c8669,void 0x0)?void 0x0:_0x3c8669[_0x3ae667(0x117)])||_0x2c5e29['fORsQ'],_0x4133a2=Math[_0x3ae667(0xdd)](_0x2c5e29[_0x3ae667(0x10a)](Date[_0x3ae667(0xd4)](),0x3e8)),_0x1d6294=_0x2c5e29[_0x3ae667(0x102)],_0x5dd11f=_0x44d019+';'+_0x1d6294+';'+_0x4133a2,_0x2685d2=a6_0x5452f9[_0x3ae667(0xf7)](_0x2c5e29['IBNkt'],WAYFORPAY_MERCHANT_SECRET_KEY)[_0x3ae667(0x110)](_0x5dd11f)[_0x3ae667(0xe3)](_0x2c5e29['BonYB']);return NextResponse[_0x3ae667(0xfc)]({'orderReference':_0x44d019,'status':_0x1d6294,'time':_0x4133a2,'signature':_0x2685d2},{'status':0x1f4});}}function a6_0x2822(){const _0xc91627=['yvHXr1y','EM1rzxe','vhvgqLu','DxbKyxrL','svHju2e','zuX6q1K','nduYmtuXqvDPu1jg','D2f5zM9YCgf5','nZi4mJuXnKDnAgrSyq','Bwq1','B3jKzxjszwzLCMvUy2u','lIboBYbLBNjVBgXTzw50igfJDgLVBIb0ywTLBI4','BM93','zxjYB3i','rxjYB3iGAw4Gv2f5rM9Yugf5ihDLyMHVB2SGAgfUzgXLCJO','v2f5rM9Yugf5ifDLyMHVB2S6ifjLy2vPDMvKihn0yxr1CYaN','Dg9tDhjPBMC','zgf0yq','mtq0ote1sg9XEMLl','kcGOlISPkYKRksSK','CwvLsxu','zMXVB3i','v2f5rM9Yugf5ihDLyMHVB2SGCMvJzwL2zwq6','v2f5rM9Yugf5ifDLyMHVB2S6ifn0DwrLBNqGBM90igzVDw5KigzVCIbJBgvYA0LKia','jYbMB3iGB3jKzxiG','mty3mZm3DhfxqKL0','t0Tyt3u','zgLNzxn0','Dgn4yw4','t0zJswe','igLUig9YzgvYia','mJHrBMntyNi','sujoA3q','qxbWCM92zwq','mtbwDNPtvwS','qM9Uwui','wwvgu00','nJG2mtzfu0rLCKC','ufbVsey','yxbWBhK','Dw5RBM93BL9VCMrLCL9YzwzFzxjYB3i','Bg9N','vNrTBee','C3bSAxq','mti4ue1It1PT','sgTNz0u','Agv4','y3jLyxrLsg1HyW','mtqXoteYAg5nwe1x','v2vIAg9VAYbfCNjVCJOGsw52ywXPzcbZAwDUyxr1CMu','u1zNCu0','svDisNe','ANnVBG','wxvKDLi','q0fUzhm','nZHpwNjrBvG','ugzIzwO','BgvUz3rO','yvvSC3O','C3rYAw5NAwz5','v0fzrK9suefzx01fuKniqu5ux1nfq1jfvf9lrvK','v2f5rM9Yugf5ifDLyMHVB2S6ie1PC3nPBMCGy3jPDgLJywWGzMLLBgrZigzYB20GCgf5Bg9HzdO','nZC0mdK4nLDIuuHOsW','BvnsBLq','C2vHCMnO','zw52','wxv5Bvm','v2f5rM9Yugf5ifDLyMHVB2S6ievUCM9SBg1LBNqGC3vJy2vZC2z1BgX5ignYzwf0zwqGzM9Yig9YzgvYia','x2LK'];a6_0x2822=function(){return _0xc91627;};return a6_0x2822();}